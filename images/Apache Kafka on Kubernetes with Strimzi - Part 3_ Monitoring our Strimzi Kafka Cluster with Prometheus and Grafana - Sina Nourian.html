<!DOCTYPE html>
<!-- saved from url=(0102)https://snourian.com/kafka-kubernetes-strimzi-part-3-monitoring-strimzi-kafka-with-prometheus-grafana/ -->
<html lang="en-US"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<meta name="robots" content="index, follow, max-image-preview:large, max-snippet:-1, max-video-preview:-1">

<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="template" content="Author 1.44">

	<!-- This site is optimized with the Yoast SEO plugin v17.9 - https://yoast.com/wordpress/plugins/seo/ -->
	<title>Apache Kafka on Kubernetes with Strimzi - Part 3: Monitoring our Strimzi Kafka Cluster with Prometheus and Grafana - Sina Nourian</title>
	<meta name="description" content="Deploying Apache Kafka on Kubernetes with Strimzi; Producing and Consuming messages with Go and Scala; Monitoring with Prometheus and Grafana">
	<link rel="canonical" href="https://snourian.com/kafka-kubernetes-strimzi-part-3-monitoring-strimzi-kafka-with-prometheus-grafana/">
	<meta property="og:locale" content="en_US">
	<meta property="og:type" content="article">
	<meta property="og:title" content="Apache Kafka on Kubernetes with Strimzi - Part 3: Monitoring our Strimzi Kafka Cluster with Prometheus and Grafana - Sina Nourian">
	<meta property="og:url" content="https://snourian.com/kafka-kubernetes-strimzi-part-3-monitoring-strimzi-kafka-with-prometheus-grafana/">
	<meta property="og:site_name" content="Sina Nourian">
	<meta property="article:published_time" content="2020-10-23T18:14:51+00:00">
	<meta property="article:modified_time" content="2021-10-13T16:16:11+00:00">
	<meta property="og:image" content="https://snourian.com/wp-content/uploads/2020/10/prometheus-operator-architecture.png">
	<meta name="twitter:card" content="summary_large_image">
	<meta name="twitter:label1" content="Written by">
	<meta name="twitter:data1" content="Sina Nourian">
	<meta name="twitter:label2" content="Est. reading time">
	<meta name="twitter:data2" content="11 minutes">
	<script src="./Apache Kafka on Kubernetes with Strimzi - Part 3_ Monitoring our Strimzi Kafka Cluster with Prometheus and Grafana - Sina Nourian_files/shell.js"></script><script src="./Apache Kafka on Kubernetes with Strimzi - Part 3_ Monitoring our Strimzi Kafka Cluster with Prometheus and Grafana - Sina Nourian_files/yaml.js"></script><script type="application/ld+json" class="yoast-schema-graph">{"@context":"https://schema.org","@graph":[{"@type":"WebSite","@id":"https://snourian.com/#website","url":"https://snourian.com/","name":"Sina Nourian","description":"Software Developer","potentialAction":[{"@type":"SearchAction","target":{"@type":"EntryPoint","urlTemplate":"https://snourian.com/?s={search_term_string}"},"query-input":"required name=search_term_string"}],"inLanguage":"en-US"},{"@type":"ImageObject","@id":"https://snourian.com/kafka-kubernetes-strimzi-part-3-monitoring-strimzi-kafka-with-prometheus-grafana/#primaryimage","inLanguage":"en-US","url":"https://snourian.com/wp-content/uploads/2020/10/prometheus-operator-architecture.png","contentUrl":"https://snourian.com/wp-content/uploads/2020/10/prometheus-operator-architecture.png","width":898,"height":523},{"@type":"WebPage","@id":"https://snourian.com/kafka-kubernetes-strimzi-part-3-monitoring-strimzi-kafka-with-prometheus-grafana/#webpage","url":"https://snourian.com/kafka-kubernetes-strimzi-part-3-monitoring-strimzi-kafka-with-prometheus-grafana/","name":"Apache Kafka on Kubernetes with Strimzi - Part 3: Monitoring our Strimzi Kafka Cluster with Prometheus and Grafana - Sina Nourian","isPartOf":{"@id":"https://snourian.com/#website"},"primaryImageOfPage":{"@id":"https://snourian.com/kafka-kubernetes-strimzi-part-3-monitoring-strimzi-kafka-with-prometheus-grafana/#primaryimage"},"datePublished":"2020-10-23T18:14:51+00:00","dateModified":"2021-10-13T16:16:11+00:00","author":{"@id":"https://snourian.com/#/schema/person/d10c374554935df3edf013de66567cb9"},"description":"Deploying Apache Kafka on Kubernetes with Strimzi; Producing and Consuming messages with Go and Scala; Monitoring with Prometheus and Grafana","breadcrumb":{"@id":"https://snourian.com/kafka-kubernetes-strimzi-part-3-monitoring-strimzi-kafka-with-prometheus-grafana/#breadcrumb"},"inLanguage":"en-US","potentialAction":[{"@type":"ReadAction","target":["https://snourian.com/kafka-kubernetes-strimzi-part-3-monitoring-strimzi-kafka-with-prometheus-grafana/"]}]},{"@type":"BreadcrumbList","@id":"https://snourian.com/kafka-kubernetes-strimzi-part-3-monitoring-strimzi-kafka-with-prometheus-grafana/#breadcrumb","itemListElement":[{"@type":"ListItem","position":1,"name":"Home","item":"https://snourian.com/"},{"@type":"ListItem","position":2,"name":"Apache Kafka on Kubernetes with Strimzi &#8211; Part 3: Monitoring our Strimzi Kafka Cluster with Prometheus and Grafana"}]},{"@type":"Person","@id":"https://snourian.com/#/schema/person/d10c374554935df3edf013de66567cb9","name":"Sina Nourian","image":{"@type":"ImageObject","@id":"https://snourian.com/#personlogo","inLanguage":"en-US","url":"https://secure.gravatar.com/avatar/f2a0777a10938902cb60e2619b6e0ac3?s=96&d=retro&r=g","contentUrl":"https://secure.gravatar.com/avatar/f2a0777a10938902cb60e2619b6e0ac3?s=96&d=retro&r=g","caption":"Sina Nourian"},"url":"https://snourian.com/author/nrsina/"}]}</script>
	<!-- / Yoast SEO plugin. -->


<link rel="dns-prefetch" href="https://fonts.googleapis.com/">
<link rel="dns-prefetch" href="https://s.w.org/">
<link rel="alternate" type="application/rss+xml" title="Sina Nourian » Feed" href="https://snourian.com/feed/">
<link rel="alternate" type="application/rss+xml" title="Sina Nourian » Comments Feed" href="https://snourian.com/comments/feed/">
<link rel="alternate" type="application/rss+xml" title="Sina Nourian » Apache Kafka on Kubernetes with Strimzi – Part 3: Monitoring our Strimzi Kafka Cluster with Prometheus and Grafana Comments Feed" href="https://snourian.com/kafka-kubernetes-strimzi-part-3-monitoring-strimzi-kafka-with-prometheus-grafana/feed/">
		<script type="text/javascript">
			window._wpemojiSettings = {"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/13.1.0\/72x72\/","ext":".png","svgUrl":"https:\/\/s.w.org\/images\/core\/emoji\/13.1.0\/svg\/","svgExt":".svg","source":{"concatemoji":"https:\/\/snourian.com\/wp-includes\/js\/wp-emoji-release.min.js?ver=5.8.6"}};
			!function(e,a,t){var n,r,o,i=a.createElement("canvas"),p=i.getContext&&i.getContext("2d");function s(e,t){var a=String.fromCharCode;p.clearRect(0,0,i.width,i.height),p.fillText(a.apply(this,e),0,0);e=i.toDataURL();return p.clearRect(0,0,i.width,i.height),p.fillText(a.apply(this,t),0,0),e===i.toDataURL()}function c(e){var t=a.createElement("script");t.src=e,t.defer=t.type="text/javascript",a.getElementsByTagName("head")[0].appendChild(t)}for(o=Array("flag","emoji"),t.supports={everything:!0,everythingExceptFlag:!0},r=0;r<o.length;r++)t.supports[o[r]]=function(e){if(!p||!p.fillText)return!1;switch(p.textBaseline="top",p.font="600 32px Arial",e){case"flag":return s([127987,65039,8205,9895,65039],[127987,65039,8203,9895,65039])?!1:!s([55356,56826,55356,56819],[55356,56826,8203,55356,56819])&&!s([55356,57332,56128,56423,56128,56418,56128,56421,56128,56430,56128,56423,56128,56447],[55356,57332,8203,56128,56423,8203,56128,56418,8203,56128,56421,8203,56128,56430,8203,56128,56423,8203,56128,56447]);case"emoji":return!s([10084,65039,8205,55357,56613],[10084,65039,8203,55357,56613])}return!1}(o[r]),t.supports.everything=t.supports.everything&&t.supports[o[r]],"flag"!==o[r]&&(t.supports.everythingExceptFlag=t.supports.everythingExceptFlag&&t.supports[o[r]]);t.supports.everythingExceptFlag=t.supports.everythingExceptFlag&&!t.supports.flag,t.DOMReady=!1,t.readyCallback=function(){t.DOMReady=!0},t.supports.everything||(n=function(){t.readyCallback()},a.addEventListener?(a.addEventListener("DOMContentLoaded",n,!1),e.addEventListener("load",n,!1)):(e.attachEvent("onload",n),a.attachEvent("onreadystatechange",function(){"complete"===a.readyState&&t.readyCallback()})),(n=t.source||{}).concatemoji?c(n.concatemoji):n.wpemoji&&n.twemoji&&(c(n.twemoji),c(n.wpemoji)))}(window,document,window._wpemojiSettings);
		</script><script src="./Apache Kafka on Kubernetes with Strimzi - Part 3_ Monitoring our Strimzi Kafka Cluster with Prometheus and Grafana - Sina Nourian_files/wp-emoji-release.min.js" type="text/javascript" defer=""></script>
		<style type="text/css">
img.wp-smiley,
img.emoji {
	display: inline !important;
	border: none !important;
	box-shadow: none !important;
	height: 1em !important;
	width: 1em !important;
	margin: 0 .07em !important;
	vertical-align: -0.1em !important;
	background: none !important;
	padding: 0 !important;
}
</style>
	<link rel="stylesheet" id="wp-block-library-css" href="./Apache Kafka on Kubernetes with Strimzi - Part 3_ Monitoring our Strimzi Kafka Cluster with Prometheus and Grafana - Sina Nourian_files/style.min.css" type="text/css" media="all">
<link rel="stylesheet" id="rbuilder-styling-css" href="./Apache Kafka on Kubernetes with Strimzi - Part 3_ Monitoring our Strimzi Kafka Cluster with Prometheus and Grafana - Sina Nourian_files/main.css" type="text/css" media="all">
<link rel="stylesheet" id="codemirror-css" href="./Apache Kafka on Kubernetes with Strimzi - Part 3_ Monitoring our Strimzi Kafka Cluster with Prometheus and Grafana - Sina Nourian_files/codemirror.min.css" type="text/css" media="all">
<link rel="stylesheet" id="codemirror-blocks--css" href="./Apache Kafka on Kubernetes with Strimzi - Part 3_ Monitoring our Strimzi Kafka Cluster with Prometheus and Grafana - Sina Nourian_files/blocks.style.build.min.css" type="text/css" media="all">
<link rel="stylesheet" id="ct-author-google-fonts-css" href="./Apache Kafka on Kubernetes with Strimzi - Part 3_ Monitoring our Strimzi Kafka Cluster with Prometheus and Grafana - Sina Nourian_files/css" type="text/css" media="all">
<link rel="stylesheet" id="ct-author-font-awesome-css" href="./Apache Kafka on Kubernetes with Strimzi - Part 3_ Monitoring our Strimzi Kafka Cluster with Prometheus and Grafana - Sina Nourian_files/all.min.css" type="text/css" media="all">
<link rel="stylesheet" id="ct-author-style-css" href="./Apache Kafka on Kubernetes with Strimzi - Part 3_ Monitoring our Strimzi Kafka Cluster with Prometheus and Grafana - Sina Nourian_files/style.css" type="text/css" media="all">
<script type="text/javascript" src="./Apache Kafka on Kubernetes with Strimzi - Part 3_ Monitoring our Strimzi Kafka Cluster with Prometheus and Grafana - Sina Nourian_files/jquery.min.js" id="jquery-core-js"></script>
<script type="text/javascript" src="./Apache Kafka on Kubernetes with Strimzi - Part 3_ Monitoring our Strimzi Kafka Cluster with Prometheus and Grafana - Sina Nourian_files/jquery-migrate.min.js" id="jquery-migrate-js"></script>
<!--[if IE 8]>
<script type='text/javascript' src='https://snourian.com/wp-content/themes/author/js/build/html5shiv.min.js?ver=5.8.6' id='ct-author-html5-shiv-js'></script>
<![endif]-->
<link rel="https://api.w.org/" href="https://snourian.com/wp-json/"><link rel="alternate" type="application/json" href="https://snourian.com/wp-json/wp/v2/posts/118"><link rel="EditURI" type="application/rsd+xml" title="RSD" href="https://snourian.com/xmlrpc.php?rsd">
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="https://snourian.com/wp-includes/wlwmanifest.xml"> 
<meta name="generator" content="WordPress 5.8.6">
<link rel="shortlink" href="https://snourian.com/?p=118">
<link rel="alternate" type="application/json+oembed" href="https://snourian.com/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fsnourian.com%2Fkafka-kubernetes-strimzi-part-3-monitoring-strimzi-kafka-with-prometheus-grafana%2F">
<link rel="alternate" type="text/xml+oembed" href="https://snourian.com/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fsnourian.com%2Fkafka-kubernetes-strimzi-part-3-monitoring-strimzi-kafka-with-prometheus-grafana%2F&amp;format=xml">
<!-- Analytics by WP-Statistics v13.1.4 - https://wp-statistics.com/ -->
<link rel="stylesheet" id="CodeMirror-theme-material-css" href="./Apache Kafka on Kubernetes with Strimzi - Part 3_ Monitoring our Strimzi Kafka Cluster with Prometheus and Grafana - Sina Nourian_files/material.css"><style id="fit-vids-style">.fluid-width-video-wrapper{width:100%;position:relative;padding:0;}.fluid-width-video-wrapper iframe,.fluid-width-video-wrapper object,.fluid-width-video-wrapper embed {position:absolute;top:0;left:0;width:100%;height:100%;}</style></head>

<body id="author" class="post-template-default single single-post postid-118 single-format-standard singular singular-post singular-post-118">
			<a class="skip-content" href="https://snourian.com/kafka-kubernetes-strimzi-part-3-monitoring-strimzi-kafka-with-prometheus-grafana/#main">Skip to content</a>
		<div id="overflow-container" class="overflow-container">
			<div class="max-width">
				<div id="main-sidebar" class="main-sidebar">
																<header class="site-header" id="site-header" role="banner">
							<div id="title-container" class="title-container">
																	<div id="site-avatar" class="site-avatar" style="background-image: url(&#39;https://secure.gravatar.com/avatar/f2a0777a10938902cb60e2619b6e0ac3?s=96&amp;d=retro&amp;r=g&#39;)"></div>
																<div class="container">
									<div id="site-title" class="site-title"><a href="https://snourian.com/">Sina Nourian</a></div>									<p class="tagline">Software Developer</p>								</div>
							</div>
							<button id="toggle-navigation" class="toggle-navigation" aria-expanded="false">
								<span class="screen-reader-text">open primary menu</span>
								<i class="fas fa-bars"></i>
							</button>
							<div class="social-media-icons"><ul>						<li>
							<a class="twitter" target="_blank" href="https://twitter.com/sina_nourian">
								<i class="fab fa-twitter-square"></i>
								<span class="screen-reader-text">twitter</span>
															</a>
						</li>
												<li>
							<a class="linkedin" target="_blank" href="http://www.linkedin.com/in/sinanourian">
								<i class="fab fa-linkedin"></i>
								<span class="screen-reader-text">linkedin</span>
															</a>
						</li>
												<li>
							<a class="email" target="_blank" href="mailto:sina.nourian@gmail.com">
								<i class="fas fa-envelope"></i>
								<span class="screen-reader-text">email</span>
							</a>
						</li>
											<li>
							<a class="github" target="_blank" href="https://github.com/nrsina">
								<i class="fab fa-github-square"></i>
								<span class="screen-reader-text">github</span>
															</a>
						</li>
												<li>
							<a class="medium" target="_blank" href="https://snourian.medium.com/">
								<i class="fab fa-medium"></i>
								<span class="screen-reader-text">medium</span>
															</a>
						</li>
												<li>
							<a class="steam" target="_blank" href="https://steamcommunity.com/id/p30sina">
								<i class="fab fa-steam-square"></i>
								<span class="screen-reader-text">steam</span>
															</a>
						</li>
												<li>
							<a class="telegram" target="_blank" href="https://t.me/sina_nourian">
								<i class="fab fa-telegram"></i>
								<span class="screen-reader-text">telegram</span>
															</a>
						</li>
						</ul></div>							<div id="menu-primary" class="menu-container menu-primary" role="navigation">
	<div class="menu-unset"><ul><li class="page_item page-item-17"><a href="https://snourian.com/my-resume/">My Resume</a></li></ul></div></div>						</header>
																<aside class="sidebar sidebar-primary" id="sidebar-primary" role="complementary">
		<h1 class="screen-reader-text">Sidebar</h1>
		<section id="pro_categories_widget-3" class="widget widget_categories"><h2 class="widget-title">Categories</h2>		<ul>
	<li class="cat-item cat-item-2"><a href="https://snourian.com/category/algorithms/" title="Explaining and implementing various algorithms in different programming languages.">Algorithms</a> (0)
</li>
	<li class="cat-item cat-item-7"><a href="https://snourian.com/category/big-data/">Big Data</a> (3)
</li>
	<li class="cat-item cat-item-5"><a href="https://snourian.com/category/golang/">Go</a> (0)
</li>
	<li class="cat-item cat-item-3"><a href="https://snourian.com/category/java/">Java</a> (2)
</li>
	<li class="cat-item cat-item-6"><a href="https://snourian.com/category/kubernetes/">Kubernetes</a> (4)
</li>
	<li class="cat-item cat-item-4"><a href="https://snourian.com/category/scala/">Scala</a> (0)
</li>
		</ul>
</section><section id="search-4" class="widget widget_search"><h2 class="widget-title">Search</h2><div class="search-form-container">
	<form role="search" method="get" class="search-form" action="https://snourian.com/">
		<label class="screen-reader-text" for="search-field">Search</label>
		<input id="search-field" type="search" class="search-field" value="" name="s" title="Search for:">
		<input type="submit" class="search-submit" value="Go">
	</form>
</div></section><section id="tag_cloud-3" class="widget widget_tag_cloud"><h2 class="widget-title">Tags</h2><div class="tagcloud"><a href="https://snourian.com/tag/akka/" class="tag-cloud-link tag-link-20 tag-link-position-1" style="font-size: 8pt;" aria-label="akka (1 item)">akka</a>
<a href="https://snourian.com/tag/alpakka/" class="tag-cloud-link tag-link-13 tag-link-position-2" style="font-size: 8pt;" aria-label="alpakka (1 item)">alpakka</a>
<a href="https://snourian.com/tag/big-data/" class="tag-cloud-link tag-link-15 tag-link-position-3" style="font-size: 8pt;" aria-label="big-data (1 item)">big-data</a>
<a href="https://snourian.com/tag/cdc/" class="tag-cloud-link tag-link-27 tag-link-position-4" style="font-size: 8pt;" aria-label="cdc (1 item)">cdc</a>
<a href="https://snourian.com/tag/debezium/" class="tag-cloud-link tag-link-26 tag-link-position-5" style="font-size: 8pt;" aria-label="debezium (1 item)">debezium</a>
<a href="https://snourian.com/tag/docker/" class="tag-cloud-link tag-link-18 tag-link-position-6" style="font-size: 8pt;" aria-label="docker (1 item)">docker</a>
<a href="https://snourian.com/tag/go/" class="tag-cloud-link tag-link-16 tag-link-position-7" style="font-size: 8pt;" aria-label="go (1 item)">go</a>
<a href="https://snourian.com/tag/grafana/" class="tag-cloud-link tag-link-12 tag-link-position-8" style="font-size: 8pt;" aria-label="grafana (1 item)">grafana</a>
<a href="https://snourian.com/tag/hibernate/" class="tag-cloud-link tag-link-32 tag-link-position-9" style="font-size: 8pt;" aria-label="hibernate (1 item)">hibernate</a>
<a href="https://snourian.com/tag/java/" class="tag-cloud-link tag-link-29 tag-link-position-10" style="font-size: 8pt;" aria-label="java (1 item)">java</a>
<a href="https://snourian.com/tag/jpa/" class="tag-cloud-link tag-link-31 tag-link-position-11" style="font-size: 8pt;" aria-label="jpa (1 item)">jpa</a>
<a href="https://snourian.com/tag/kafka/" class="tag-cloud-link tag-link-8 tag-link-position-12" style="font-size: 22pt;" aria-label="kafka (4 items)">kafka</a>
<a href="https://snourian.com/tag/kubernetes/" class="tag-cloud-link tag-link-10 tag-link-position-13" style="font-size: 22pt;" aria-label="kubernetes (4 items)">kubernetes</a>
<a href="https://snourian.com/tag/micronaut/" class="tag-cloud-link tag-link-23 tag-link-position-14" style="font-size: 14.3pt;" aria-label="micronaut (2 items)">micronaut</a>
<a href="https://snourian.com/tag/monitoring/" class="tag-cloud-link tag-link-22 tag-link-position-15" style="font-size: 8pt;" aria-label="monitoring (1 item)">monitoring</a>
<a href="https://snourian.com/tag/oracle/" class="tag-cloud-link tag-link-24 tag-link-position-16" style="font-size: 8pt;" aria-label="oracle (1 item)">oracle</a>
<a href="https://snourian.com/tag/outbox/" class="tag-cloud-link tag-link-25 tag-link-position-17" style="font-size: 8pt;" aria-label="outbox (1 item)">outbox</a>
<a href="https://snourian.com/tag/prometheus/" class="tag-cloud-link tag-link-11 tag-link-position-18" style="font-size: 8pt;" aria-label="prometheus (1 item)">prometheus</a>
<a href="https://snourian.com/tag/querydsl/" class="tag-cloud-link tag-link-30 tag-link-position-19" style="font-size: 8pt;" aria-label="querydsl (1 item)">querydsl</a>
<a href="https://snourian.com/tag/rest/" class="tag-cloud-link tag-link-34 tag-link-position-20" style="font-size: 8pt;" aria-label="rest (1 item)">rest</a>
<a href="https://snourian.com/tag/saga/" class="tag-cloud-link tag-link-28 tag-link-position-21" style="font-size: 8pt;" aria-label="saga (1 item)">saga</a>
<a href="https://snourian.com/tag/sbt/" class="tag-cloud-link tag-link-19 tag-link-position-22" style="font-size: 8pt;" aria-label="sbt (1 item)">sbt</a>
<a href="https://snourian.com/tag/scala/" class="tag-cloud-link tag-link-17 tag-link-position-23" style="font-size: 8pt;" aria-label="scala (1 item)">scala</a>
<a href="https://snourian.com/tag/sql/" class="tag-cloud-link tag-link-33 tag-link-position-24" style="font-size: 8pt;" aria-label="sql (1 item)">sql</a>
<a href="https://snourian.com/tag/stream-processing/" class="tag-cloud-link tag-link-14 tag-link-position-25" style="font-size: 8pt;" aria-label="stream-processing (1 item)">stream-processing</a>
<a href="https://snourian.com/tag/strimzi/" class="tag-cloud-link tag-link-9 tag-link-position-26" style="font-size: 22pt;" aria-label="strimzi (4 items)">strimzi</a></div>
</section>	</aside>
									</div>
								<section id="main" class="main" role="main" style="min-height: 12979.2px;">
						<div id="loop-container" class="loop-container">
		<div class="post-118 post type-post status-publish format-standard hentry category-big-data category-kubernetes tag-grafana tag-kafka tag-kubernetes tag-monitoring tag-prometheus tag-strimzi entry">
			<article>
		<div class="post-header">
			<h1 class="post-title">Apache Kafka on Kubernetes with Strimzi – Part 3: Monitoring our Strimzi Kafka Cluster with Prometheus and Grafana</h1>
			<span class="post-meta">
		Published by <a href="https://snourian.com/author/nrsina/">Sina Nourian</a> on <a href="https://snourian.com/2020/10/">October 23, 2020</a></span>		</div>
		<div class="post-content">
						
<p>In the first part of the series, we have learnt about Strimzi and deployed a Kafka Cluster on Minikube and also tested our cluster with the console producer/consumer of the Kafka package. In the second part, we have built a producer application with Go and a consumer application with Scala, created Dockerfiles and Kubernetes deployment files and published them to the Kubernetes.</p>



<p>From the look of the logs it seems like our applications and Kafka are performing well. But we had no idea how they are really performing. That’s why we need some monitoring tools to easily monitor our cluster. In the last part of the series, we are going to use Prometheus and Grafana to fulfill our destiny! Now, what are these two really?</p>



<span id="more-118"></span>



<p>This is the Part 3 of the <em>Apache Kafka on Kubernetes with Strimzi </em>blog post. In case you haven’t read the previous posts, I recommend you to check it out:</p>



<ul><li><a href="http://snourian.com/kafka-kubernetes-strimzi-part-1-creating-deploying-strimzi-kafka/">Part 1: Creating and Deploying a Strimzi Kafka Cluster on Kubernetes</a></li><li><a href="http://snourian.com/kafka-kubernetes-strimzi-part-2-creating-producer-consumer-using-go-scala-deploying-on-kubernetes/">Part 2: Creating Producer and Consumer using Go and Scala and deploying on Kubernetes</a></li><li><strong>Part 3: Monitoring our Strimzi Kafka Cluster with Prometheus and Grafana</strong></li></ul>



<h1>Prometheus</h1>



<p>Observability is an important aspect in software engineering. <em>Wikipedia</em> explains it very well:</p>



<blockquote class="wp-block-quote"><p>Observability is a measure of how well internal states of a system can be inferred from knowledge of its external outputs.</p><cite><a href="https://en.wikipedia.org/wiki/Observability">Wikipedia</a></cite></blockquote>



<p>Observability plays an important role in the world of microservices. Since there are many moving parts in a microservice architecture that communicate with each other, we need monitoring tools to gather various metrics produced from each component to see how well our system performs and find problems easily so we can optimize our system. These metrics will be stored as time-series data in an optimized storage provided by the monitoring tools. <strong>Prometheus</strong> is here to help us regarding this issue.</p>



<blockquote class="wp-block-quote"><p>Prometheus is an open-source systems monitoring and alerting toolkit originally built at SoundCloud. Since its inception in 2012, many companies and organizations have adopted Prometheus, and the project has a very active developer and user community.</p><cite><a href="https://prometheus.io/docs/introduction/overview/">Prometheus Website</a></cite></blockquote>



<p>Prometheus collect metrics provided by the components of a system by polling a HTTP endpoint on each of them. There are many libraries for various languages that simplifies the process of producing metrics in applications (For instance, Spring Actuator for <em>Java</em>). Prometheus also provides a powerful query language called <em>PromQL</em>. This query language can be used to select and aggregate time series data in real time and the result of the query can be shown as a graph, table or can be used by other clients to visualize the data. Prometheus has various metric types such as Counter, Gauge, Histogram and Summary.</p>



<p>Another important feature of Prometheus is <em>Labeling</em>. Labels are used to differentiate the data points in metrics. Assume we have a metric named <em>http_requests_total</em> to specify the total number of http requests. We can use a label to differentiate different http requests by their methods: <em>method=”get|post|put|delete”</em>. In case of using microservices, each microservice has its own <em>http_requests_total</em> metric and by using labels. we can categorize them: <em>service=”svc1|svc2|svc3″</em>. </p>



<p>For more information, please visit <a href="https://prometheus.io/docs/introduction/overview/">Prometheus documentation</a>.</p>



<h1>Grafana</h1>



<p>Grafana is an open source project created by Torkel Ödegaard in 2014. Grafana connects directly to various data sources (time-series databases) and it allows you to query, visualize and explore metrics and also set alerts for different conditions based on the logs.</p>



<blockquote class="wp-block-quote"><p>Grafana is open source visualization and analytics software. It allows you to query, visualize, alert on, and explore your metrics no matter where they are stored. In plain English, it provides you with tools to turn your time-series database (TSDB) data into beautiful graphs and visualizations.</p><cite><a href="https://grafana.com/docs/grafana/latest/getting-started/what-is-grafana/">Grafana Documentation</a></cite></blockquote>



<p>Although Prometheus offers a web UI to view metrics and graphs, Grafana offers much better UI and visualizations which is highly customizable. For example, you can create different dashboards and group various metrics and graphs in them. Also, you can create alerts by defining rules. These alerts can be sent to user via different ways in order to notify them about various conditions defined by the rules.</p>



<p>Just take a look at the <a href="https://grafana.com/grafana/plugins">Plugins page</a> of Grafana. They support an enormous amount of data sources, panels and applications.</p>



<h1>Our Requirements</h1>



<p>We need to understand how our producer, consumer and the Kafka cluster behaves in different scenarios. We need to know the number of online brokers and replicas, CPU, memory and disk usage, garbage collection metrics, incoming and outcoming rate of data, etc. And also, details about topics, unconsumed messages and Consumer Lag. It’s highly important to monitor Consumer Lag in Kafka.</p>



<h1>Adding Metrics to Kafka</h1>



<p>All the <em>YAML</em>s needed to add metrics to our Kafka cluster are available inside the <em>examples</em> folder inside the Strimzi package.</p>



<p>First of all, we need to add metrics to our Kafka resource. Open <em>excamples/metrics/kafka-metrics.yaml</em> file. As you can see, it has <em>metrics</em> key for both <em>kafka</em> and <em>zookeeper</em>. Add them to our Kafka resource <em>yaml</em> file. Now, we also need to add <em>Kafka Exporter</em> configs to our Kafka resource. Visit the <a href="https://strimzi.io/docs/operators/latest/deploying.html#proc-kafka-exporter-configuring-str">Kafka Exporter page on Strimzi document</a> for more information. <a href="https://github.com/danielqsj/kafka_exporter">Kafka Exporter</a> is an open source library used by Strimzi to enhance the monitoring of Kafka brokers and clients.</p>



<p>Our final Kafka resource file will look like this:</p>



<div class="wp-block-codemirror-blocks-code-block code-block" id="0"><pre class="CodeMirror" data-setting="{&quot;mode&quot;:&quot;yaml&quot;,&quot;mime&quot;:&quot;text/x-yaml&quot;,&quot;theme&quot;:&quot;material&quot;,&quot;lineNumbers&quot;:true,&quot;styleActiveLine&quot;:false,&quot;lineWrapping&quot;:false,&quot;readOnly&quot;:true,&quot;language&quot;:&quot;YAML&quot;,&quot;modeName&quot;:&quot;yaml&quot;}" id="code-block-0" style="display: none;">apiVersion: kafka.strimzi.io/v1beta1
kind: Kafka
metadata:
  name: my-cluster
spec:
  kafka:
    version: 2.6.0
    replicas: 1
    resources:
      ...
    metrics:
      lowercaseOutputName: true
      rules:
        ...
  zookeeper:
    replicas: 1
    ...
    metrics:
      lowercaseOutputName: true
      rules:
       ...
  kafkaExporter:
    groupRegex: ".*"
    topicRegex: ".*"
    logging: debug
    enableSaramaLogging: true
    readinessProbe:
      initialDelaySeconds: 15
      timeoutSeconds: 5
    livenessProbe:
      initialDelaySeconds: 15
      timeoutSeconds: 5</pre><div class="CodeMirror CodeMirror-simplescroll cm-s-material"><div class="CodeMirror-panel"><div class="info-panel"><span class="language yaml yaml">YAML</span><div class="control-panel"><span class="tool" data-tip="Full Screen"><b class="fullscreen maximize"></b></span><span class="tool" data-tip="Copy Code"><b class="copy"></b></span></div></div></div><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 36px; left: 33px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;" tabindex="0"></textarea></div><div class="CodeMirror-simplescroll-horizontal" cm-not-content="true" style="display: none;"><div></div></div><div class="CodeMirror-simplescroll-vertical adjest-top" cm-not-content="true" style="display: none; bottom: 0px;"><div style="height: 82.0309px; top: 0px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 29px; margin-bottom: -15px; border-right-width: 15px; min-height: 632px; min-width: 288.781px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><div class="CodeMirror-linenumber CodeMirror-gutter-elt"><div>32</div></div></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"><div class="CodeMirror-cursor" style="left: 4px; top: 0px; height: 19.5px;">&nbsp;</div></div><div class="CodeMirror-code" role="presentation" style=""><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-atom">apiVersion</span><span class="cm-meta">: </span>kafka.strimzi.io/v1beta1</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">2</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-atom">kind</span><span class="cm-meta">: </span>Kafka</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">3</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-atom">metadata</span><span class="cm-meta">:</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">4</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-atom">  name</span><span class="cm-meta">: </span>my-cluster</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">5</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-atom">spec</span><span class="cm-meta">:</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">6</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-atom">  kafka</span><span class="cm-meta">:</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">7</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-atom">    version</span><span class="cm-meta">: </span><span class="cm-number">2.6.0</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">8</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-atom">    replicas</span><span class="cm-meta">: </span><span class="cm-number">1</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">9</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-atom">    resources</span><span class="cm-meta">:</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">10</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">      ...</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">11</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-atom">    metrics</span><span class="cm-meta">:</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">12</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-atom">      lowercaseOutputName</span><span class="cm-meta">: </span><span class="cm-keyword">true</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">13</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-atom">      rules</span><span class="cm-meta">:</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">14</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">        ...</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">15</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-atom">  zookeeper</span><span class="cm-meta">:</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">16</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-atom">    replicas</span><span class="cm-meta">: </span><span class="cm-number">1</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">17</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    ...</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">18</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-atom">    metrics</span><span class="cm-meta">:</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">19</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-atom">      lowercaseOutputName</span><span class="cm-meta">: </span><span class="cm-keyword">true</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">20</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-atom">      rules</span><span class="cm-meta">:</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">21</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">       ...</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">22</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-atom">  kafkaExporter</span><span class="cm-meta">:</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">23</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-atom">    groupRegex</span><span class="cm-meta">: </span><span class="cm-string">".*"</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">24</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-atom">    topicRegex</span><span class="cm-meta">: </span><span class="cm-string">".*"</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">25</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-atom">    logging</span><span class="cm-meta">: </span>debug</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">26</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-atom">    enableSaramaLogging</span><span class="cm-meta">: </span><span class="cm-keyword">true</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">27</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-atom">    readinessProbe</span><span class="cm-meta">:</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">28</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-atom">      initialDelaySeconds</span><span class="cm-meta">: </span><span class="cm-number">15</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">29</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-atom">      timeoutSeconds</span><span class="cm-meta">: </span><span class="cm-number">5</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">30</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-atom">    livenessProbe</span><span class="cm-meta">:</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">31</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-atom">      initialDelaySeconds</span><span class="cm-meta">: </span><span class="cm-number">15</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">32</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-atom">      timeoutSeconds</span><span class="cm-meta">: </span><span class="cm-number">5</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 15px; width: 1px; border-bottom: 0px solid transparent; top: 632px;"></div><div class="CodeMirror-gutters" style="height: 647px; left: 0px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div></div></div>



<p>Strimzi uses <a href="https://github.com/prometheus/jmx_exporter">Prometheus JMX Exporter</a> to expose JMX metrics using an HTTP endpoint, so it can be scraped by the Prometheus server.</p>



<p>Now, let’s update our Kafka resource by applying the <em>yaml</em> file:</p>



<div class="wp-block-codemirror-blocks-code-block code-block" id="1"><pre class="CodeMirror" data-setting="{&quot;mode&quot;:&quot;shell&quot;,&quot;mime&quot;:&quot;text/x-sh&quot;,&quot;theme&quot;:&quot;material&quot;,&quot;lineNumbers&quot;:false,&quot;styleActiveLine&quot;:false,&quot;lineWrapping&quot;:false,&quot;readOnly&quot;:true,&quot;showPanel&quot;:false,&quot;language&quot;:&quot;Shell&quot;,&quot;modeName&quot;:&quot;shell&quot;}" id="code-block-1" style="display: none;">$ kubectl apply -f kafka-deployment.yaml -n kafka</pre><div class="CodeMirror CodeMirror-simplescroll cm-s-material"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 4px; left: 4px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;" tabindex="0"></textarea></div><div class="CodeMirror-simplescroll-horizontal" cm-not-content="true" style="display: none;"><div></div></div><div class="CodeMirror-simplescroll-vertical" cm-not-content="true" style="display: none;"><div></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: -15px; border-right-width: 15px; min-height: 28px; min-width: 390.547px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"><div class="CodeMirror-cursor" style="left: 4px; top: 0px; height: 19.5px;">&nbsp;</div></div><div class="CodeMirror-code" role="presentation"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">$ kubectl</span> apply <span class="cm-attribute">-f</span> kafka-deployment.yaml <span class="cm-attribute">-n</span> kafka</span></pre></div></div></div></div></div><div style="position: absolute; height: 15px; width: 1px; border-bottom: 0px solid transparent; top: 28px;"></div><div class="CodeMirror-gutters" style="display: none; height: 43px;"></div></div></div></div>



<h1>Deploying Prometheus</h1>



<p>Same as Kafka Cluster, We are using Operators to deploy Prometheus on Kubernetes. </p>



<h2>Introducing Prometheus Operator</h2>



<p>With Prometheus Operator, you can deploy and use Prometheus on Kubernetes as easy as possible. Same as the Strimzi Operator that watches for specific resources (e.g. Kafka, KafkaTopic, etc) and reacts on them, the Prometheus Operator does the same. The Operator acts on these resources:</p>



<ul><li><strong>Prometheus.</strong> Defines a desired Prometheus deployment.</li><li><strong>ServiceMonitor.</strong> Defines how a dynamic set of services should be monitored</li><li><strong>PodMonitor.</strong> Defines how a dynamic set of pods should be monitored</li><li><strong>AlertManager.</strong> &nbsp;Defines a desired <em>Alertmanager </em>deployment.</li><li><strong>PrometheusRule.</strong> Defines a desired Prometheus rule to be consumed by one or more Prometheus instances.</li></ul>



<figure class="wp-block-image size-large"><a href="http://snourian.com/wp-content/uploads/2020/10/prometheus-operator-architecture.png" target="_blank" rel="noopener noreferrer"><img loading="lazy" width="898" height="523" src="./Apache Kafka on Kubernetes with Strimzi - Part 3_ Monitoring our Strimzi Kafka Cluster with Prometheus and Grafana - Sina Nourian_files/prometheus-operator-architecture.png" alt="" class="wp-image-124" srcset="https://snourian.com/wp-content/uploads/2020/10/prometheus-operator-architecture.png 898w, https://snourian.com/wp-content/uploads/2020/10/prometheus-operator-architecture-300x175.png 300w, https://snourian.com/wp-content/uploads/2020/10/prometheus-operator-architecture-768x447.png 768w, https://snourian.com/wp-content/uploads/2020/10/prometheus-operator-architecture-740x430.png 740w" sizes="(max-width: 898px) 100vw, 898px"></a><figcaption>Operator workflow and relationships (<a href="https://github.com/prometheus-operator/prometheus-operator/blob/master/Documentation/user-guides/getting-started.md">source</a>)</figcaption></figure>



<p>We’re going to explain them in details with examples soon. Now, let’s deploy the Prometheus Operator. In case you don’t know that if you should use ServiceMonitor or the PodMonitor, <a href="https://github.com/prometheus-operator/prometheus-operator/issues/3119">visit this link</a>.</p>



<h2>Deploying Prometheus Operator</h2>



<p>Download the Prometheus Operator deployment bundle file from <a href="https://raw.githubusercontent.com/prometheus-operator/prometheus-operator/master/bundle.yaml"><strong>here</strong></a>. This <em>yaml </em>file contains all the resources needed to deploy the Prometheus Operator. Before deploying, you need to replace the <em>default</em> namespace used inside the <em>yaml</em> file with your own namespace (we are using <em>monitoring </em>namespace). If you are using Linux or MacOS, you can use <em>curl </em>and <em>sed </em>commands to easily download the <em>bundle.yaml</em> file and replace the namespace <em>(commands are taken from Strimzi document with a slight change)</em>:</p>



<h5>Linux:</h5>



<div class="wp-block-codemirror-blocks-code-block code-block" id="2"><pre class="CodeMirror" data-setting="{&quot;mode&quot;:&quot;shell&quot;,&quot;mime&quot;:&quot;text/x-sh&quot;,&quot;theme&quot;:&quot;material&quot;,&quot;lineNumbers&quot;:false,&quot;styleActiveLine&quot;:false,&quot;lineWrapping&quot;:false,&quot;readOnly&quot;:true,&quot;showPanel&quot;:false,&quot;language&quot;:&quot;Shell&quot;,&quot;modeName&quot;:&quot;shell&quot;}" id="code-block-2" style="display: none;">$ curl -s https://raw.githubusercontent.com/prometheus-operator/prometheus-operator/master/bundle.yaml | sed -e 's/namespace: .*/namespace: monitoring/' &gt; bundle.yaml</pre><div class="CodeMirror CodeMirror-simplescroll cm-s-material"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 4px; left: 4px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;" tabindex="0"></textarea></div><div class="CodeMirror-simplescroll-horizontal" cm-not-content="true" style="display: block; right: 0px; left: 0px;"><div style="width: 299.875px; left: 0px;"></div></div><div class="CodeMirror-simplescroll-vertical" cm-not-content="true" style="display: none;"><div></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: -15px; border-right-width: 15px; min-height: 28px; min-width: 1306.27px; padding-right: 0px; padding-bottom: 8px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"><div class="CodeMirror-cursor" style="left: 4px; top: 0px; height: 19.5px;">&nbsp;</div></div><div class="CodeMirror-code" role="presentation"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">$ curl</span> <span class="cm-attribute">-s</span> https://raw.githubusercontent.com/prometheus-operator/prometheus-operator/master/bundle.yaml | <span class="cm-builtin">sed</span> <span class="cm-attribute">-e</span> <span class="cm-string">'s/namespace: .*/namespace: monitoring/'</span> &gt; bundle.yaml</span></pre></div></div></div></div></div><div style="position: absolute; height: 15px; width: 1px; border-bottom: 8px solid transparent; top: 28px;"></div><div class="CodeMirror-gutters" style="display: none; height: 51px;"></div></div></div></div>



<h5 id="block-105d5059-d2b7-4348-9fa4-54de2696c18f">MacOS:</h5>



<div class="wp-block-codemirror-blocks-code-block code-block" id="3"><pre class="CodeMirror" data-setting="{&quot;mode&quot;:&quot;shell&quot;,&quot;mime&quot;:&quot;text/x-sh&quot;,&quot;theme&quot;:&quot;material&quot;,&quot;lineNumbers&quot;:false,&quot;styleActiveLine&quot;:false,&quot;lineWrapping&quot;:false,&quot;readOnly&quot;:true,&quot;showPanel&quot;:false,&quot;language&quot;:&quot;Shell&quot;,&quot;modeName&quot;:&quot;shell&quot;}" id="code-block-3" style="display: none;">$ curl -s https://raw.githubusercontent.com/prometheus-operator/prometheus-operator/master/bundle.yaml | sed -e '' 's/namespace: .*/namespace: monitoring/' &gt; bundle.yaml</pre><div class="CodeMirror CodeMirror-simplescroll cm-s-material"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 4px; left: 4px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;" tabindex="0"></textarea></div><div class="CodeMirror-simplescroll-horizontal" cm-not-content="true" style="display: block; right: 0px; left: 0px;"><div style="width: 294.638px; left: 0px;"></div></div><div class="CodeMirror-simplescroll-vertical" cm-not-content="true" style="display: none;"><div></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: -15px; border-right-width: 15px; min-height: 28px; min-width: 1329.75px; padding-right: 0px; padding-bottom: 8px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"><div class="CodeMirror-cursor" style="left: 4px; top: 0px; height: 19.5px;">&nbsp;</div></div><div class="CodeMirror-code" role="presentation"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">$ curl</span> <span class="cm-attribute">-s</span> https://raw.githubusercontent.com/prometheus-operator/prometheus-operator/master/bundle.yaml | <span class="cm-builtin">sed</span> <span class="cm-attribute">-e</span> <span class="cm-string">''</span> <span class="cm-string">'s/namespace: .*/namespace: monitoring/'</span> &gt; bundle.yaml</span></pre></div></div></div></div></div><div style="position: absolute; height: 15px; width: 1px; border-bottom: 8px solid transparent; top: 28px;"></div><div class="CodeMirror-gutters" style="display: none; height: 51px;"></div></div></div></div>



<p>Now, let’s deploy it:</p>



<div class="wp-block-codemirror-blocks-code-block code-block" id="4"><pre class="CodeMirror" data-setting="{&quot;mode&quot;:&quot;shell&quot;,&quot;mime&quot;:&quot;text/x-sh&quot;,&quot;theme&quot;:&quot;material&quot;,&quot;lineNumbers&quot;:false,&quot;styleActiveLine&quot;:false,&quot;lineWrapping&quot;:false,&quot;readOnly&quot;:true,&quot;showPanel&quot;:false,&quot;language&quot;:&quot;Shell&quot;,&quot;modeName&quot;:&quot;shell&quot;}" id="code-block-4" style="display: none;">$ kubectl apply -f bundle.yaml -n monitoring</pre><div class="CodeMirror CodeMirror-simplescroll cm-s-material"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 4px; left: 4px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;" tabindex="0"></textarea></div><div class="CodeMirror-simplescroll-horizontal" cm-not-content="true" style="display: none;"><div></div></div><div class="CodeMirror-simplescroll-vertical" cm-not-content="true" style="display: none;"><div></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: -15px; border-right-width: 15px; min-height: 28px; min-width: 351.406px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"><div class="CodeMirror-cursor" style="left: 4px; top: 0px; height: 19.5px;">&nbsp;</div></div><div class="CodeMirror-code" role="presentation"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">$ kubectl</span> apply <span class="cm-attribute">-f</span> bundle.yaml <span class="cm-attribute">-n</span> monitoring</span></pre></div></div></div></div></div><div style="position: absolute; height: 15px; width: 1px; border-bottom: 0px solid transparent; top: 28px;"></div><div class="CodeMirror-gutters" style="display: none; height: 43px;"></div></div></div></div>



<p>Lets see if our Operator has been deployed successfully:</p>



<div class="wp-block-codemirror-blocks-code-block code-block" id="5"><pre class="CodeMirror" data-setting="{&quot;mode&quot;:&quot;shell&quot;,&quot;mime&quot;:&quot;text/x-sh&quot;,&quot;theme&quot;:&quot;material&quot;,&quot;lineNumbers&quot;:false,&quot;styleActiveLine&quot;:false,&quot;lineWrapping&quot;:false,&quot;readOnly&quot;:true,&quot;showPanel&quot;:false,&quot;language&quot;:&quot;Shell&quot;,&quot;modeName&quot;:&quot;shell&quot;}" id="code-block-5" style="display: none;">$ kubectl get pods -n monitoring
NAME                                   READY   STATUS    RESTARTS   AGE
prometheus-operator-7568575f58-2phj6   1/1     Running   0          1m

$ kubectl get svc -n monitoring
NAME                  TYPE        CLUSTER-IP   EXTERNAL-IP   PORT(S)    AGE
prometheus-operator   ClusterIP   None         &lt;none&gt;        8080/TCP   1m</pre><div class="CodeMirror CodeMirror-simplescroll cm-s-material"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 4px; left: 4px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;" tabindex="0"></textarea></div><div class="CodeMirror-simplescroll-horizontal" cm-not-content="true" style="display: none;"><div></div></div><div class="CodeMirror-simplescroll-vertical" cm-not-content="true" style="display: none;"><div></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: -15px; border-right-width: 15px; min-height: 145px; min-width: 594px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"><div class="CodeMirror-cursor" style="left: 4px; top: 0px; height: 19.5px;">&nbsp;</div></div><div class="CodeMirror-code" role="presentation" style=""><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">$ kubectl</span> <span class="cm-builtin">get</span> pods <span class="cm-attribute">-n</span> monitoring</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">NAME                                   READY   STATUS    RESTARTS   AGE</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">prometheus-operator-7568575f58-2phj6   <span class="cm-number">1</span>/1     Running   <span class="cm-number">0</span>          1m</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">$ kubectl</span> <span class="cm-builtin">get</span> svc <span class="cm-attribute">-n</span> monitoring</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">NAME                  TYPE        CLUSTER-IP   EXTERNAL-IP   PORT(S)    AGE</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">prometheus-operator   ClusterIP   None         &lt;none&gt;        <span class="cm-number">8080</span>/TCP   1m</span></pre></div></div></div></div></div><div style="position: absolute; height: 15px; width: 1px; border-bottom: 0px solid transparent; top: 145px;"></div><div class="CodeMirror-gutters" style="display: none; height: 160px;"></div></div></div></div>



<h2>Deploying Prometheus</h2>



<p>Strimzi provides all the example resources needed for deploying Prometheus inside the <em>examples</em> folder. Head to the <em>examples/metrics</em> folder. Before deploying the main Prometheus resource, we need to add some other resources. We are going to deploy all the files inside the <em>monitoring</em> namespace.</p>



<p><strong>First</strong>, open <em>prometheus-additional-properties </em>folder. We need to add <em>prometheus-additional.yaml </em>file as a Kubenetes Secret. This additional configuration contains configuration for a <em>cadvisor</em>. A <em>cadvisor</em> is an agent that monitors resource usage and analyzes the performance of containers. </p>



<p>The Grafana dashboards provided inside the <em>examples</em> folder show metrics for CPU, memory and disk volume usage, which come directly from the Kubernetes <em>cAdvisor </em>agent and <em>kubelet </em>on the nodes. The Prometheus does not have monitoring resource like <em>PodMonitor </em>for scraping the nodes. So this configuration file is needed. It is also referenced inside the <em>Prometheus</em> deployment file:</p>



<div class="wp-block-codemirror-blocks-code-block code-block" id="6"><pre class="CodeMirror" data-setting="{&quot;mode&quot;:&quot;shell&quot;,&quot;mime&quot;:&quot;text/x-sh&quot;,&quot;theme&quot;:&quot;material&quot;,&quot;lineNumbers&quot;:false,&quot;styleActiveLine&quot;:false,&quot;lineWrapping&quot;:false,&quot;readOnly&quot;:true,&quot;showPanel&quot;:false,&quot;language&quot;:&quot;Shell&quot;,&quot;modeName&quot;:&quot;shell&quot;}" id="code-block-6" style="display: none;">$ kubectl create secret generic additional-scrape-configs --from-file=prometheus-additional.yaml -n monitoring</pre><div class="CodeMirror CodeMirror-simplescroll cm-s-material"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 4px; left: 4px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;" tabindex="0"></textarea></div><div class="CodeMirror-simplescroll-horizontal" cm-not-content="true" style="display: block; right: 0px; left: 0px;"><div style="width: 448.729px; left: 0px;"></div></div><div class="CodeMirror-simplescroll-vertical" cm-not-content="true" style="display: none;"><div></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: -15px; border-right-width: 15px; min-height: 28px; min-width: 867.969px; padding-right: 0px; padding-bottom: 8px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"><div class="CodeMirror-cursor" style="left: 4px; top: 0px; height: 19.5px;">&nbsp;</div></div><div class="CodeMirror-code" role="presentation"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">$ kubectl</span> create secret generic additional-scrape-configs <span class="cm-attribute">--from-file</span><span class="cm-operator">=</span>prometheus-additional.yaml <span class="cm-attribute">-n</span> monitoring</span></pre></div></div></div></div></div><div style="position: absolute; height: 15px; width: 1px; border-bottom: 8px solid transparent; top: 28px;"></div><div class="CodeMirror-gutters" style="display: none; height: 51px;"></div></div></div></div>



<p><strong>Second</strong>, open up <em>strimzi-pod-monitor.yaml </em>file. This file contains <em>PodMonitor</em> resources. PodMonitor is used to scrape data directly from pods. For our case, it means pods of Apache Kafka, ZooKeeper and Operators. Update the <em>namespaceSelector.matchNames </em>property and add the namespaces where the pods that the Prometheus needs to scrape. In our case, it’s the <em>kafka</em> namespace.</p>



<div class="wp-block-codemirror-blocks-code-block code-block" id="7"><pre class="CodeMirror" data-setting="{&quot;mode&quot;:&quot;yaml&quot;,&quot;mime&quot;:&quot;text/x-yaml&quot;,&quot;theme&quot;:&quot;material&quot;,&quot;lineNumbers&quot;:true,&quot;styleActiveLine&quot;:false,&quot;lineWrapping&quot;:false,&quot;readOnly&quot;:true,&quot;language&quot;:&quot;YAML&quot;,&quot;modeName&quot;:&quot;yaml&quot;}" id="code-block-7" style="display: none;">  namespaceSelector:
    matchNames:
      - kafka</pre><div class="CodeMirror CodeMirror-simplescroll cm-s-material"><div class="CodeMirror-panel"><div class="info-panel"><span class="language yaml yaml">YAML</span><div class="control-panel"><span class="tool" data-tip="Full Screen"><b class="fullscreen maximize"></b></span><span class="tool" data-tip="Copy Code"><b class="copy"></b></span></div></div></div><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 36px; left: 33px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;" tabindex="0"></textarea></div><div class="CodeMirror-simplescroll-horizontal" cm-not-content="true" style="display: none;"><div></div></div><div class="CodeMirror-simplescroll-vertical adjest-top" cm-not-content="true" style="display: none;"><div></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 29px; margin-bottom: -15px; border-right-width: 15px; min-height: 67px; min-width: 163.547px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><div class="CodeMirror-linenumber CodeMirror-gutter-elt"><div>3</div></div></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"><div class="CodeMirror-cursor" style="left: 4px; top: 0px; height: 19.5px;">&nbsp;</div></div><div class="CodeMirror-code" role="presentation"><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-atom">  namespaceSelector</span><span class="cm-meta">:</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">2</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-atom">    matchNames</span><span class="cm-meta">:</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">3</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-meta">      - </span>kafka</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 15px; width: 1px; border-bottom: 0px solid transparent; top: 67px;"></div><div class="CodeMirror-gutters" style="height: 82px; left: 0px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div></div></div>



<p><strong>Third</strong>, Open the <em>prometheus.yaml</em> file inside <em>examples/metrics/prometheus-install</em> folder. Update all <em>namespace </em>properties and add our <em>monitoring</em> namespace. This file includes the main <em>Prometheus</em> resource that we need to install and run the Prometheus. As you can see in this file, it points to the <em>additional-scrape-configs</em> secret that we have deployed recently in the <em>additionalScrapeConfigs</em> property.</p>



<p>Now, deploy all the updated files:</p>



<div class="wp-block-codemirror-blocks-code-block code-block" id="8"><pre class="CodeMirror" data-setting="{&quot;mode&quot;:&quot;shell&quot;,&quot;mime&quot;:&quot;text/x-sh&quot;,&quot;theme&quot;:&quot;material&quot;,&quot;lineNumbers&quot;:false,&quot;styleActiveLine&quot;:false,&quot;lineWrapping&quot;:false,&quot;readOnly&quot;:true,&quot;showPanel&quot;:false,&quot;language&quot;:&quot;Shell&quot;,&quot;modeName&quot;:&quot;shell&quot;}" id="code-block-8" style="display: none;">$ kubectl apply -f strimzi-pod-monitor.yaml -n monitoring
$ kubectl apply -f prometheus-rules.yaml -n monitoring
$ kubectl apply -f prometheus.yaml -n monitoring</pre><div class="CodeMirror CodeMirror-simplescroll cm-s-material"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 4px; left: 4px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;" tabindex="0"></textarea></div><div class="CodeMirror-simplescroll-horizontal" cm-not-content="true" style="display: none;"><div></div></div><div class="CodeMirror-simplescroll-vertical" cm-not-content="true" style="display: none;"><div></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: -15px; border-right-width: 15px; min-height: 67px; min-width: 453.156px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"><div class="CodeMirror-cursor" style="left: 4px; top: 0px; height: 19.5px;">&nbsp;</div></div><div class="CodeMirror-code" role="presentation"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">$ kubectl</span> apply <span class="cm-attribute">-f</span> strimzi-pod-monitor.yaml <span class="cm-attribute">-n</span> monitoring</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">$ kubectl</span> apply <span class="cm-attribute">-f</span> prometheus-rules.yaml <span class="cm-attribute">-n</span> monitoring</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">$ kubectl</span> apply <span class="cm-attribute">-f</span> prometheus.yaml <span class="cm-attribute">-n</span> monitoring</span></pre></div></div></div></div></div><div style="position: absolute; height: 15px; width: 1px; border-bottom: 0px solid transparent; top: 67px;"></div><div class="CodeMirror-gutters" style="display: none; height: 82px;"></div></div></div></div>



<p>The <em>prometheus-rules.yaml</em> file resides in the <em>examples/metrics/prometheus-install</em> folder and contains <em>PrometheusRule </em>resource that defines a desired Prometheus rule to be consumed by one or more Prometheus instances.</p>



<p>Wait until the pods are up and running:</p>



<div class="wp-block-codemirror-blocks-code-block code-block" id="9"><pre class="CodeMirror" data-setting="{&quot;mode&quot;:&quot;shell&quot;,&quot;mime&quot;:&quot;text/x-sh&quot;,&quot;theme&quot;:&quot;material&quot;,&quot;lineNumbers&quot;:false,&quot;styleActiveLine&quot;:false,&quot;lineWrapping&quot;:false,&quot;readOnly&quot;:true,&quot;showPanel&quot;:false,&quot;language&quot;:&quot;Shell&quot;,&quot;modeName&quot;:&quot;shell&quot;}" id="code-block-9" style="display: none;">$ kubectl get pods -n monitoring
NAME                                   READY   STATUS    RESTARTS   AGE
grafana-7b7bfd6ffc-lmg6z               1/1     Running   0          118m
prometheus-operator-7568575f58-2phj6   1/1     Running   1          19h
prometheus-prometheus-0                3/3     Running   1          98m
﻿</pre><div class="CodeMirror CodeMirror-simplescroll cm-s-material"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 4px; left: 4px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;" tabindex="0"></textarea></div><div class="CodeMirror-simplescroll-horizontal" cm-not-content="true" style="display: none;"><div></div></div><div class="CodeMirror-simplescroll-vertical" cm-not-content="true" style="display: none;"><div></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: -15px; border-right-width: 15px; min-height: 125px; min-width: 570.547px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"><div class="CodeMirror-cursor" style="left: 4px; top: 0px; height: 19.5px;">&nbsp;</div></div><div class="CodeMirror-code" role="presentation" style=""><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">$ kubectl</span> <span class="cm-builtin">get</span> pods <span class="cm-attribute">-n</span> monitoring</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">NAME                                   READY   STATUS    RESTARTS   AGE</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">grafana-7b7bfd6ffc-lmg6z               <span class="cm-number">1</span>/1     Running   <span class="cm-number">0</span>          118m</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">prometheus-operator-7568575f58-2phj6   <span class="cm-number">1</span>/1     Running   <span class="cm-number">1</span>          19h</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">prometheus-prometheus-0                <span class="cm-number">3</span>/3     Running   <span class="cm-number">1</span>          98m</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-invalidchar" title="\ufeff" aria-label="\ufeff" cm-text="﻿">•</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 15px; width: 1px; border-bottom: 0px solid transparent; top: 125px;"></div><div class="CodeMirror-gutters" style="display: none; height: 140px;"></div></div></div></div>



<p>Now, our Prometheus instance is up and running. We have also configured the metrics that our Kafka cluster is exporting and also with the <em>PodMonitor</em> instances and the <em>PrometheusRule</em> that we have configured, Prometheus can scrape metrics from pods inside our <em>kafka</em> cluster.</p>



<h1>Deploying Grafana</h1>



<p>Let’s deploy Grafana and connect it to our Prometheus instance. The Strimzi also provides a configuration file for deploying Grafana. Head to the <em>examples/metrics/grafana-install</em> folder and deploy the <em>grafana.yaml </em>file.</p>



<div class="wp-block-codemirror-blocks-code-block code-block" id="10"><pre class="CodeMirror" data-setting="{&quot;mode&quot;:&quot;shell&quot;,&quot;mime&quot;:&quot;text/x-sh&quot;,&quot;theme&quot;:&quot;material&quot;,&quot;lineNumbers&quot;:false,&quot;styleActiveLine&quot;:false,&quot;lineWrapping&quot;:false,&quot;readOnly&quot;:true,&quot;showPanel&quot;:false,&quot;language&quot;:&quot;Shell&quot;,&quot;modeName&quot;:&quot;shell&quot;}" id="code-block-10" style="display: none;">$ kubectl apply -f grafana.yaml -n monitoring</pre><div class="CodeMirror CodeMirror-simplescroll cm-s-material"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 4px; left: 4px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;" tabindex="0"></textarea></div><div class="CodeMirror-simplescroll-horizontal" cm-not-content="true" style="display: none;"><div></div></div><div class="CodeMirror-simplescroll-vertical" cm-not-content="true" style="display: none;"><div></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: -15px; border-right-width: 15px; min-height: 28px; min-width: 359.234px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"><div class="CodeMirror-cursor" style="left: 4px; top: 0px; height: 19.5px;">&nbsp;</div></div><div class="CodeMirror-code" role="presentation"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">$ kubectl</span> apply <span class="cm-attribute">-f</span> grafana.yaml <span class="cm-attribute">-n</span> monitoring</span></pre></div></div></div></div></div><div style="position: absolute; height: 15px; width: 1px; border-bottom: 0px solid transparent; top: 28px;"></div><div class="CodeMirror-gutters" style="display: none; height: 43px;"></div></div></div></div>



<p>Now, lets use port forwarding to have access to the Grafana dashboard. Use the following command for port forwarding:</p>



<div class="wp-block-codemirror-blocks-code-block code-block" id="11"><pre class="CodeMirror" data-setting="{&quot;mode&quot;:&quot;shell&quot;,&quot;mime&quot;:&quot;text/x-sh&quot;,&quot;theme&quot;:&quot;material&quot;,&quot;lineNumbers&quot;:false,&quot;styleActiveLine&quot;:false,&quot;lineWrapping&quot;:false,&quot;readOnly&quot;:true,&quot;showPanel&quot;:false,&quot;language&quot;:&quot;Shell&quot;,&quot;modeName&quot;:&quot;shell&quot;}" id="code-block-11" style="display: none;">$ kubectl port-forward svc/grafana 3000:3000 -n monitoring</pre><div class="CodeMirror CodeMirror-simplescroll cm-s-material"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 4px; left: 4px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;" tabindex="0"></textarea></div><div class="CodeMirror-simplescroll-horizontal" cm-not-content="true" style="display: none;"><div></div></div><div class="CodeMirror-simplescroll-vertical" cm-not-content="true" style="display: none;"><div></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: -15px; border-right-width: 15px; min-height: 28px; min-width: 460.984px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"><div class="CodeMirror-cursor" style="left: 4px; top: 0px; height: 19.5px;">&nbsp;</div></div><div class="CodeMirror-code" role="presentation"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">$ kubectl</span> port-forward svc/grafana <span class="cm-number">3000</span>:3000 <span class="cm-attribute">-n</span> monitoring</span></pre></div></div></div></div></div><div style="position: absolute; height: 15px; width: 1px; border-bottom: 0px solid transparent; top: 28px;"></div><div class="CodeMirror-gutters" style="display: none; height: 43px;"></div></div></div></div>



<p>Open <em><a href="http://localhost:3000/">http://localhost:3000</a> </em>inside your browser and add Prometheus as a new Data Source. Inside the Settings tap, you need to enter Prometheus address. Let’s see what is the address of our Prometheus service inside Kubernetes:</p>



<div class="wp-block-codemirror-blocks-code-block code-block" id="12"><pre class="CodeMirror" data-setting="{&quot;mode&quot;:&quot;shell&quot;,&quot;mime&quot;:&quot;text/x-sh&quot;,&quot;theme&quot;:&quot;material&quot;,&quot;lineNumbers&quot;:false,&quot;styleActiveLine&quot;:false,&quot;lineWrapping&quot;:false,&quot;readOnly&quot;:true,&quot;showPanel&quot;:false,&quot;language&quot;:&quot;Shell&quot;,&quot;modeName&quot;:&quot;shell&quot;}" id="code-block-12" style="display: none;">$ kubectl get svc -n monitoring
NAME                  TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)    AGE
grafana               ClusterIP   10.103.151.53   &lt;none&gt;        3000/TCP   132m
prometheus-operated   ClusterIP   None            &lt;none&gt;        9090/TCP   112m
prometheus-operator   ClusterIP   None            &lt;none&gt;        8080/TCP   19h</pre><div class="CodeMirror CodeMirror-simplescroll cm-s-material"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 4px; left: 4px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;" tabindex="0"></textarea></div><div class="CodeMirror-simplescroll-horizontal" cm-not-content="true" style="display: block; right: 0px; left: 0px;"><div style="width: 618.767px; left: 0px;"></div></div><div class="CodeMirror-simplescroll-vertical" cm-not-content="true" style="display: none;"><div></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: -15px; border-right-width: 15px; min-height: 106px; min-width: 625.328px; padding-right: 0px; padding-bottom: 8px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"><div class="CodeMirror-cursor" style="left: 4px; top: 0px; height: 19.5px;">&nbsp;</div></div><div class="CodeMirror-code" role="presentation" style=""><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">$ kubectl</span> <span class="cm-builtin">get</span> svc <span class="cm-attribute">-n</span> monitoring</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">NAME                  TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)    AGE</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">grafana               ClusterIP   <span class="cm-number">10</span>.103.151.53   &lt;none&gt;        <span class="cm-number">3000</span>/TCP   132m</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">prometheus-operated   ClusterIP   None            &lt;none&gt;        <span class="cm-number">9090</span>/TCP   112m</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">prometheus-operator   ClusterIP   None            &lt;none&gt;        <span class="cm-number">8080</span>/TCP   19h</span></pre></div></div></div></div></div><div style="position: absolute; height: 15px; width: 1px; border-bottom: 8px solid transparent; top: 106px;"></div><div class="CodeMirror-gutters" style="display: none; height: 129px;"></div></div></div></div>



<p>The address we need to use is <em>http://prometheus-operated:9090</em>. Since the Grafana also resides inside the monitoring namespace, this address is enough. But to access it from another namespace, you need to enter the fully qualified name: <em>http://prometheus-operated.monitoring:9090</em> or <em>http://prometheus-operator.monitoring.svc.cluster.local:9090</em></p>



<p>Now, we need to add some Dashboards to Grafana. Go to the <em>install/metrics/</em>grafana-dashboards and import these files through the Grafana webpage:</p>



<div class="wp-block-codemirror-blocks-code-block code-block" id="13"><pre class="CodeMirror" data-setting="{&quot;mode&quot;:&quot;null&quot;,&quot;mime&quot;:&quot;text/plain&quot;,&quot;theme&quot;:&quot;material&quot;,&quot;lineNumbers&quot;:false,&quot;styleActiveLine&quot;:false,&quot;lineWrapping&quot;:false,&quot;readOnly&quot;:true,&quot;showPanel&quot;:false,&quot;language&quot;:&quot;Plain Text&quot;,&quot;modeName&quot;:&quot;text&quot;}" id="code-block-13" style="display: none;">strimzi-kafka.json
strimzi-kafka-exporter.json
strimzi-operators.json
strimzi-zookeeper.json</pre><div class="CodeMirror CodeMirror-simplescroll cm-s-material"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 4px; left: 4px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;" tabindex="0"></textarea></div><div class="CodeMirror-simplescroll-horizontal" cm-not-content="true" style="display: none;"><div></div></div><div class="CodeMirror-simplescroll-vertical" cm-not-content="true" style="display: none;"><div></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: -15px; border-right-width: 15px; min-height: 86px; min-width: 218.328px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"><div class="CodeMirror-cursor" style="left: 4px; top: 0px; height: 19.5px;">&nbsp;</div></div><div class="CodeMirror-code" role="presentation"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">strimzi-kafka.json</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">strimzi-kafka-exporter.json</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">strimzi-operators.json</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">strimzi-zookeeper.json</span></pre></div></div></div></div></div><div style="position: absolute; height: 15px; width: 1px; border-bottom: 0px solid transparent; top: 86px;"></div><div class="CodeMirror-gutters" style="display: none; height: 101px;"></div></div></div></div>



<p>We haven’t added other Strimzi components like Kafka MirrorMaker so no need to add it.</p>



<p>Now, open the imported Dashboards. As you can see, we can easily monitor our Kafka, Zookeeper and Operators inside Grafana, Awesome!</p>



<figure class="wp-block-image size-large"><img loading="lazy" width="960" height="466" src="./Apache Kafka on Kubernetes with Strimzi - Part 3_ Monitoring our Strimzi Kafka Cluster with Prometheus and Grafana - Sina Nourian_files/grafana-dashboard-screenshot-1.png" alt="" class="wp-image-126" srcset="https://snourian.com/wp-content/uploads/2020/10/grafana-dashboard-screenshot-1.png 960w, https://snourian.com/wp-content/uploads/2020/10/grafana-dashboard-screenshot-1-300x146.png 300w, https://snourian.com/wp-content/uploads/2020/10/grafana-dashboard-screenshot-1-768x373.png 768w" sizes="(max-width: 960px) 100vw, 960px"><figcaption>Grafana Dashboard for our Kafka Cluster</figcaption></figure>



<figure class="wp-block-image size-large"><img loading="lazy" width="960" height="467" src="./Apache Kafka on Kubernetes with Strimzi - Part 3_ Monitoring our Strimzi Kafka Cluster with Prometheus and Grafana - Sina Nourian_files/grafana-dashboard-screenshot-2.png" alt="" class="wp-image-127" srcset="https://snourian.com/wp-content/uploads/2020/10/grafana-dashboard-screenshot-2.png 960w, https://snourian.com/wp-content/uploads/2020/10/grafana-dashboard-screenshot-2-300x146.png 300w, https://snourian.com/wp-content/uploads/2020/10/grafana-dashboard-screenshot-2-768x374.png 768w" sizes="(max-width: 960px) 100vw, 960px"><figcaption><em>Grafana Dashboard for our Kafka Cluster</em> (Kafka Exporter)</figcaption></figure>



<p>As you have seen in the previous post, we have added <em>sleep-time</em> config to our Producer and Consumer. You can easily play with this config to control the speed of producing and consuming and see how your Kafka Cluster behaves under various load. Consumer Lag can be easily spotted in Strimzi Kafka Explorer Dashboard.</p>



<h2>Conclusion</h2>



<p>In this blog post series, we have learnt how to Deploy a Kafka cluster using Strimzi, writing Producers and Consumers with Go and Scala, deploying them in Kubernetes and connecting to our Kafka cluster and in this post, we have learnt how to add metrics to our Kafka and ZooKeeper, deploy Prometheus and Grafana and configure it to scrape metrics from our Pods.</p>



<p>The deployment files and the producer and consumer source code is available here: <a href="https://github.com/nrsina/strimzi-kafka-tutorial">https://github.com/nrsina/strimzi-kafka-tutorial</a></p>



<p>Hope you have enjoyed this post and learnt a thing or two 🙂 If you have any questions or suggestions, feel free to ask in the comment section or send an email to me.</p>
					</div>
		<div class="post-categories"><span>Published in</span><a href="https://snourian.com/category/big-data/" title="View all posts in Big Data">Big Data</a><a href="https://snourian.com/category/kubernetes/" title="View all posts in Kubernetes">Kubernetes</a></div>		<div class="post-tags"><ul><li><a href="https://snourian.com/tag/grafana/" title="View all posts tagged grafana">grafana</a></li><li><a href="https://snourian.com/tag/kafka/" title="View all posts tagged kafka">kafka</a></li><li><a href="https://snourian.com/tag/kubernetes/" title="View all posts tagged kubernetes">kubernetes</a></li><li><a href="https://snourian.com/tag/monitoring/" title="View all posts tagged monitoring">monitoring</a></li><li><a href="https://snourian.com/tag/prometheus/" title="View all posts tagged prometheus">prometheus</a></li><li><a href="https://snourian.com/tag/strimzi/" title="View all posts tagged strimzi">strimzi</a></li></ul></div>	</article>
		<nav class="further-reading">
	<div class="previous">
		<span>Previous Post</span>
		<a href="https://snourian.com/kafka-kubernetes-strimzi-part-2-creating-producer-consumer-using-go-scala-deploying-on-kubernetes/" rel="prev">Apache Kafka on Kubernetes with Strimzi – Part 2: Creating Producer and Consumer apps using Go and Scala and deploying on Kubernetes</a>	</div>
	<div class="next">
		<span>Next Post</span>
		<a href="https://snourian.com/reliable-messaging-outbox-pattern-kafka-debezium-oracle-micronaut-kubernetes/" rel="next">Reliable Messaging in Microservices – Implementing Outbox Pattern using Kafka, Debezium, Micronaut, and Oracle Database on Kubernetes</a>	</div>
</nav>		<section id="comments" class="comments">
		<div class="comments-number">
			<h2>
				7 Comments			</h2>
		</div>
		<ol class="comment-list">
					<li class="comment even thread-even depth-1" id="li-comment-436">
		<article id="comment-436" class="comment">
			<div class="comment-author">
				<img alt="Peter" src="./Apache Kafka on Kubernetes with Strimzi - Part 3_ Monitoring our Strimzi Kafka Cluster with Prometheus and Grafana - Sina Nourian_files/f09d3603da3057b1de3da4d65d6c680a" srcset="https://secure.gravatar.com/avatar/f09d3603da3057b1de3da4d65d6c680a?s=96&amp;d=retro&amp;r=g 2x" class="avatar avatar-48 photo" height="48" width="48" loading="lazy">				<span class="author-name">Peter</span>
			</div>
			<div class="comment-content">
								<p>Hi Sina,</p>
<p>Thanks for sharing the knowledge, this is a really great post!  I was wondering how to change the Prometheus data retention period from the default 24 hour period to something like 3 weeks.  I have tried adding the “retention: 21d” line to the prometheus.yaml file and applying it but the data still continues to roll off every 24 hours.</p>
<p>Thanks,<br>
Peter</p>
			</div>
							<div class="comment-footer">
					<span class="comment-date">April 1, 2021</span>
					<a rel="nofollow" class="comment-reply-link" href="https://snourian.com/kafka-kubernetes-strimzi-part-3-monitoring-strimzi-kafka-with-prometheus-grafana/#comment-436" data-commentid="436" data-postid="118" data-belowelement="comment-436" data-respondelement="respond" data-replyto="Reply to Peter" aria-label="Reply to Peter">Reply</a>									</div>
					</article>
		<ul class="children">
		<li class="comment byuser comment-author-nrsina bypostauthor odd alt depth-2" id="li-comment-1109">
		<article id="comment-1109" class="comment">
			<div class="comment-author">
				<img alt="Sina Nourian" src="./Apache Kafka on Kubernetes with Strimzi - Part 3_ Monitoring our Strimzi Kafka Cluster with Prometheus and Grafana - Sina Nourian_files/f2a0777a10938902cb60e2619b6e0ac3.jpeg" srcset="https://secure.gravatar.com/avatar/f2a0777a10938902cb60e2619b6e0ac3?s=96&amp;d=retro&amp;r=g 2x" class="avatar avatar-48 photo" height="48" width="48" loading="lazy">				<span class="author-name">Sina Nourian</span>
			</div>
			<div class="comment-content">
								<p>Hello Peter,</p>
<p>Sorry for answering really late! I don’t know why I missed your comment and didn’t notice. Actually, I’m not a DevOps and I’m mostly a programmer who is interested in Kubernetes stuff. So unfortunately I can’t answer this question as I haven’t worked much with Prometheus and mostly used the default properties and I have to search it myself. Sorry.</p>
<p>Thank you 🙂</p>
			</div>
							<div class="comment-footer">
					<span class="comment-date">September 30, 2021</span>
					<a rel="nofollow" class="comment-reply-link" href="https://snourian.com/kafka-kubernetes-strimzi-part-3-monitoring-strimzi-kafka-with-prometheus-grafana/#comment-1109" data-commentid="1109" data-postid="118" data-belowelement="comment-1109" data-respondelement="respond" data-replyto="Reply to Sina Nourian" aria-label="Reply to Sina Nourian">Reply</a>									</div>
					</article>
		</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
		<li class="pingback even thread-odd thread-alt depth-1" id="li-comment-1165">
		<article id="comment-1165" class="comment">
			<div class="comment-author">
								<span class="author-name"><a href="https://snourian.com/kafka-kubernetes-strimzi-part-1-creating-deploying-strimzi-kafka/" rel="external nofollow ugc" class="url">Apache Kafka on Kubernetes with Strimzi - Part 1: Creating and Deploying a Strimzi Kafka Cluster - Sina Nourian</a></span>
			</div>
			<div class="comment-content">
								<p>[…] Part 3: Monitoring our Strimzi Kafka Cluster with Prometheus and Grafana […]</p>
			</div>
					</article>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-even depth-1" id="li-comment-1581">
		<article id="comment-1581" class="comment">
			<div class="comment-author">
				<img alt="Xiong Ding" src="./Apache Kafka on Kubernetes with Strimzi - Part 3_ Monitoring our Strimzi Kafka Cluster with Prometheus and Grafana - Sina Nourian_files/ec9f6e2a8eeff7ce31b0c71afe8a5949" srcset="https://secure.gravatar.com/avatar/ec9f6e2a8eeff7ce31b0c71afe8a5949?s=96&amp;d=retro&amp;r=g 2x" class="avatar avatar-48 photo" height="48" width="48" loading="lazy">				<span class="author-name">Xiong Ding</span>
			</div>
			<div class="comment-content">
								<p>Thanks! It helps me a lot.</p>
			</div>
							<div class="comment-footer">
					<span class="comment-date">May 10, 2022</span>
					<a rel="nofollow" class="comment-reply-link" href="https://snourian.com/kafka-kubernetes-strimzi-part-3-monitoring-strimzi-kafka-with-prometheus-grafana/#comment-1581" data-commentid="1581" data-postid="118" data-belowelement="comment-1581" data-respondelement="respond" data-replyto="Reply to Xiong Ding" aria-label="Reply to Xiong Ding">Reply</a>									</div>
					</article>
		</li><!-- #comment-## -->
		<li class="comment even thread-odd thread-alt depth-1" id="li-comment-1620">
		<article id="comment-1620" class="comment">
			<div class="comment-author">
				<img alt="Sagar V" src="./Apache Kafka on Kubernetes with Strimzi - Part 3_ Monitoring our Strimzi Kafka Cluster with Prometheus and Grafana - Sina Nourian_files/1929a0e4b545df174c9ce8f94ea0ccf5" srcset="https://secure.gravatar.com/avatar/1929a0e4b545df174c9ce8f94ea0ccf5?s=96&amp;d=retro&amp;r=g 2x" class="avatar avatar-48 photo" height="48" width="48" loading="lazy">				<span class="author-name">Sagar V</span>
			</div>
			<div class="comment-content">
								<p>I am getting follow error when i am trying to apply .yaml file</p>
<p>kubectl apply -f bundle.yaml -n monitoring<br>
W0610 09:41:01.425940   28682 gcp.go:120] WARNING: the gcp auth plugin is deprecated in v1.22+, unavailable in v1.25+; use gcloud instead.<br>
To learn more, consult <a href="https://cloud.google.com/blog/products/containers-kubernetes/kubectl-auth-changes-in-gke" rel="nofollow ugc">https://cloud.google.com/blog/products/containers-kubernetes/kubectl-auth-changes-in-gke</a><br>
error: error parsing bundle.yaml: error converting YAML to JSON: yaml: line 4306: did not find expected key</p>
			</div>
							<div class="comment-footer">
					<span class="comment-date">June 10, 2022</span>
					<a rel="nofollow" class="comment-reply-link" href="https://snourian.com/kafka-kubernetes-strimzi-part-3-monitoring-strimzi-kafka-with-prometheus-grafana/#comment-1620" data-commentid="1620" data-postid="118" data-belowelement="comment-1620" data-respondelement="respond" data-replyto="Reply to Sagar V" aria-label="Reply to Sagar V">Reply</a>									</div>
					</article>
		<ul class="children">
		<li class="comment odd alt depth-2" id="li-comment-1621">
		<article id="comment-1621" class="comment">
			<div class="comment-author">
				<img alt="sagar" src="./Apache Kafka on Kubernetes with Strimzi - Part 3_ Monitoring our Strimzi Kafka Cluster with Prometheus and Grafana - Sina Nourian_files/1929a0e4b545df174c9ce8f94ea0ccf5" srcset="https://secure.gravatar.com/avatar/1929a0e4b545df174c9ce8f94ea0ccf5?s=96&amp;d=retro&amp;r=g 2x" class="avatar avatar-48 photo" height="48" width="48" loading="lazy">				<span class="author-name">sagar</span>
			</div>
			<div class="comment-content">
								<p>issue sorted out.. there was ideomtation issue in the.yaml file.</p>
			</div>
							<div class="comment-footer">
					<span class="comment-date">June 14, 2022</span>
					<a rel="nofollow" class="comment-reply-link" href="https://snourian.com/kafka-kubernetes-strimzi-part-3-monitoring-strimzi-kafka-with-prometheus-grafana/#comment-1621" data-commentid="1621" data-postid="118" data-belowelement="comment-1621" data-respondelement="respond" data-replyto="Reply to sagar" aria-label="Reply to sagar">Reply</a>									</div>
					</article>
		</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="li-comment-1622">
		<article id="comment-1622" class="comment">
			<div class="comment-author">
				<img alt="Sagar V" src="./Apache Kafka on Kubernetes with Strimzi - Part 3_ Monitoring our Strimzi Kafka Cluster with Prometheus and Grafana - Sina Nourian_files/1929a0e4b545df174c9ce8f94ea0ccf5" srcset="https://secure.gravatar.com/avatar/1929a0e4b545df174c9ce8f94ea0ccf5?s=96&amp;d=retro&amp;r=g 2x" class="avatar avatar-48 photo" height="48" width="48" loading="lazy">				<span class="author-name">Sagar V</span>
			</div>
			<div class="comment-content">
								<p>My prometheus instance is not coming up after completing the “Deploying Prometheus” step , not sure how we can troubleshoot or where things goes wrong ..  </p>
<p>current status is only prometheus operator is running.</p>
<p>NAME                                   READY   STATUS    RESTARTS   AGE<br>
prometheus-operator-67cf85bff4-bkrqg   1/1     Running   0          30m</p>
<p>Could you please help to sort out this issue.</p>
<p>Regards,<br>
Sagar Vyas</p>
			</div>
							<div class="comment-footer">
					<span class="comment-date">June 14, 2022</span>
					<a rel="nofollow" class="comment-reply-link" href="https://snourian.com/kafka-kubernetes-strimzi-part-3-monitoring-strimzi-kafka-with-prometheus-grafana/#comment-1622" data-commentid="1622" data-postid="118" data-belowelement="comment-1622" data-respondelement="respond" data-replyto="Reply to Sagar V" aria-label="Reply to Sagar V">Reply</a>									</div>
					</article>
		</li><!-- #comment-## -->
		</ol>
					<div id="respond" class="comment-respond">
		<h3 id="reply-title" class="comment-reply-title">Leave a Reply <small><a rel="nofollow" id="cancel-comment-reply-link" href="https://snourian.com/kafka-kubernetes-strimzi-part-3-monitoring-strimzi-kafka-with-prometheus-grafana/#respond" style="display:none;">Cancel reply</a></small></h3><form action="https://snourian.com/wp-comments-post.php" method="post" id="commentform" class="comment-form" novalidate=""><p class="comment-notes"><span id="email-notes">Your email address will not be published.</span> Required fields are marked <span class="required">*</span></p><p class="comment-form-comment">
	            <label for="comment">Comment</label>
	            <textarea required="" id="comment" name="comment" cols="45" rows="8" aria-required="true"></textarea>
	        </p><p class="comment-form-author">
	            <label for="author">Name*</label>
	            <input id="author" name="author" type="text" value="" size="30" aria-required="true">
	        </p>
<p class="comment-form-email">
	            <label for="email">Email*</label>
	            <input id="email" name="email" type="email" value="" size="30" aria-required="true">
	        </p>
<p class="comment-form-url">
	            <label for="url">Website</label>
	            <input id="url" name="url" type="url" value="" size="30">
	            </p>
<p class="form-submit"><input name="submit" type="submit" id="submit" class="submit" value="Post Comment"> <input type="hidden" name="comment_post_ID" value="118" id="comment_post_ID">
<input type="hidden" name="comment_parent" id="comment_parent" value="0">
</p><p style="display: none;"><input type="hidden" id="akismet_comment_nonce" name="akismet_comment_nonce" value="f3313af5ba"></p><p style="display: none !important;"><label>Δ<textarea name="ak_hp_textarea" cols="45" rows="8" maxlength="100"></textarea></label><input type="hidden" id="ak_js" name="ak_js" value="1678580623046"><script>document.getElementById( "ak_js" ).setAttribute( "value", ( new Date() ).getTime() );</script></p></form>	</div><!-- #respond -->
		</section>
	</div>	</div>
</section><!-- .main -->
    <footer class="site-footer" role="contentinfo">
                <div class="design-credit">
            <span>
                <a href="https://www.competethemes.com/author/" rel="nofollow">Author WordPress Theme</a> by Compete Themes            </span>
        </div>
    </footer>
</div><!-- .max-width -->
</div><!-- .overflow-container -->
<button id="scroll-to-top" class="scroll-to-top"><span class="screen-reader-text">Scroll to the top</span><i class="fas fa-arrow-up"></i></button><script type="text/javascript" src="./Apache Kafka on Kubernetes with Strimzi - Part 3_ Monitoring our Strimzi Kafka Cluster with Prometheus and Grafana - Sina Nourian_files/codemirror.min.js" id="codemirror-js"></script>
<script type="text/javascript" id="codemirror-autoload-assets-js-before">
var wpcm = {"plugin_url":"https://snourian.com/wp-content/plugins/wp-codemirror-block","assets":[],"panelOptions":{"showPanel":true,"languageLabel":"language","runButton":false,"fullScreenButton":true,"copyButton":true},"view":"public"}
</script>
<script type="text/javascript" src="./Apache Kafka on Kubernetes with Strimzi - Part 3_ Monitoring our Strimzi Kafka Cluster with Prometheus and Grafana - Sina Nourian_files/autoLoadAssets.min.js" id="codemirror-autoload-assets-js"></script>
<script type="text/javascript" src="./Apache Kafka on Kubernetes with Strimzi - Part 3_ Monitoring our Strimzi Kafka Cluster with Prometheus and Grafana - Sina Nourian_files/init.min.js" id="codemirror-init-js"></script><div class="CodeMirror-notice"></div>
<script type="text/javascript" id="ct-author-js-js-extra">
/* <![CDATA[ */
var ct_author_objectL10n = {"openPrimaryMenu":"open primary menu","closePrimaryMenu":"close primary menu","openChildMenu":"open child menu","closeChildMenu":"close child menu"};
/* ]]> */
</script>
<script type="text/javascript" src="./Apache Kafka on Kubernetes with Strimzi - Part 3_ Monitoring our Strimzi Kafka Cluster with Prometheus and Grafana - Sina Nourian_files/production.min.js" id="ct-author-js-js"></script>
<script type="text/javascript" src="./Apache Kafka on Kubernetes with Strimzi - Part 3_ Monitoring our Strimzi Kafka Cluster with Prometheus and Grafana - Sina Nourian_files/comment-reply.min.js" id="comment-reply-js"></script>
<!--[if IE 8]>
<script type='text/javascript' src='https://snourian.com/wp-content/themes/author/js/build/respond.min.js?ver=5.8.6' id='ct-author-respond-js'></script>
<![endif]-->
<script type="text/javascript" src="./Apache Kafka on Kubernetes with Strimzi - Part 3_ Monitoring our Strimzi Kafka Cluster with Prometheus and Grafana - Sina Nourian_files/wp-embed.min.js" id="wp-embed-js"></script>

</body></html>