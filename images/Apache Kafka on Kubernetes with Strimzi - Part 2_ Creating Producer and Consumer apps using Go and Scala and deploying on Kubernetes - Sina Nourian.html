<!DOCTYPE html>
<!-- saved from url=(0119)https://snourian.com/kafka-kubernetes-strimzi-part-2-creating-producer-consumer-using-go-scala-deploying-on-kubernetes/ -->
<html lang="en-US"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<meta name="robots" content="index, follow, max-image-preview:large, max-snippet:-1, max-video-preview:-1">

<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="template" content="Author 1.44">

	<!-- This site is optimized with the Yoast SEO plugin v17.9 - https://yoast.com/wordpress/plugins/seo/ -->
	<title>Apache Kafka on Kubernetes with Strimzi - Part 2: Creating Producer and Consumer apps using Go and Scala and deploying on Kubernetes - Sina Nourian</title>
	<meta name="description" content="Deploying Apache Kafka on Kubernetes with Strimzi; Producing and Consuming messages with Go and Scala; Monitoring with Prometheus and Grafana">
	<link rel="canonical" href="https://snourian.com/kafka-kubernetes-strimzi-part-2-creating-producer-consumer-using-go-scala-deploying-on-kubernetes/">
	<meta property="og:locale" content="en_US">
	<meta property="og:type" content="article">
	<meta property="og:title" content="Apache Kafka on Kubernetes with Strimzi - Part 2: Creating Producer and Consumer apps using Go and Scala and deploying on Kubernetes - Sina Nourian">
	<meta property="og:url" content="https://snourian.com/kafka-kubernetes-strimzi-part-2-creating-producer-consumer-using-go-scala-deploying-on-kubernetes/">
	<meta property="og:site_name" content="Sina Nourian">
	<meta property="article:published_time" content="2020-10-23T18:02:22+00:00">
	<meta property="article:modified_time" content="2021-10-13T16:45:40+00:00">
	<meta property="og:image" content="https://snourian.com/wp-content/uploads/2020/10/strimzi-producer-1024x211.png">
	<meta name="twitter:card" content="summary_large_image">
	<meta name="twitter:label1" content="Written by">
	<meta name="twitter:data1" content="Sina Nourian">
	<meta name="twitter:label2" content="Est. reading time">
	<meta name="twitter:data2" content="14 minutes">
	<script src="./Apache Kafka on Kubernetes with Strimzi - Part 2_ Creating Producer and Consumer apps using Go and Scala and deploying on Kubernetes - Sina Nourian_files/clike.js"></script><script src="./Apache Kafka on Kubernetes with Strimzi - Part 2_ Creating Producer and Consumer apps using Go and Scala and deploying on Kubernetes - Sina Nourian_files/javascript.js"></script><script src="./Apache Kafka on Kubernetes with Strimzi - Part 2_ Creating Producer and Consumer apps using Go and Scala and deploying on Kubernetes - Sina Nourian_files/yaml.js"></script><script src="./Apache Kafka on Kubernetes with Strimzi - Part 2_ Creating Producer and Consumer apps using Go and Scala and deploying on Kubernetes - Sina Nourian_files/shell.js"></script><script src="./Apache Kafka on Kubernetes with Strimzi - Part 2_ Creating Producer and Consumer apps using Go and Scala and deploying on Kubernetes - Sina Nourian_files/dockerfile.js"></script><script src="./Apache Kafka on Kubernetes with Strimzi - Part 2_ Creating Producer and Consumer apps using Go and Scala and deploying on Kubernetes - Sina Nourian_files/protobuf.js"></script><script src="./Apache Kafka on Kubernetes with Strimzi - Part 2_ Creating Producer and Consumer apps using Go and Scala and deploying on Kubernetes - Sina Nourian_files/go.js"></script><script type="application/ld+json" class="yoast-schema-graph">{"@context":"https://schema.org","@graph":[{"@type":"WebSite","@id":"https://snourian.com/#website","url":"https://snourian.com/","name":"Sina Nourian","description":"Software Developer","potentialAction":[{"@type":"SearchAction","target":{"@type":"EntryPoint","urlTemplate":"https://snourian.com/?s={search_term_string}"},"query-input":"required name=search_term_string"}],"inLanguage":"en-US"},{"@type":"ImageObject","@id":"https://snourian.com/kafka-kubernetes-strimzi-part-2-creating-producer-consumer-using-go-scala-deploying-on-kubernetes/#primaryimage","inLanguage":"en-US","url":"https://snourian.com/wp-content/uploads/2020/10/strimzi-producer.png","contentUrl":"https://snourian.com/wp-content/uploads/2020/10/strimzi-producer.png","width":1174,"height":242},{"@type":"WebPage","@id":"https://snourian.com/kafka-kubernetes-strimzi-part-2-creating-producer-consumer-using-go-scala-deploying-on-kubernetes/#webpage","url":"https://snourian.com/kafka-kubernetes-strimzi-part-2-creating-producer-consumer-using-go-scala-deploying-on-kubernetes/","name":"Apache Kafka on Kubernetes with Strimzi - Part 2: Creating Producer and Consumer apps using Go and Scala and deploying on Kubernetes - Sina Nourian","isPartOf":{"@id":"https://snourian.com/#website"},"primaryImageOfPage":{"@id":"https://snourian.com/kafka-kubernetes-strimzi-part-2-creating-producer-consumer-using-go-scala-deploying-on-kubernetes/#primaryimage"},"datePublished":"2020-10-23T18:02:22+00:00","dateModified":"2021-10-13T16:45:40+00:00","author":{"@id":"https://snourian.com/#/schema/person/d10c374554935df3edf013de66567cb9"},"description":"Deploying Apache Kafka on Kubernetes with Strimzi; Producing and Consuming messages with Go and Scala; Monitoring with Prometheus and Grafana","breadcrumb":{"@id":"https://snourian.com/kafka-kubernetes-strimzi-part-2-creating-producer-consumer-using-go-scala-deploying-on-kubernetes/#breadcrumb"},"inLanguage":"en-US","potentialAction":[{"@type":"ReadAction","target":["https://snourian.com/kafka-kubernetes-strimzi-part-2-creating-producer-consumer-using-go-scala-deploying-on-kubernetes/"]}]},{"@type":"BreadcrumbList","@id":"https://snourian.com/kafka-kubernetes-strimzi-part-2-creating-producer-consumer-using-go-scala-deploying-on-kubernetes/#breadcrumb","itemListElement":[{"@type":"ListItem","position":1,"name":"Home","item":"https://snourian.com/"},{"@type":"ListItem","position":2,"name":"Apache Kafka on Kubernetes with Strimzi &#8211; Part 2: Creating Producer and Consumer apps using Go and Scala and deploying on Kubernetes"}]},{"@type":"Person","@id":"https://snourian.com/#/schema/person/d10c374554935df3edf013de66567cb9","name":"Sina Nourian","image":{"@type":"ImageObject","@id":"https://snourian.com/#personlogo","inLanguage":"en-US","url":"https://secure.gravatar.com/avatar/f2a0777a10938902cb60e2619b6e0ac3?s=96&d=retro&r=g","contentUrl":"https://secure.gravatar.com/avatar/f2a0777a10938902cb60e2619b6e0ac3?s=96&d=retro&r=g","caption":"Sina Nourian"},"url":"https://snourian.com/author/nrsina/"}]}</script>
	<!-- / Yoast SEO plugin. -->


<link rel="dns-prefetch" href="https://fonts.googleapis.com/">
<link rel="dns-prefetch" href="https://s.w.org/">
<link rel="alternate" type="application/rss+xml" title="Sina Nourian » Feed" href="https://snourian.com/feed/">
<link rel="alternate" type="application/rss+xml" title="Sina Nourian » Comments Feed" href="https://snourian.com/comments/feed/">
<link rel="alternate" type="application/rss+xml" title="Sina Nourian » Apache Kafka on Kubernetes with Strimzi – Part 2: Creating Producer and Consumer apps using Go and Scala and deploying on Kubernetes Comments Feed" href="https://snourian.com/kafka-kubernetes-strimzi-part-2-creating-producer-consumer-using-go-scala-deploying-on-kubernetes/feed/">
		<script type="text/javascript">
			window._wpemojiSettings = {"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/13.1.0\/72x72\/","ext":".png","svgUrl":"https:\/\/s.w.org\/images\/core\/emoji\/13.1.0\/svg\/","svgExt":".svg","source":{"concatemoji":"https:\/\/snourian.com\/wp-includes\/js\/wp-emoji-release.min.js?ver=5.8.6"}};
			!function(e,a,t){var n,r,o,i=a.createElement("canvas"),p=i.getContext&&i.getContext("2d");function s(e,t){var a=String.fromCharCode;p.clearRect(0,0,i.width,i.height),p.fillText(a.apply(this,e),0,0);e=i.toDataURL();return p.clearRect(0,0,i.width,i.height),p.fillText(a.apply(this,t),0,0),e===i.toDataURL()}function c(e){var t=a.createElement("script");t.src=e,t.defer=t.type="text/javascript",a.getElementsByTagName("head")[0].appendChild(t)}for(o=Array("flag","emoji"),t.supports={everything:!0,everythingExceptFlag:!0},r=0;r<o.length;r++)t.supports[o[r]]=function(e){if(!p||!p.fillText)return!1;switch(p.textBaseline="top",p.font="600 32px Arial",e){case"flag":return s([127987,65039,8205,9895,65039],[127987,65039,8203,9895,65039])?!1:!s([55356,56826,55356,56819],[55356,56826,8203,55356,56819])&&!s([55356,57332,56128,56423,56128,56418,56128,56421,56128,56430,56128,56423,56128,56447],[55356,57332,8203,56128,56423,8203,56128,56418,8203,56128,56421,8203,56128,56430,8203,56128,56423,8203,56128,56447]);case"emoji":return!s([10084,65039,8205,55357,56613],[10084,65039,8203,55357,56613])}return!1}(o[r]),t.supports.everything=t.supports.everything&&t.supports[o[r]],"flag"!==o[r]&&(t.supports.everythingExceptFlag=t.supports.everythingExceptFlag&&t.supports[o[r]]);t.supports.everythingExceptFlag=t.supports.everythingExceptFlag&&!t.supports.flag,t.DOMReady=!1,t.readyCallback=function(){t.DOMReady=!0},t.supports.everything||(n=function(){t.readyCallback()},a.addEventListener?(a.addEventListener("DOMContentLoaded",n,!1),e.addEventListener("load",n,!1)):(e.attachEvent("onload",n),a.attachEvent("onreadystatechange",function(){"complete"===a.readyState&&t.readyCallback()})),(n=t.source||{}).concatemoji?c(n.concatemoji):n.wpemoji&&n.twemoji&&(c(n.twemoji),c(n.wpemoji)))}(window,document,window._wpemojiSettings);
		</script><script src="./Apache Kafka on Kubernetes with Strimzi - Part 2_ Creating Producer and Consumer apps using Go and Scala and deploying on Kubernetes - Sina Nourian_files/wp-emoji-release.min.js" type="text/javascript" defer=""></script>
		<style type="text/css">
img.wp-smiley,
img.emoji {
	display: inline !important;
	border: none !important;
	box-shadow: none !important;
	height: 1em !important;
	width: 1em !important;
	margin: 0 .07em !important;
	vertical-align: -0.1em !important;
	background: none !important;
	padding: 0 !important;
}
</style>
	<link rel="stylesheet" id="wp-block-library-css" href="./Apache Kafka on Kubernetes with Strimzi - Part 2_ Creating Producer and Consumer apps using Go and Scala and deploying on Kubernetes - Sina Nourian_files/style.min.css" type="text/css" media="all">
<link rel="stylesheet" id="rbuilder-styling-css" href="./Apache Kafka on Kubernetes with Strimzi - Part 2_ Creating Producer and Consumer apps using Go and Scala and deploying on Kubernetes - Sina Nourian_files/main.css" type="text/css" media="all">
<link rel="stylesheet" id="codemirror-css" href="./Apache Kafka on Kubernetes with Strimzi - Part 2_ Creating Producer and Consumer apps using Go and Scala and deploying on Kubernetes - Sina Nourian_files/codemirror.min.css" type="text/css" media="all">
<link rel="stylesheet" id="codemirror-blocks--css" href="./Apache Kafka on Kubernetes with Strimzi - Part 2_ Creating Producer and Consumer apps using Go and Scala and deploying on Kubernetes - Sina Nourian_files/blocks.style.build.min.css" type="text/css" media="all">
<link rel="stylesheet" id="ct-author-google-fonts-css" href="./Apache Kafka on Kubernetes with Strimzi - Part 2_ Creating Producer and Consumer apps using Go and Scala and deploying on Kubernetes - Sina Nourian_files/css" type="text/css" media="all">
<link rel="stylesheet" id="ct-author-font-awesome-css" href="./Apache Kafka on Kubernetes with Strimzi - Part 2_ Creating Producer and Consumer apps using Go and Scala and deploying on Kubernetes - Sina Nourian_files/all.min.css" type="text/css" media="all">
<link rel="stylesheet" id="ct-author-style-css" href="./Apache Kafka on Kubernetes with Strimzi - Part 2_ Creating Producer and Consumer apps using Go and Scala and deploying on Kubernetes - Sina Nourian_files/style.css" type="text/css" media="all">
<script type="text/javascript" src="./Apache Kafka on Kubernetes with Strimzi - Part 2_ Creating Producer and Consumer apps using Go and Scala and deploying on Kubernetes - Sina Nourian_files/jquery.min.js" id="jquery-core-js"></script>
<script type="text/javascript" src="./Apache Kafka on Kubernetes with Strimzi - Part 2_ Creating Producer and Consumer apps using Go and Scala and deploying on Kubernetes - Sina Nourian_files/jquery-migrate.min.js" id="jquery-migrate-js"></script>
<!--[if IE 8]>
<script type='text/javascript' src='https://snourian.com/wp-content/themes/author/js/build/html5shiv.min.js?ver=5.8.6' id='ct-author-html5-shiv-js'></script>
<![endif]-->
<link rel="https://api.w.org/" href="https://snourian.com/wp-json/"><link rel="alternate" type="application/json" href="https://snourian.com/wp-json/wp/v2/posts/70"><link rel="EditURI" type="application/rsd+xml" title="RSD" href="https://snourian.com/xmlrpc.php?rsd">
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="https://snourian.com/wp-includes/wlwmanifest.xml"> 
<meta name="generator" content="WordPress 5.8.6">
<link rel="shortlink" href="https://snourian.com/?p=70">
<link rel="alternate" type="application/json+oembed" href="https://snourian.com/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fsnourian.com%2Fkafka-kubernetes-strimzi-part-2-creating-producer-consumer-using-go-scala-deploying-on-kubernetes%2F">
<link rel="alternate" type="text/xml+oembed" href="https://snourian.com/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fsnourian.com%2Fkafka-kubernetes-strimzi-part-2-creating-producer-consumer-using-go-scala-deploying-on-kubernetes%2F&amp;format=xml">
<!-- Analytics by WP-Statistics v13.1.4 - https://wp-statistics.com/ -->
<link rel="stylesheet" id="CodeMirror-theme-material-css" href="./Apache Kafka on Kubernetes with Strimzi - Part 2_ Creating Producer and Consumer apps using Go and Scala and deploying on Kubernetes - Sina Nourian_files/material.css"><style id="fit-vids-style">.fluid-width-video-wrapper{width:100%;position:relative;padding:0;}.fluid-width-video-wrapper iframe,.fluid-width-video-wrapper object,.fluid-width-video-wrapper embed {position:absolute;top:0;left:0;width:100%;height:100%;}</style></head>

<body id="author" class="post-template-default single single-post postid-70 single-format-standard singular singular-post singular-post-70">
			<a class="skip-content" href="https://snourian.com/kafka-kubernetes-strimzi-part-2-creating-producer-consumer-using-go-scala-deploying-on-kubernetes/#main">Skip to content</a>
		<div id="overflow-container" class="overflow-container">
			<div class="max-width">
				<div id="main-sidebar" class="main-sidebar" style="position: fixed; bottom: 0;">
																<header class="site-header" id="site-header" role="banner">
							<div id="title-container" class="title-container">
																	<div id="site-avatar" class="site-avatar" style="background-image: url(&#39;https://secure.gravatar.com/avatar/f2a0777a10938902cb60e2619b6e0ac3?s=96&amp;d=retro&amp;r=g&#39;)"></div>
																<div class="container">
									<div id="site-title" class="site-title"><a href="https://snourian.com/">Sina Nourian</a></div>									<p class="tagline">Software Developer</p>								</div>
							</div>
							<button id="toggle-navigation" class="toggle-navigation" aria-expanded="false">
								<span class="screen-reader-text">open primary menu</span>
								<i class="fas fa-bars"></i>
							</button>
							<div class="social-media-icons"><ul>						<li>
							<a class="twitter" target="_blank" href="https://twitter.com/sina_nourian">
								<i class="fab fa-twitter-square"></i>
								<span class="screen-reader-text">twitter</span>
															</a>
						</li>
												<li>
							<a class="linkedin" target="_blank" href="http://www.linkedin.com/in/sinanourian">
								<i class="fab fa-linkedin"></i>
								<span class="screen-reader-text">linkedin</span>
															</a>
						</li>
												<li>
							<a class="email" target="_blank" href="mailto:sina.nourian@gmail.com">
								<i class="fas fa-envelope"></i>
								<span class="screen-reader-text">email</span>
							</a>
						</li>
											<li>
							<a class="github" target="_blank" href="https://github.com/nrsina">
								<i class="fab fa-github-square"></i>
								<span class="screen-reader-text">github</span>
															</a>
						</li>
												<li>
							<a class="medium" target="_blank" href="https://snourian.medium.com/">
								<i class="fab fa-medium"></i>
								<span class="screen-reader-text">medium</span>
															</a>
						</li>
												<li>
							<a class="steam" target="_blank" href="https://steamcommunity.com/id/p30sina">
								<i class="fab fa-steam-square"></i>
								<span class="screen-reader-text">steam</span>
															</a>
						</li>
												<li>
							<a class="telegram" target="_blank" href="https://t.me/sina_nourian">
								<i class="fab fa-telegram"></i>
								<span class="screen-reader-text">telegram</span>
															</a>
						</li>
						</ul></div>							<div id="menu-primary" class="menu-container menu-primary" role="navigation">
	<div class="menu-unset"><ul><li class="page_item page-item-17"><a href="https://snourian.com/my-resume/">My Resume</a></li></ul></div></div>						</header>
																<aside class="sidebar sidebar-primary" id="sidebar-primary" role="complementary">
		<h1 class="screen-reader-text">Sidebar</h1>
		<section id="pro_categories_widget-3" class="widget widget_categories"><h2 class="widget-title">Categories</h2>		<ul>
	<li class="cat-item cat-item-2"><a href="https://snourian.com/category/algorithms/" title="Explaining and implementing various algorithms in different programming languages.">Algorithms</a> (0)
</li>
	<li class="cat-item cat-item-7"><a href="https://snourian.com/category/big-data/">Big Data</a> (3)
</li>
	<li class="cat-item cat-item-5"><a href="https://snourian.com/category/golang/">Go</a> (0)
</li>
	<li class="cat-item cat-item-3"><a href="https://snourian.com/category/java/">Java</a> (2)
</li>
	<li class="cat-item cat-item-6"><a href="https://snourian.com/category/kubernetes/">Kubernetes</a> (4)
</li>
	<li class="cat-item cat-item-4"><a href="https://snourian.com/category/scala/">Scala</a> (0)
</li>
		</ul>
</section><section id="search-4" class="widget widget_search"><h2 class="widget-title">Search</h2><div class="search-form-container">
	<form role="search" method="get" class="search-form" action="https://snourian.com/">
		<label class="screen-reader-text" for="search-field">Search</label>
		<input id="search-field" type="search" class="search-field" value="" name="s" title="Search for:">
		<input type="submit" class="search-submit" value="Go">
	</form>
</div></section><section id="tag_cloud-3" class="widget widget_tag_cloud"><h2 class="widget-title">Tags</h2><div class="tagcloud"><a href="https://snourian.com/tag/akka/" class="tag-cloud-link tag-link-20 tag-link-position-1" style="font-size: 8pt;" aria-label="akka (1 item)">akka</a>
<a href="https://snourian.com/tag/alpakka/" class="tag-cloud-link tag-link-13 tag-link-position-2" style="font-size: 8pt;" aria-label="alpakka (1 item)">alpakka</a>
<a href="https://snourian.com/tag/big-data/" class="tag-cloud-link tag-link-15 tag-link-position-3" style="font-size: 8pt;" aria-label="big-data (1 item)">big-data</a>
<a href="https://snourian.com/tag/cdc/" class="tag-cloud-link tag-link-27 tag-link-position-4" style="font-size: 8pt;" aria-label="cdc (1 item)">cdc</a>
<a href="https://snourian.com/tag/debezium/" class="tag-cloud-link tag-link-26 tag-link-position-5" style="font-size: 8pt;" aria-label="debezium (1 item)">debezium</a>
<a href="https://snourian.com/tag/docker/" class="tag-cloud-link tag-link-18 tag-link-position-6" style="font-size: 8pt;" aria-label="docker (1 item)">docker</a>
<a href="https://snourian.com/tag/go/" class="tag-cloud-link tag-link-16 tag-link-position-7" style="font-size: 8pt;" aria-label="go (1 item)">go</a>
<a href="https://snourian.com/tag/grafana/" class="tag-cloud-link tag-link-12 tag-link-position-8" style="font-size: 8pt;" aria-label="grafana (1 item)">grafana</a>
<a href="https://snourian.com/tag/hibernate/" class="tag-cloud-link tag-link-32 tag-link-position-9" style="font-size: 8pt;" aria-label="hibernate (1 item)">hibernate</a>
<a href="https://snourian.com/tag/java/" class="tag-cloud-link tag-link-29 tag-link-position-10" style="font-size: 8pt;" aria-label="java (1 item)">java</a>
<a href="https://snourian.com/tag/jpa/" class="tag-cloud-link tag-link-31 tag-link-position-11" style="font-size: 8pt;" aria-label="jpa (1 item)">jpa</a>
<a href="https://snourian.com/tag/kafka/" class="tag-cloud-link tag-link-8 tag-link-position-12" style="font-size: 22pt;" aria-label="kafka (4 items)">kafka</a>
<a href="https://snourian.com/tag/kubernetes/" class="tag-cloud-link tag-link-10 tag-link-position-13" style="font-size: 22pt;" aria-label="kubernetes (4 items)">kubernetes</a>
<a href="https://snourian.com/tag/micronaut/" class="tag-cloud-link tag-link-23 tag-link-position-14" style="font-size: 14.3pt;" aria-label="micronaut (2 items)">micronaut</a>
<a href="https://snourian.com/tag/monitoring/" class="tag-cloud-link tag-link-22 tag-link-position-15" style="font-size: 8pt;" aria-label="monitoring (1 item)">monitoring</a>
<a href="https://snourian.com/tag/oracle/" class="tag-cloud-link tag-link-24 tag-link-position-16" style="font-size: 8pt;" aria-label="oracle (1 item)">oracle</a>
<a href="https://snourian.com/tag/outbox/" class="tag-cloud-link tag-link-25 tag-link-position-17" style="font-size: 8pt;" aria-label="outbox (1 item)">outbox</a>
<a href="https://snourian.com/tag/prometheus/" class="tag-cloud-link tag-link-11 tag-link-position-18" style="font-size: 8pt;" aria-label="prometheus (1 item)">prometheus</a>
<a href="https://snourian.com/tag/querydsl/" class="tag-cloud-link tag-link-30 tag-link-position-19" style="font-size: 8pt;" aria-label="querydsl (1 item)">querydsl</a>
<a href="https://snourian.com/tag/rest/" class="tag-cloud-link tag-link-34 tag-link-position-20" style="font-size: 8pt;" aria-label="rest (1 item)">rest</a>
<a href="https://snourian.com/tag/saga/" class="tag-cloud-link tag-link-28 tag-link-position-21" style="font-size: 8pt;" aria-label="saga (1 item)">saga</a>
<a href="https://snourian.com/tag/sbt/" class="tag-cloud-link tag-link-19 tag-link-position-22" style="font-size: 8pt;" aria-label="sbt (1 item)">sbt</a>
<a href="https://snourian.com/tag/scala/" class="tag-cloud-link tag-link-17 tag-link-position-23" style="font-size: 8pt;" aria-label="scala (1 item)">scala</a>
<a href="https://snourian.com/tag/sql/" class="tag-cloud-link tag-link-33 tag-link-position-24" style="font-size: 8pt;" aria-label="sql (1 item)">sql</a>
<a href="https://snourian.com/tag/stream-processing/" class="tag-cloud-link tag-link-14 tag-link-position-25" style="font-size: 8pt;" aria-label="stream-processing (1 item)">stream-processing</a>
<a href="https://snourian.com/tag/strimzi/" class="tag-cloud-link tag-link-9 tag-link-position-26" style="font-size: 22pt;" aria-label="strimzi (4 items)">strimzi</a></div>
</section>	</aside>
									</div>
								<section id="main" class="main" role="main" style="min-height: 14444.9px;">
						<div id="loop-container" class="loop-container">
		<div class="post-70 post type-post status-publish format-standard hentry category-big-data category-kubernetes tag-akka tag-alpakka tag-docker tag-go tag-kafka tag-kubernetes tag-sbt tag-scala tag-strimzi entry">
			<article>
		<div class="post-header">
			<h1 class="post-title">Apache Kafka on Kubernetes with Strimzi – Part 2: Creating Producer and Consumer apps using Go and Scala and deploying on Kubernetes</h1>
			<span class="post-meta">
		Published by <a href="https://snourian.com/author/nrsina/">Sina Nourian</a> on <a href="https://snourian.com/2020/10/">October 23, 2020</a></span>		</div>
		<div class="post-content">
						
<p>In the previous post, we have learnt about Strimzi and deployed a Kafka Cluster on Minikube and also tested our cluster. Now, let’s build a Producer application with <strong>Go </strong>and a Consumer application with <strong>Scala </strong>language, deploy them on Kubernetes and see how it all works.</p>



<span id="more-70"></span>



<p>This is the Part 2 of the <em>Apache Kafka on Kubernetes with Strimzi </em>blog post. In case you haven’t read the previous post, I recommend you to check it out:</p>



<ul><li><a href="https://snourian.com/kafka-kubernetes-strimzi-part-1-creating-deploying-strimzi-kafka/">Part 1: Creating and Deploying a Strimzi Kafka Cluster on Kubernetes</a></li><li><strong>Part 2: Creating Producer and Consumer using Go and Scala and deploying on Kubernetes</strong></li><li><a href="https://snourian.com/kafka-kubernetes-strimzi-part-3-monitoring-strimzi-kafka-with-prometheus-grafana">Part 3: Monitoring our Strimzi Kafka Cluster with Prometheus and Grafana</a></li></ul>



<p></p>



<h1>The Producer</h1>



<p>For creating the producer, I would like to use the <strong>Go language</strong>. We’re going to add below dependencies to our module file:</p>



<div class="wp-block-codemirror-blocks-code-block code-block" id="0"><pre class="CodeMirror" data-setting="{&quot;mode&quot;:&quot;null&quot;,&quot;mime&quot;:&quot;text/plain&quot;,&quot;theme&quot;:&quot;material&quot;,&quot;lineNumbers&quot;:false,&quot;styleActiveLine&quot;:false,&quot;lineWrapping&quot;:false,&quot;readOnly&quot;:true,&quot;showPanel&quot;:false,&quot;language&quot;:&quot;Plain Text&quot;,&quot;modeName&quot;:&quot;text&quot;}" id="code-block-0" style="display: none;">github.com/segmentio/kafka-go // Kafka
go.uber.org/zap // Logging
google.golang.org/protobuf // Message Serialization
github.com/urfave/cli/v2 // CLI</pre><div class="CodeMirror CodeMirror-simplescroll cm-s-material"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 4px; left: 4px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;" tabindex="0"></textarea></div><div class="CodeMirror-simplescroll-horizontal" cm-not-content="true" style="display: none;"><div></div></div><div class="CodeMirror-simplescroll-vertical" cm-not-content="true" style="display: none;"><div></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: -15px; border-right-width: 15px; min-height: 86px; min-width: 406.172px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"><div class="CodeMirror-cursor" style="left: 4px; top: 0px; height: 19.5px;">&nbsp;</div></div><div class="CodeMirror-code" role="presentation"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">github.com/segmentio/kafka-go // Kafka</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">go.uber.org/zap // Logging</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">google.golang.org/protobuf // Message Serialization</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">github.com/urfave/cli/v2 // CLI</span></pre></div></div></div></div></div><div style="position: absolute; height: 15px; width: 1px; border-bottom: 0px solid transparent; top: 86px;"></div><div class="CodeMirror-gutters" style="display: none; height: 101px;"></div></div></div></div>



<p>With the help of <em><a href="https://github.com/urfave/cli/">urfave cli</a> </em>library, we can easily add some arguments (cli and environment variables) to our application. The variables we need are:</p>



<ul><li>Kafka Bootstrap servers</li><li>Topic name</li><li>Buffer size (for batching messages)</li><li>Sleep time between producing messages</li></ul>



<p>Check out the code on my <a href="https://github.com/nrsina/strimzi-kafka-tutorial">Github</a> to see how I leveraged this library to easily add and use these arguments.</p>



<p>Let’s create <em>kafka.go</em> file with two methods in it. One for creating a producer and one for creating a consumer (Although we are going to only use the producer, but I wanted to show you how to create a consumer too).</p>



<div class="wp-block-codemirror-blocks-code-block code-block" id="1"><pre class="CodeMirror" data-setting="{&quot;mode&quot;:&quot;go&quot;,&quot;mime&quot;:&quot;text/x-go&quot;,&quot;theme&quot;:&quot;material&quot;,&quot;lineNumbers&quot;:true,&quot;styleActiveLine&quot;:false,&quot;lineWrapping&quot;:false,&quot;readOnly&quot;:true,&quot;language&quot;:&quot;Go&quot;,&quot;modeName&quot;:&quot;go&quot;}" id="code-block-1" style="display: none;">package kafka

import (
	"github.com/segmentio/kafka-go"
	log "strimzi-producer/internal/platform/logger"
)

func Consumer(servers []string, groupId string, topic string) *kafka.Reader {
	return kafka.NewReader(kafka.ReaderConfig{
		Brokers:  servers, //[]string{"localhost:9092"},
		GroupID:  groupId,
		Topic:    topic,
		MinBytes: 10e3, // 10KB
		MaxBytes: 10e6, // 10MB
		Logger:      kafka.LoggerFunc(log.Logger.Infof),
		ErrorLogger: kafka.LoggerFunc(log.Logger.Errorf),
	})
}

func Producer(servers []string, topic string) *kafka.Writer {
	return &amp;kafka.Writer{
		Addr:         kafka.TCP(servers...),
		Topic:        topic,
		RequiredAcks: kafka.RequireOne,
		Logger:      kafka.LoggerFunc(log.Logger.Infof),
		ErrorLogger: kafka.LoggerFunc(log.Logger.Errorf),
	}
}
</pre><div class="CodeMirror CodeMirror-simplescroll cm-s-material"><div class="CodeMirror-panel"><div class="info-panel"><span class="language go go">Go</span><div class="control-panel"><span class="tool" data-tip="Full Screen"><b class="fullscreen maximize"></b></span><span class="tool" data-tip="Copy Code"><b class="copy"></b></span></div></div></div><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 36px; left: 33px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;" tabindex="0"></textarea></div><div class="CodeMirror-simplescroll-horizontal" cm-not-content="true" style="display: block; right: 0px; left: 29px;"><div style="width: 577.586px; left: 0px;"></div></div><div class="CodeMirror-simplescroll-vertical adjest-top" cm-not-content="true" style="display: none; bottom: 8px;"><div style="height: 91.8894px; top: 0px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true" style="height: 8px; width: 8px;"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 29px; margin-bottom: -15px; border-right-width: 15px; min-height: 574px; min-width: 609.766px; padding-right: 0px; padding-bottom: 8px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><div class="CodeMirror-linenumber CodeMirror-gutter-elt"><div>29</div></div></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"><div class="CodeMirror-cursor" style="left: 4px; top: 0px; height: 19.5px;">&nbsp;</div></div><div class="CodeMirror-code" role="presentation" style=""><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">package</span> <span class="cm-variable">kafka</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">2</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">3</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">import</span> (</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">4</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-string">"github.com/segmentio/kafka-go"</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">5</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">log</span> <span class="cm-string">"strimzi-producer/internal/platform/logger"</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">6</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">)</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">7</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">8</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">func</span> <span class="cm-variable">Consumer</span>(<span class="cm-variable">servers</span> []<span class="cm-keyword">string</span>, <span class="cm-variable">groupId</span> <span class="cm-keyword">string</span>, <span class="cm-variable">topic</span> <span class="cm-keyword">string</span>) <span class="cm-operator">*</span><span class="cm-variable">kafka</span><span class="cm-number">.</span><span class="cm-variable">Reader</span> {</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">9</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">return</span> <span class="cm-variable">kafka</span><span class="cm-number">.</span><span class="cm-variable">NewReader</span>(<span class="cm-variable">kafka</span><span class="cm-number">.</span><span class="cm-variable">ReaderConfig</span>{</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">10</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">Brokers</span>:  <span class="cm-variable">servers</span>, <span class="cm-comment">//[]string{"localhost:9092"},</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">11</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">GroupID</span>:  <span class="cm-variable">groupId</span>,</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">12</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">Topic</span>:    <span class="cm-variable">topic</span>,</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">13</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">MinBytes</span>: <span class="cm-number">10e3</span>, <span class="cm-comment">// 10KB</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">14</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">MaxBytes</span>: <span class="cm-number">10e6</span>, <span class="cm-comment">// 10MB</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">15</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">Logger</span>:      <span class="cm-variable">kafka</span><span class="cm-number">.</span><span class="cm-variable">LoggerFunc</span>(<span class="cm-variable">log</span><span class="cm-number">.</span><span class="cm-variable">Logger</span><span class="cm-number">.</span><span class="cm-variable">Infof</span>),</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">16</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">ErrorLogger</span>: <span class="cm-variable">kafka</span><span class="cm-number">.</span><span class="cm-variable">LoggerFunc</span>(<span class="cm-variable">log</span><span class="cm-number">.</span><span class="cm-variable">Logger</span><span class="cm-number">.</span><span class="cm-variable">Errorf</span>),</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">17</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span>})</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">18</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">19</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">20</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">func</span> <span class="cm-variable">Producer</span>(<span class="cm-variable">servers</span> []<span class="cm-keyword">string</span>, <span class="cm-variable">topic</span> <span class="cm-keyword">string</span>) <span class="cm-operator">*</span><span class="cm-variable">kafka</span><span class="cm-number">.</span><span class="cm-variable">Writer</span> {</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">21</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">return</span> <span class="cm-operator">&amp;</span><span class="cm-variable">kafka</span><span class="cm-number">.</span><span class="cm-variable">Writer</span>{</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">22</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">Addr</span>:         <span class="cm-variable">kafka</span><span class="cm-number">.</span><span class="cm-variable">TCP</span>(<span class="cm-variable">servers</span><span class="cm-number">...</span>),</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">23</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">Topic</span>:        <span class="cm-variable">topic</span>,</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">24</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">RequiredAcks</span>: <span class="cm-variable">kafka</span><span class="cm-number">.</span><span class="cm-variable">RequireOne</span>,</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">25</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">Logger</span>:      <span class="cm-variable">kafka</span><span class="cm-number">.</span><span class="cm-variable">LoggerFunc</span>(<span class="cm-variable">log</span><span class="cm-number">.</span><span class="cm-variable">Logger</span><span class="cm-number">.</span><span class="cm-variable">Infof</span>),</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">26</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">ErrorLogger</span>: <span class="cm-variable">kafka</span><span class="cm-number">.</span><span class="cm-variable">LoggerFunc</span>(<span class="cm-variable">log</span><span class="cm-number">.</span><span class="cm-variable">Logger</span><span class="cm-number">.</span><span class="cm-variable">Errorf</span>),</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">27</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span>}</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">28</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">29</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 15px; width: 1px; border-bottom: 8px solid transparent; top: 574px;"></div><div class="CodeMirror-gutters" style="height: 597px; left: 0px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div></div></div>



<p>Now, let’s create a very simple message schema using Protobuf and generate Go output using <em>protoc</em>:</p>



<div class="wp-block-codemirror-blocks-code-block code-block" id="2"><pre class="CodeMirror" data-setting="{&quot;mode&quot;:&quot;protobuf&quot;,&quot;mime&quot;:&quot;text/x-protobuf&quot;,&quot;theme&quot;:&quot;material&quot;,&quot;lineNumbers&quot;:true,&quot;styleActiveLine&quot;:false,&quot;lineWrapping&quot;:false,&quot;readOnly&quot;:true,&quot;language&quot;:&quot;ProtoBuf&quot;,&quot;modeName&quot;:&quot;protobuf&quot;}" id="code-block-2" style="display: none;">syntax = "proto3";

package producer;

option go_package = "producer";

message MyMessage {
  int32 id = 1;
  string message = 2;
}</pre><div class="CodeMirror CodeMirror-simplescroll cm-s-material"><div class="CodeMirror-panel"><div class="info-panel"><span class="language protobuf protobuf">ProtoBuf</span><div class="control-panel"><span class="tool" data-tip="Full Screen"><b class="fullscreen maximize"></b></span><span class="tool" data-tip="Copy Code"><b class="copy"></b></span></div></div></div><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 36px; left: 33px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;" tabindex="0"></textarea></div><div class="CodeMirror-simplescroll-horizontal" cm-not-content="true" style="display: none;"><div></div></div><div class="CodeMirror-simplescroll-vertical adjest-top" cm-not-content="true" style="display: none;"><div></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 29px; margin-bottom: -15px; border-right-width: 15px; min-height: 203px; min-width: 249.672px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><div class="CodeMirror-linenumber CodeMirror-gutter-elt"><div>10</div></div></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"><div class="CodeMirror-cursor" style="left: 4px; top: 0px; height: 19.5px;">&nbsp;</div></div><div class="CodeMirror-code" role="presentation" style=""><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">syntax</span> = <span class="cm-string">"proto3"</span>;</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">2</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">3</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">package</span> <span class="cm-variable">producer</span>;</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">4</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">5</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">option</span> <span class="cm-variable">go_package</span> = <span class="cm-string">"producer"</span>;</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">6</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">7</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">message</span> <span class="cm-variable">MyMessage</span> {</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">8</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  <span class="cm-keyword">int32</span> <span class="cm-variable">id</span> = <span class="cm-number">1</span>;</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">9</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  <span class="cm-keyword">string</span> <span class="cm-keyword">message</span> = <span class="cm-number">2</span>;</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">10</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 15px; width: 1px; border-bottom: 0px solid transparent; top: 203px;"></div><div class="CodeMirror-gutters" style="height: 218px; left: 0px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div></div></div>



<p>And here’s the code that creates and produces messages to Kafka:</p>



<div class="wp-block-codemirror-blocks-code-block code-block" id="3"><pre class="CodeMirror" data-setting="{&quot;mode&quot;:&quot;go&quot;,&quot;mime&quot;:&quot;text/x-go&quot;,&quot;theme&quot;:&quot;material&quot;,&quot;lineNumbers&quot;:true,&quot;styleActiveLine&quot;:false,&quot;lineWrapping&quot;:false,&quot;readOnly&quot;:true,&quot;language&quot;:&quot;Go&quot;,&quot;modeName&quot;:&quot;go&quot;}" id="code-block-3" style="display: none;">package producer

import (
	"context"
	"fmt"
	"github.com/segmentio/kafka-go"
	"google.golang.org/protobuf/proto"
	"math/rand"
	"strconv"
	log "strimzi-producer/internal/platform/logger"
	"time"
)

type client struct {
	sleepTime time.Duration
	bufferSize uint
	writer    *kafka.Writer
}

func NewProducerClient(sleepTime time.Duration, bufferSize uint, writer *kafka.Writer) *client {
	return &amp;client{
		sleepTime: sleepTime,
		bufferSize: bufferSize,
		writer:    writer,
	}
}

func (c *client) Produce() {
	log.Logger.Info("Starting the Producer...")
	for {
		buffer := make([]kafka.Message, c.bufferSize)
		var j uint
		for j = 0; j &lt; c.bufferSize; j++ {
			id := strconv.Itoa(rand.Int())
			msg := MyMessage{
				Id:      id,
				Message: fmt.Sprintf("Just a message with a random number: %d", rand.Int()),
			}
			bytes, err := proto.Marshal(&amp;msg)
			if err != nil {
				log.Logger.Errorf("Error in marshaling the message: %s", err.Error())
				return
			}
			buffer[j] = kafka.Message{
				Key:   []byte(id),
				Value: bytes,
			}
		}
		err := c.writer.WriteMessages(context.Background(), buffer...)
		log.Logger.Debugf("Sent %d messages to the topic", len(buffer))
		if err != nil {
			log.Logger.Errorf("Error in producing message to Kafka: %s", err.Error())
			return
		}
		time.Sleep(c.sleepTime)
	}
}</pre><div class="CodeMirror CodeMirror-simplescroll cm-s-material"><div class="CodeMirror-panel"><div class="info-panel"><span class="language go go">Go</span><div class="control-panel"><span class="tool" data-tip="Full Screen"><b class="fullscreen maximize"></b></span><span class="tool" data-tip="Copy Code"><b class="copy"></b></span></div></div></div><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 36px; left: 33px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;" tabindex="0"></textarea></div><div class="CodeMirror-simplescroll-horizontal" cm-not-content="true" style="display: block; right: 0px; left: 29px;"><div style="width: 470.999px; left: 0px;"></div></div><div class="CodeMirror-simplescroll-vertical adjest-top" cm-not-content="true" style="display: none; bottom: 8px;"><div style="height: 47.9948px; top: 0px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true" style="height: 8px; width: 8px;"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 29px; margin-bottom: -15px; border-right-width: 15px; min-height: 1120px; min-width: 758.484px; padding-right: 0px; padding-bottom: 8px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><div class="CodeMirror-linenumber CodeMirror-gutter-elt"><div>57</div></div></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"><div class="CodeMirror-cursor" style="left: 4px; top: 0px; height: 19.5px;">&nbsp;</div></div><div class="CodeMirror-code" role="presentation" style=""><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">package</span> <span class="cm-variable">producer</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">2</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">3</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">import</span> (</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">4</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-string">"context"</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">5</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-string">"fmt"</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">6</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-string">"github.com/segmentio/kafka-go"</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">7</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-string">"google.golang.org/protobuf/proto"</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">8</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-string">"math/rand"</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">9</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-string">"strconv"</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">10</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">log</span> <span class="cm-string">"strimzi-producer/internal/platform/logger"</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">11</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-string">"time"</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">12</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">)</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">13</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">14</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">type</span> <span class="cm-variable">client</span> <span class="cm-keyword">struct</span> {</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">15</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">sleepTime</span> <span class="cm-variable">time</span><span class="cm-number">.</span><span class="cm-variable">Duration</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">16</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">bufferSize</span> <span class="cm-keyword">uint</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">17</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">writer</span>    <span class="cm-operator">*</span><span class="cm-variable">kafka</span><span class="cm-number">.</span><span class="cm-variable">Writer</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">18</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">19</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">20</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">func</span> <span class="cm-variable">NewProducerClient</span>(<span class="cm-variable">sleepTime</span> <span class="cm-variable">time</span><span class="cm-number">.</span><span class="cm-variable">Duration</span>, <span class="cm-variable">bufferSize</span> <span class="cm-keyword">uint</span>, <span class="cm-variable">writer</span> <span class="cm-operator">*</span><span class="cm-variable">kafka</span><span class="cm-number">.</span><span class="cm-variable">Writer</span>) <span class="cm-operator">*</span><span class="cm-variable">client</span> {</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">21</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">return</span> <span class="cm-operator">&amp;</span><span class="cm-variable">client</span>{</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">22</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">sleepTime</span>: <span class="cm-variable">sleepTime</span>,</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">23</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">bufferSize</span>: <span class="cm-variable">bufferSize</span>,</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">24</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">writer</span>:    <span class="cm-variable">writer</span>,</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">25</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span>}</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">26</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">27</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">28</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">func</span> (<span class="cm-variable">c</span> <span class="cm-operator">*</span><span class="cm-variable">client</span>) <span class="cm-variable">Produce</span>() {</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">29</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">log</span><span class="cm-number">.</span><span class="cm-variable">Logger</span><span class="cm-number">.</span><span class="cm-variable">Info</span>(<span class="cm-string">"Starting the Producer..."</span>)</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">30</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">for</span> {</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">31</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">buffer</span> :<span class="cm-operator">=</span> <span class="cm-atom">make</span>([]<span class="cm-variable">kafka</span><span class="cm-number">.</span><span class="cm-variable">Message</span>, <span class="cm-variable">c</span><span class="cm-number">.</span><span class="cm-variable">bufferSize</span>)</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">32</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">var</span> <span class="cm-variable">j</span> <span class="cm-keyword">uint</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">33</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">for</span> <span class="cm-variable">j</span> <span class="cm-operator">=</span> <span class="cm-number">0</span>; <span class="cm-variable">j</span> <span class="cm-operator">&lt;</span> <span class="cm-variable">c</span><span class="cm-number">.</span><span class="cm-variable">bufferSize</span>; <span class="cm-variable">j</span><span class="cm-operator">++</span> {</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">34</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">id</span> :<span class="cm-operator">=</span> <span class="cm-variable">strconv</span><span class="cm-number">.</span><span class="cm-variable">Itoa</span>(<span class="cm-variable">rand</span><span class="cm-number">.</span><span class="cm-variable">Int</span>())</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">35</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">msg</span> :<span class="cm-operator">=</span> <span class="cm-variable">MyMessage</span>{</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">36</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">Id</span>:      <span class="cm-variable">id</span>,</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">37</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">Message</span>: <span class="cm-variable">fmt</span><span class="cm-number">.</span><span class="cm-variable">Sprintf</span>(<span class="cm-string">"Just a message with a random number: %d"</span>, <span class="cm-variable">rand</span><span class="cm-number">.</span><span class="cm-variable">Int</span>()),</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">38</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span>}</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">39</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">bytes</span>, <span class="cm-variable">err</span> :<span class="cm-operator">=</span> <span class="cm-variable">proto</span><span class="cm-number">.</span><span class="cm-variable">Marshal</span>(<span class="cm-operator">&amp;</span><span class="cm-variable">msg</span>)</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">40</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">if</span> <span class="cm-variable">err</span> <span class="cm-operator">!=</span> <span class="cm-atom">nil</span> {</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">41</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">log</span><span class="cm-number">.</span><span class="cm-variable">Logger</span><span class="cm-number">.</span><span class="cm-variable">Errorf</span>(<span class="cm-string">"Error in marshaling the message: %s"</span>, <span class="cm-variable">err</span><span class="cm-number">.</span><span class="cm-variable">Error</span>())</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">42</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">return</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">43</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span>}</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">44</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">buffer</span>[<span class="cm-variable">j</span>] <span class="cm-operator">=</span> <span class="cm-variable">kafka</span><span class="cm-number">.</span><span class="cm-variable">Message</span>{</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">45</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">Key</span>:   []<span class="cm-keyword">byte</span>(<span class="cm-variable">id</span>),</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">46</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">Value</span>: <span class="cm-variable">bytes</span>,</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">47</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span>}</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">48</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span>}</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">49</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">err</span> :<span class="cm-operator">=</span> <span class="cm-variable">c</span><span class="cm-number">.</span><span class="cm-variable">writer</span><span class="cm-number">.</span><span class="cm-variable">WriteMessages</span>(<span class="cm-variable">context</span><span class="cm-number">.</span><span class="cm-variable">Background</span>(), <span class="cm-variable">buffer</span><span class="cm-number">...</span>)</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">50</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">log</span><span class="cm-number">.</span><span class="cm-variable">Logger</span><span class="cm-number">.</span><span class="cm-variable">Debugf</span>(<span class="cm-string">"Sent %d messages to the topic"</span>, <span class="cm-atom">len</span>(<span class="cm-variable">buffer</span>))</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">51</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">if</span> <span class="cm-variable">err</span> <span class="cm-operator">!=</span> <span class="cm-atom">nil</span> {</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">52</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">log</span><span class="cm-number">.</span><span class="cm-variable">Logger</span><span class="cm-number">.</span><span class="cm-variable">Errorf</span>(<span class="cm-string">"Error in producing message to Kafka: %s"</span>, <span class="cm-variable">err</span><span class="cm-number">.</span><span class="cm-variable">Error</span>())</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">53</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">return</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">54</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span>}</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">55</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">time</span><span class="cm-number">.</span><span class="cm-variable">Sleep</span>(<span class="cm-variable">c</span><span class="cm-number">.</span><span class="cm-variable">sleepTime</span>)</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">56</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span>}</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">57</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 15px; width: 1px; border-bottom: 8px solid transparent; top: 1120px;"></div><div class="CodeMirror-gutters" style="height: 1143px; left: 0px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div></div></div>



<p>In the code above, we are putting serialized messages inside a <em>buffer </em>slice and produce them to Kafka as a batch.</p>



<p>There are some other (not complicated) parts in this project (health check api, graceful shutdown, …). Since they’re out of the scope of this article and also to keep this post shorter, I don’t explain them here. Please visit the project on my <a href="https://github.com/nrsina/strimzi-kafka-tutorial">Github </a>for full code and feel free to contact me or leave a comment if you have any question or suggestion on any part of the code.</p>



<p>Now, In order to deploy our Producer to the Kubernetes, we need to create a Dockerfile:</p>



<div class="wp-block-codemirror-blocks-code-block code-block" id="4"><pre class="CodeMirror" data-setting="{&quot;mode&quot;:&quot;dockerfile&quot;,&quot;mime&quot;:&quot;text/x-dockerfile&quot;,&quot;theme&quot;:&quot;material&quot;,&quot;lineNumbers&quot;:true,&quot;styleActiveLine&quot;:false,&quot;lineWrapping&quot;:false,&quot;readOnly&quot;:true,&quot;language&quot;:&quot;Dockerfile&quot;,&quot;modeName&quot;:&quot;docker&quot;}" id="code-block-4" style="display: none;">FROM golang:1.15-alpine
LABEL maintainer="Sina Nourian &lt;sina.nourian@gmail.com&gt;"
WORKDIR /app
COPY . .
RUN go mod download
RUN go build -o producer ./cmd/producer
CMD ["./producer"]</pre><div class="CodeMirror CodeMirror-simplescroll cm-s-material"><div class="CodeMirror-panel"><div class="info-panel"><span class="language dockerfile docker">Dockerfile</span><div class="control-panel"><span class="tool" data-tip="Full Screen"><b class="fullscreen maximize"></b></span><span class="tool" data-tip="Copy Code"><b class="copy"></b></span></div></div></div><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 36px; left: 33px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;" tabindex="0"></textarea></div><div class="CodeMirror-simplescroll-horizontal" cm-not-content="true" style="display: none;"><div></div></div><div class="CodeMirror-simplescroll-vertical adjest-top" cm-not-content="true" style="display: none;"><div></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 29px; margin-bottom: -15px; border-right-width: 15px; min-height: 145px; min-width: 445.312px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><div class="CodeMirror-linenumber CodeMirror-gutter-elt"><div>7</div></div></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"><div class="CodeMirror-cursor" style="left: 4px; top: 0px; height: 19.5px;">&nbsp;</div></div><div class="CodeMirror-code" role="presentation" style=""><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">FROM</span> golang:1.15-alpine</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">2</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">LABEL</span> maintainer=<span class="cm-string">"Sina Nourian &lt;sina.nourian@gmail.com&gt;"</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">3</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">WORKDIR</span> /app</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">4</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">COPY</span> . .</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">5</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">RUN</span> go mod download</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">6</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">RUN</span> go build -o producer ./cmd/producer</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">7</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">CMD</span> [<span class="cm-string">"./producer"</span>]</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 15px; width: 1px; border-bottom: 0px solid transparent; top: 145px;"></div><div class="CodeMirror-gutters" style="height: 160px; left: 0px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div></div></div>



<p>Let’s build our Dockerfile and publish it to our local repository:</p>



<div class="wp-block-codemirror-blocks-code-block code-block" id="5"><pre class="CodeMirror" data-setting="{&quot;mode&quot;:&quot;shell&quot;,&quot;mime&quot;:&quot;text/x-sh&quot;,&quot;theme&quot;:&quot;material&quot;,&quot;lineNumbers&quot;:false,&quot;styleActiveLine&quot;:false,&quot;lineWrapping&quot;:false,&quot;readOnly&quot;:true,&quot;showPanel&quot;:false,&quot;language&quot;:&quot;Shell&quot;,&quot;modeName&quot;:&quot;shell&quot;}" id="code-block-5" style="display: none;">$ docker build -t nrsina/strimzi-producer:v1 .</pre><div class="CodeMirror CodeMirror-simplescroll cm-s-material"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 4px; left: 4px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;" tabindex="0"></textarea></div><div class="CodeMirror-simplescroll-horizontal" cm-not-content="true" style="display: none;"><div></div></div><div class="CodeMirror-simplescroll-vertical" cm-not-content="true" style="display: none;"><div></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: -15px; border-right-width: 15px; min-height: 28px; min-width: 367.062px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"><div class="CodeMirror-cursor" style="left: 4px; top: 0px; height: 19.5px;">&nbsp;</div></div><div class="CodeMirror-code" role="presentation"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">$ docker</span> build <span class="cm-attribute">-t</span> nrsina/strimzi-producer:v1 .</span></pre></div></div></div></div></div><div style="position: absolute; height: 15px; width: 1px; border-bottom: 0px solid transparent; top: 28px;"></div><div class="CodeMirror-gutters" style="display: none; height: 43px;"></div></div></div></div>



<p>And also a Kubernetes Deployment file to deploy the Producer on Kubernetes:</p>



<div class="wp-block-codemirror-blocks-code-block code-block" id="6"><pre class="CodeMirror" data-setting="{&quot;mode&quot;:&quot;yaml&quot;,&quot;mime&quot;:&quot;text/x-yaml&quot;,&quot;theme&quot;:&quot;material&quot;,&quot;lineNumbers&quot;:true,&quot;styleActiveLine&quot;:false,&quot;lineWrapping&quot;:false,&quot;readOnly&quot;:true,&quot;language&quot;:&quot;YAML&quot;,&quot;modeName&quot;:&quot;yaml&quot;}" id="code-block-6" style="display: none;">apiVersion: apps/v1
kind: Deployment
metadata:
  name: strimzi-producer-deployment
spec:
  replicas: 1
  selector:
    matchLabels:
      app: strimzi-producer
  template:
    metadata:
      labels:
        app: strimzi-producer
    spec:
      containers:
      - name: strimzi-producer
        image: nrsina/strimzi-producer:v1
        imagePullPolicy: Never
        ports:
        - name: http
          containerPort: 8080
          protocol: TCP
        livenessProbe:
          httpGet:
            path: /health
            port: http
            scheme: HTTP
          initialDelaySeconds: 3
          timeoutSeconds: 1
          periodSeconds: 15
        readinessProbe:
          httpGet:
            path: /health
            port: http
            scheme: HTTP
          initialDelaySeconds: 3
          timeoutSeconds: 1
          periodSeconds: 15
        env:
        - name: SP_SERVE_ADDR
          value: ":8080"
        - name: SP_BOOTSTRAP_SERVERS
          value: "my-cluster-kafka-bootstrap.kafka:9092"
        - name: SP_KAFKA_TOPIC
          value: "my-topic"
        - name: SP_SLEEP_TIME_MS
          value: "2000ms"
        - name: SP_BUFFER_SIZE
          value: "5"</pre><div class="CodeMirror CodeMirror-simplescroll cm-s-material"><div class="CodeMirror-panel"><div class="info-panel"><span class="language yaml yaml">YAML</span><div class="control-panel"><span class="tool" data-tip="Full Screen"><b class="fullscreen maximize"></b></span><span class="tool" data-tip="Copy Code"><b class="copy"></b></span></div></div></div><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 36px; left: 33px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;" tabindex="0"></textarea></div><div class="CodeMirror-simplescroll-horizontal" cm-not-content="true" style="display: none;"><div></div></div><div class="CodeMirror-simplescroll-vertical adjest-top" cm-not-content="true" style="display: none; bottom: 0px;"><div style="height: 54.2125px; top: 0px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 29px; margin-bottom: -15px; border-right-width: 15px; min-height: 964px; min-width: 445.312px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><div class="CodeMirror-linenumber CodeMirror-gutter-elt"><div>49</div></div></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"><div class="CodeMirror-cursor" style="left: 4px; top: 0px; height: 19.5px;">&nbsp;</div></div><div class="CodeMirror-code" role="presentation" style=""><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-atom">apiVersion</span><span class="cm-meta">: </span>apps/v1</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">2</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-atom">kind</span><span class="cm-meta">: </span>Deployment</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">3</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-atom">metadata</span><span class="cm-meta">:</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">4</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-atom">  name</span><span class="cm-meta">: </span>strimzi-producer-deployment</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">5</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-atom">spec</span><span class="cm-meta">:</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">6</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-atom">  replicas</span><span class="cm-meta">: </span><span class="cm-number">1</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">7</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-atom">  selector</span><span class="cm-meta">:</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">8</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-atom">    matchLabels</span><span class="cm-meta">:</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">9</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-atom">      app</span><span class="cm-meta">: </span>strimzi-producer</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">10</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-atom">  template</span><span class="cm-meta">:</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">11</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-atom">    metadata</span><span class="cm-meta">:</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">12</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-atom">      labels</span><span class="cm-meta">:</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">13</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-atom">        app</span><span class="cm-meta">: </span>strimzi-producer</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">14</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-atom">    spec</span><span class="cm-meta">:</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">15</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-atom">      containers</span><span class="cm-meta">:</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">16</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-meta">      - </span><span class="cm-atom">name</span><span class="cm-meta">: </span>strimzi-producer</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">17</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-atom">        image</span><span class="cm-meta">: </span>nrsina/strimzi-producer<span class="cm-meta">:</span>v1</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">18</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-atom">        imagePullPolicy</span><span class="cm-meta">: </span>Never</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">19</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-atom">        ports</span><span class="cm-meta">:</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">20</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-meta">        - </span><span class="cm-atom">name</span><span class="cm-meta">: </span>http</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">21</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-atom">          containerPort</span><span class="cm-meta">: </span><span class="cm-number">8080</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">22</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-atom">          protocol</span><span class="cm-meta">: </span>TCP</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">23</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-atom">        livenessProbe</span><span class="cm-meta">:</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">24</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-atom">          httpGet</span><span class="cm-meta">:</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">25</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-atom">            path</span><span class="cm-meta">: </span>/health</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">26</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-atom">            port</span><span class="cm-meta">: </span>http</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">27</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-atom">            scheme</span><span class="cm-meta">: </span>HTTP</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">28</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-atom">          initialDelaySeconds</span><span class="cm-meta">: </span><span class="cm-number">3</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">29</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-atom">          timeoutSeconds</span><span class="cm-meta">: </span><span class="cm-number">1</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">30</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-atom">          periodSeconds</span><span class="cm-meta">: </span><span class="cm-number">15</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">31</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-atom">        readinessProbe</span><span class="cm-meta">:</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">32</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-atom">          httpGet</span><span class="cm-meta">:</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">33</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-atom">            path</span><span class="cm-meta">: </span>/health</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">34</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-atom">            port</span><span class="cm-meta">: </span>http</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">35</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-atom">            scheme</span><span class="cm-meta">: </span>HTTP</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">36</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-atom">          initialDelaySeconds</span><span class="cm-meta">: </span><span class="cm-number">3</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">37</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-atom">          timeoutSeconds</span><span class="cm-meta">: </span><span class="cm-number">1</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">38</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-atom">          periodSeconds</span><span class="cm-meta">: </span><span class="cm-number">15</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">39</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-atom">        env</span><span class="cm-meta">:</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">40</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-meta">        - </span><span class="cm-atom">name</span><span class="cm-meta">: </span>SP_SERVE_ADDR</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">41</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-atom">          value</span><span class="cm-meta">: </span><span class="cm-string">":8080"</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">42</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-meta">        - </span><span class="cm-atom">name</span><span class="cm-meta">: </span>SP_BOOTSTRAP_SERVERS</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">43</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-atom">          value</span><span class="cm-meta">: </span><span class="cm-string">"my-cluster-kafka-bootstrap.kafka:9092"</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">44</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-meta">        - </span><span class="cm-atom">name</span><span class="cm-meta">: </span>SP_KAFKA_TOPIC</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">45</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-atom">          value</span><span class="cm-meta">: </span><span class="cm-string">"my-topic"</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">46</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-meta">        - </span><span class="cm-atom">name</span><span class="cm-meta">: </span>SP_SLEEP_TIME_MS</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">47</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-atom">          value</span><span class="cm-meta">: </span><span class="cm-string">"2000ms"</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">48</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-meta">        - </span><span class="cm-atom">name</span><span class="cm-meta">: </span>SP_BUFFER_SIZE</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">49</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-atom">          value</span><span class="cm-meta">: </span><span class="cm-string">"5"</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 15px; width: 1px; border-bottom: 0px solid transparent; top: 964px;"></div><div class="CodeMirror-gutters" style="height: 979px; left: 0px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div></div></div>



<p>Let’s apply our deployment file, wait for the pod to start and get the logs from the pod:</p>



<figure class="wp-block-image size-large"><a href="http://snourian.com/wp-content/uploads/2020/10/strimzi-producer.png" target="_blank" rel="noopener noreferrer"><img loading="lazy" width="1024" height="211" src="./Apache Kafka on Kubernetes with Strimzi - Part 2_ Creating Producer and Consumer apps using Go and Scala and deploying on Kubernetes - Sina Nourian_files/strimzi-producer-1024x211.png" alt="" class="wp-image-115" srcset="https://snourian.com/wp-content/uploads/2020/10/strimzi-producer-1024x211.png 1024w, https://snourian.com/wp-content/uploads/2020/10/strimzi-producer-300x62.png 300w, https://snourian.com/wp-content/uploads/2020/10/strimzi-producer-768x158.png 768w, https://snourian.com/wp-content/uploads/2020/10/strimzi-producer-1100x227.png 1100w, https://snourian.com/wp-content/uploads/2020/10/strimzi-producer.png 1174w" sizes="(max-width: 1024px) 100vw, 1024px"></a><figcaption>Deploying Strimzi Producer app in Kubernetes</figcaption></figure>



<p>As you can see from the above screenshot, our producer is up and running. Awesome! Now, let’s get our hands dirty with the Consumer…</p>



<h1>The Consumer</h1>



<p id="block-8dd2e77a-fc15-4865-b006-b510da1d9f51">For our consumer, we’re going to build a consumer using the <strong>Scala language</strong> with <strong>Alpakka Kafka</strong> library which is an impressive Kafka library by <em>Lightbend</em>. By scaling our consumer, we can see how <em>Consumer Group</em> works. But before jumping into the code, I’d like to talk a little bit about <strong>Delivery Semantics </strong>(Delivery Guarantees) since it’s a very important issue to consider when using any stream processing framework.</p>



<h2>Delivery Semantics</h2>



<p>Kafka uses a <strong>dumb broker / smart consumer</strong> design. The broker only keeps the messages for a certain amount of time and consumers should keep track of their offset in partitions of the topic. So the developer should configure the consumer based on the business needs. We have three delivery semantics:</p>



<ul><li><strong>At most once.</strong> This is the most relaxed semantic. With this semantic, message might get processed one time or not at all (message can get lost and it cannot be redelivered). This semantic happens when the commitment of the offsets has nothing to to with the processing of the message.<br>By setting the <strong><em>enable.auto.commit</em> </strong>property of the consumer to <em>true</em>, the consumer offsets will be periodically committed in the background. So we have no control on the offsets and if the process of a message fails, the consumer can’t request the message from the topic again since the offset has been committed before and moved passed the failed message.</li><li><strong>At least once.</strong> This semantic ensures that a message may never get lost but may get redelivered. So the message might get processed more than one time (but never lost). When this delivery semantic is needed, the consumer has to take control of the offset committing.<br>The commitment should happen <strong>after the processing of the message is done</strong>. So if the process fails, no offset will be committed. And on the next pull from the topic, the failed message will get redelivered again.<br>Bear in mind that with this approach, the processing of a message may be successful but the committing fails for any reason. So then again the message will be redelivered. This is because our processing (for example, persisting in a database) and committing the offsets in Kafka are not in a single transaction. (The <em><strong>enable.auto.commit</strong></em> property should be false since we need to take control of the offset committing).</li><li><strong>Exactly once.</strong> This semantic guarantees that the processing of the message happens <strong>only once</strong>. This is the most strong semantic. When we want to have exactly once semantics, the process and committing of the message <strong>should happen in a single transaction</strong>.<br>For example, if we are persisting the message in PostgreSQL, we should also persist the offsets in the same database so we can easily wrap both of them in a single transaction. If the persisting of the offset fails, the persisting of the message will also roll backs and vice versa. </li></ul>



<p>You may ask why not always use exactly once semantics? Sounds like it’s the best approach! That may be true but you have to take the overhead it causes into the consideration. So use the semantic that best meets your business requirements.</p>



<h2>Creating the Consumer</h2>



<p>We are using <strong>Akka </strong>for this project. Akka is a toolkit consisting of many open-source libraries for designing concurrent, distributed and resilient applications by leveraging Actor Model. Akka uses Actor model which provides a high level of abstraction for building concurrent applications and alleviates the developer from dealing with low-level thread management and locking. Actors are single and independent units that encapsulate state and behavior and they communicate with other actors via message passing. A hierarchy of actors can be formed in Akka. Refer to <a href="https://doc.akka.io/docs/akka/current/general/index.html">Akka’s documentation</a> for more information.</p>



<p>Our configuration resides in <em>application.conf </em>file [<a href="https://github.com/lightbend/config/blob/master/HOCON.md">HOCON format</a>]:</p>



<div class="wp-block-codemirror-blocks-code-block code-block" id="7"><pre class="CodeMirror" data-setting="{&quot;mode&quot;:&quot;javascript&quot;,&quot;mime&quot;:&quot;application/json&quot;,&quot;theme&quot;:&quot;material&quot;,&quot;lineNumbers&quot;:true,&quot;styleActiveLine&quot;:false,&quot;lineWrapping&quot;:false,&quot;readOnly&quot;:true,&quot;languageLabel&quot;:&quot;file&quot;,&quot;fileName&quot;:&quot;HOCON&quot;,&quot;language&quot;:&quot;JSON&quot;,&quot;modeName&quot;:&quot;json&quot;}" id="code-block-7" style="display: none;">akka {
  loglevel = DEBUG
}

akka.management {
  http {
    hostname = "127.0.0.1"
    hostname = ${?AKKA_MANAGEMENT_HTTP_HOST}
    bind-hostname = "0.0.0.0"
    port = 8558
    port = ${?AKKA_MANAGEMENT_HTTP_PORT}
  }
}

strimzi-consumer {
  bootstrap-servers = "localhost:9092"
  bootstrap-servers = ${?SC_BOOTSTRAP_SERVER}
  group-id = "my-group"
  group-id = ${?SC_GROUP_ID}
  enable-auto-commit = "false" // false for at-least-once semantics
  enable-auto-commit = ${?SC_AUTO_COMMIT}
  auto-offset-reset = "latest" // other value: earliest
  auto-offset-reset = ${?SC_OFFSET_RESET}
  topic = "my-topic"
  topic = ${?SC_TOPIC_NAME}
  parallelism = 10 // batch processing of consumed messages
  parallelism = ${?SC_PARALLELISM_NUM}
  sleep-time-ms = 100 // simulates computation of a message
  sleep-time-ms = ${?SC_SLEEP_TIME}
}</pre><div class="CodeMirror CodeMirror-simplescroll cm-s-material"><div class="CodeMirror-panel"><div class="info-panel"><span class="language json json">JSON</span><div class="control-panel"><span class="tool" data-tip="Full Screen"><b class="fullscreen maximize"></b></span><span class="tool" data-tip="Copy Code"><b class="copy"></b></span></div></div></div><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 36px; left: 33px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;" tabindex="0"></textarea></div><div class="CodeMirror-simplescroll-horizontal" cm-not-content="true" style="display: none;"><div></div></div><div class="CodeMirror-simplescroll-vertical adjest-top" cm-not-content="true" style="display: none; bottom: 0px;"><div style="height: 87.2928px; top: 0px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 29px; margin-bottom: -15px; border-right-width: 15px; min-height: 593px; min-width: 531.438px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><div class="CodeMirror-linenumber CodeMirror-gutter-elt"><div>30</div></div></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"><div class="CodeMirror-cursor" style="left: 4px; top: 0px; height: 19.5px;">&nbsp;</div></div><div class="CodeMirror-code" role="presentation" style=""><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">akka</span> {</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">2</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  <span class="cm-property">loglevel</span> <span class="cm-operator">=</span> <span class="cm-variable">DEBUG</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">3</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">4</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">5</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">akka</span>.<span class="cm-property">management</span> {</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">6</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  <span class="cm-property">http</span> {</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">7</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    <span class="cm-variable">hostname</span> <span class="cm-operator">=</span> <span class="cm-string">"127.0.0.1"</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">8</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    <span class="cm-variable">hostname</span> <span class="cm-operator">=</span> <span class="cm-variable">$</span>{<span class="cm-operator">?</span><span class="cm-variable">AKKA_MANAGEMENT_HTTP_HOST</span>}</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">9</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    <span class="cm-variable">bind</span><span class="cm-operator">-</span><span class="cm-variable">hostname</span> <span class="cm-operator">=</span> <span class="cm-string">"0.0.0.0"</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">10</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    <span class="cm-variable">port</span> <span class="cm-operator">=</span> <span class="cm-number">8558</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">11</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    <span class="cm-variable">port</span> <span class="cm-operator">=</span> <span class="cm-variable">$</span>{<span class="cm-operator">?</span><span class="cm-variable">AKKA_MANAGEMENT_HTTP_PORT</span>}</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">12</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  }</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">13</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">14</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">15</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">strimzi</span><span class="cm-operator">-</span><span class="cm-variable">consumer</span> {</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">16</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  <span class="cm-property">bootstrap</span><span class="cm-operator">-</span><span class="cm-variable">servers</span> <span class="cm-operator">=</span> <span class="cm-string">"localhost:9092"</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">17</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  <span class="cm-variable">bootstrap</span><span class="cm-operator">-</span><span class="cm-variable">servers</span> <span class="cm-operator">=</span> <span class="cm-variable">$</span>{<span class="cm-operator">?</span><span class="cm-variable">SC_BOOTSTRAP_SERVER</span>}</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">18</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  <span class="cm-variable">group</span><span class="cm-operator">-</span><span class="cm-variable">id</span> <span class="cm-operator">=</span> <span class="cm-string">"my-group"</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">19</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  <span class="cm-variable">group</span><span class="cm-operator">-</span><span class="cm-variable">id</span> <span class="cm-operator">=</span> <span class="cm-variable">$</span>{<span class="cm-operator">?</span><span class="cm-variable">SC_GROUP_ID</span>}</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">20</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  <span class="cm-variable">enable</span><span class="cm-operator">-</span><span class="cm-variable">auto</span><span class="cm-operator">-</span><span class="cm-variable">commit</span> <span class="cm-operator">=</span> <span class="cm-string">"false"</span> <span class="cm-comment">// false for at-least-once semantics</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">21</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  <span class="cm-variable">enable</span><span class="cm-operator">-</span><span class="cm-variable">auto</span><span class="cm-operator">-</span><span class="cm-variable">commit</span> <span class="cm-operator">=</span> <span class="cm-variable">$</span>{<span class="cm-operator">?</span><span class="cm-variable">SC_AUTO_COMMIT</span>}</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">22</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  <span class="cm-variable">auto</span><span class="cm-operator">-</span><span class="cm-variable">offset</span><span class="cm-operator">-</span><span class="cm-variable">reset</span> <span class="cm-operator">=</span> <span class="cm-string">"latest"</span> <span class="cm-comment">// other value: earliest</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">23</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  <span class="cm-variable">auto</span><span class="cm-operator">-</span><span class="cm-variable">offset</span><span class="cm-operator">-</span><span class="cm-variable">reset</span> <span class="cm-operator">=</span> <span class="cm-variable">$</span>{<span class="cm-operator">?</span><span class="cm-variable">SC_OFFSET_RESET</span>}</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">24</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  <span class="cm-variable">topic</span> <span class="cm-operator">=</span> <span class="cm-string">"my-topic"</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">25</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  <span class="cm-variable">topic</span> <span class="cm-operator">=</span> <span class="cm-variable">$</span>{<span class="cm-operator">?</span><span class="cm-variable">SC_TOPIC_NAME</span>}</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">26</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  <span class="cm-variable">parallelism</span> <span class="cm-operator">=</span> <span class="cm-number">10</span> <span class="cm-comment">// batch processing of consumed messages</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">27</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  <span class="cm-variable">parallelism</span> <span class="cm-operator">=</span> <span class="cm-variable">$</span>{<span class="cm-operator">?</span><span class="cm-variable">SC_PARALLELISM_NUM</span>}</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">28</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  <span class="cm-variable">sleep</span><span class="cm-operator">-</span><span class="cm-variable">time</span><span class="cm-operator">-</span><span class="cm-variable">ms</span> <span class="cm-operator">=</span> <span class="cm-number">100</span> <span class="cm-comment">// simulates computation of a message</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">29</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  <span class="cm-variable">sleep</span><span class="cm-operator">-</span><span class="cm-variable">time</span><span class="cm-operator">-</span><span class="cm-variable">ms</span> <span class="cm-operator">=</span> <span class="cm-variable">$</span>{<span class="cm-operator">?</span><span class="cm-variable">SC_SLEEP_TIME</span>}</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">30</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 15px; width: 1px; border-bottom: 0px solid transparent; top: 593px;"></div><div class="CodeMirror-gutters" style="height: 608px; left: 0px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div></div><iframe class="output-block-frame" src="./Apache Kafka on Kubernetes with Strimzi - Part 2_ Creating Producer and Consumer apps using Go and Scala and deploying on Kubernetes - Sina Nourian_files/saved_resource.html" style="height: 100px;"></iframe></div>



<p>Since we have added the <em>Akka Management</em> dependency, we need to configure it via <em>akka.management</em> key. <em>Akka Management</em> provides some useful HTTP APIs for easy management. We only need the health check APIs provided by the <em>Akka Management</em> because we’re going to deploy it on Kubernetes.</p>



<p>The important part of the configuration is the <em>strimzi-consumer</em> key. Here, we have added the configurations needed for a Kafka consumer. notice the <em>${?…} </em>value for each key. What happens here is that if the environment variable with the specified name exists (for example, SC_BOOTSTRAP_SERVER), the value from environment variable will be overridden. the <em><strong>?</strong></em> before variable name makes it optional.</p>



<p>Before creating our actors, an <strong>ActorSystem</strong> must be defined with a root actor (Guardian). For the sake of simplicity, we have directly used our Consumer Actor instead of a Guardian. So, in our Main class (Application.scala):</p>



<div class="wp-block-codemirror-blocks-code-block code-block" id="8"><pre class="CodeMirror" data-setting="{&quot;mode&quot;:&quot;clike&quot;,&quot;mime&quot;:&quot;text/x-scala&quot;,&quot;theme&quot;:&quot;material&quot;,&quot;lineNumbers&quot;:true,&quot;styleActiveLine&quot;:false,&quot;lineWrapping&quot;:false,&quot;readOnly&quot;:true,&quot;language&quot;:&quot;Scala&quot;,&quot;modeName&quot;:&quot;scala&quot;}" id="code-block-8" style="display: none;">object Application extends App {
  ActorSystem[Nothing](ConsumerClient(), "StrimziConsumer")
}</pre><div class="CodeMirror CodeMirror-simplescroll cm-s-material"><div class="CodeMirror-panel"><div class="info-panel"><span class="language scala scala">Scala</span><div class="control-panel"><span class="tool" data-tip="Full Screen"><b class="fullscreen maximize"></b></span><span class="tool" data-tip="Copy Code"><b class="copy"></b></span></div></div></div><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 36px; left: 33px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;" tabindex="0"></textarea></div><div class="CodeMirror-simplescroll-horizontal" cm-not-content="true" style="display: none;"><div></div></div><div class="CodeMirror-simplescroll-vertical adjest-top" cm-not-content="true" style="display: none;"><div></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 29px; margin-bottom: -15px; border-right-width: 15px; min-height: 67px; min-width: 468.812px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><div class="CodeMirror-linenumber CodeMirror-gutter-elt"><div>3</div></div></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"><div class="CodeMirror-cursor" style="left: 4px; top: 0px; height: 19.5px;">&nbsp;</div></div><div class="CodeMirror-code" role="presentation"><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">object</span> <span class="cm-type">Application</span> <span class="cm-keyword">extends</span> <span class="cm-type">App</span> {</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">2</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  <span class="cm-variable">ActorSystem</span>[<span class="cm-variable">Nothing</span>](<span class="cm-variable">ConsumerClient</span>(), <span class="cm-string">"StrimziConsumer"</span>)</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">3</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 15px; width: 1px; border-bottom: 0px solid transparent; top: 67px;"></div><div class="CodeMirror-gutters" style="height: 82px; left: 0px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div></div></div>



<p>We need to create a <em>ConsumerSettings </em>object to pass to the Consumer. we have created our <em>ConsumerSettings</em> object in <em>ConsumerProperties.scala</em> file:</p>



<div class="wp-block-codemirror-blocks-code-block code-block" id="9"><pre class="CodeMirror" data-setting="{&quot;mode&quot;:&quot;clike&quot;,&quot;mime&quot;:&quot;text/x-scala&quot;,&quot;theme&quot;:&quot;material&quot;,&quot;lineNumbers&quot;:true,&quot;styleActiveLine&quot;:false,&quot;lineWrapping&quot;:false,&quot;readOnly&quot;:true,&quot;language&quot;:&quot;Scala&quot;,&quot;modeName&quot;:&quot;scala&quot;}" id="code-block-9" style="display: none;">def toConsumerSettings: ConsumerSettings[String, Array[Byte]] = {
  ConsumerSettings(system, new StringDeserializer, new ByteArrayDeserializer)
    .withBootstrapServers(bootstrapServers)
    .withGroupId(groupId)
    .withProperty(ConsumerConfig.AUTO_OFFSET_RESET_CONFIG, autoOffsetReset)
    .withProperty(ConsumerConfig.ENABLE_AUTO_COMMIT_CONFIG, enableAutoCommit)
    .withStopTimeout(2.seconds)
}</pre><div class="CodeMirror CodeMirror-simplescroll cm-s-material"><div class="CodeMirror-panel"><div class="info-panel"><span class="language scala scala">Scala</span><div class="control-panel"><span class="tool" data-tip="Full Screen"><b class="fullscreen maximize"></b></span><span class="tool" data-tip="Copy Code"><b class="copy"></b></span></div></div></div><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 36px; left: 33px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;" tabindex="0"></textarea></div><div class="CodeMirror-simplescroll-horizontal" cm-not-content="true" style="display: block; right: 0px; left: 29px;"><div style="width: 577.586px; left: 0px;"></div></div><div class="CodeMirror-simplescroll-vertical adjest-top" cm-not-content="true" style="display: none;"><div></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 29px; margin-bottom: -15px; border-right-width: 15px; min-height: 164px; min-width: 609.719px; padding-right: 0px; padding-bottom: 8px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><div class="CodeMirror-linenumber CodeMirror-gutter-elt"><div>8</div></div></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"><div class="CodeMirror-cursor" style="left: 4px; top: 0px; height: 19.5px;">&nbsp;</div></div><div class="CodeMirror-code" role="presentation" style=""><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">def</span> <span class="cm-def">toConsumerSettings</span>: <span class="cm-variable">ConsumerSettings</span>[<span class="cm-type">String</span>, <span class="cm-type">Array</span>[<span class="cm-type">Byte</span>]] <span class="cm-operator">=</span> {</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">2</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  <span class="cm-variable">ConsumerSettings</span>(<span class="cm-variable">system</span>, <span class="cm-keyword">new</span> <span class="cm-variable">StringDeserializer</span>, <span class="cm-keyword">new</span> <span class="cm-variable">ByteArrayDeserializer</span>)</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">3</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    .<span class="cm-variable">withBootstrapServers</span>(<span class="cm-variable">bootstrapServers</span>)</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">4</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    .<span class="cm-variable">withGroupId</span>(<span class="cm-variable">groupId</span>)</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">5</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    .<span class="cm-variable">withProperty</span>(<span class="cm-variable">ConsumerConfig</span>.<span class="cm-variable">AUTO_OFFSET_RESET_CONFIG</span>, <span class="cm-variable">autoOffsetReset</span>)</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">6</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    .<span class="cm-variable">withProperty</span>(<span class="cm-variable">ConsumerConfig</span>.<span class="cm-variable">ENABLE_AUTO_COMMIT_CONFIG</span>, <span class="cm-variable">enableAutoCommit</span>)</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">7</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    .<span class="cm-variable">withStopTimeout</span>(<span class="cm-number">2.</span><span class="cm-variable">seconds</span>)</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">8</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 15px; width: 1px; border-bottom: 8px solid transparent; top: 164px;"></div><div class="CodeMirror-gutters" style="height: 187px; left: 0px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div></div></div>



<p id="block-29892d2e-d029-46f7-a471-cad8c5f8ebc0">As you have noticed, we have directly used a Byte Array as the value type of the Kafka message. It’s considered a best practice in Alpakka Kafka library:</p>



<blockquote class="wp-block-quote"><p>The general recommendation for de-/serialization of messages is to use byte arrays (or Strings) as value and do the de-/serialization in a&nbsp;<code>map</code>&nbsp;operation in the Akka Stream instead of implementing it directly in Kafka de-/serializers. When deserialization is handled explicitly within the Akka Stream, it is easier to implement the desired error handling strategy as the examples below show.</p><cite><a href="https://doc.akka.io/docs/alpakka-kafka/current/serialization.html#serialization">Akka documentation</a></cite></blockquote>



<p>Now, let’s create our Consumer actor:</p>



<div class="wp-block-codemirror-blocks-code-block code-block" id="10"><pre class="CodeMirror" data-setting="{&quot;mode&quot;:&quot;clike&quot;,&quot;mime&quot;:&quot;text/x-scala&quot;,&quot;theme&quot;:&quot;material&quot;,&quot;lineNumbers&quot;:true,&quot;styleActiveLine&quot;:false,&quot;lineWrapping&quot;:false,&quot;readOnly&quot;:true,&quot;language&quot;:&quot;Scala&quot;,&quot;modeName&quot;:&quot;scala&quot;}" id="code-block-10" style="display: none;">package com.snourian.strimzi.consumer

import akka.actor.ActorSystem
import akka.actor.typed.Behavior
import akka.actor.typed.scaladsl.Behaviors
import akka.actor.typed.scaladsl.adapter.TypedActorSystemOps
import akka.kafka.scaladsl.{Committer, Consumer}
import akka.kafka.{CommitterSettings, Subscriptions}
import akka.management.scaladsl.AkkaManagement
import com.snourian.strimzi.producer.consumer.MyMessage

import scala.concurrent.{ExecutionContextExecutor, Future}
import scala.util.Try

object ConsumerClient {

  sealed trait Command

  private final case class KafkaConsumerStopped(reason: Try[Any]) extends Command

  def apply(): Behavior[Nothing] = {
    Behaviors.setup[Command] { ctx =&gt;
      ctx.log.debug("Initializing ConsumerClient actor...")
      // Alpakka Kafka still uses the old ActorSystem (Classic System) which is untyped,
      // we need to convert the typed actor system to the classic untyped system.
      implicit val system: ActorSystem = ctx.system.toClassic
      implicit val ec: ExecutionContextExecutor = ctx.executionContext

      AkkaManagement(system).start()
      val consumerProps = ConsumerProperties(system)
      val subscription = Subscriptions.topics(consumerProps.topic)
      /*
      committableSource =&gt; offset can be committed after the computation -&gt; at-least-once delivery semantic
      sourceWithOffsetContext =&gt; same as committableSource, but with offset position as flow context
      for at-most-once, use atMostOnceSource() and for exactly-once, use plainSource() for a fine-grained control over offset committing
      use Consumer.DrainingControl if you want to stop the stream after some amount of time
       */
      val consume = Consumer.sourceWithOffsetContext(consumerProps.toConsumerSettings, subscription)
        .mapAsync(consumerProps.parallelism) { record =&gt; // mapAsync -&gt; process received messages in parallel (batch)
          Future {
            system.log.info(s"consumed record with Id ${record.key()} from partition ${record.partition()}")
            MyMessage.parseFrom(record.value()) // compile with SBT to create MyMessage class inside target folder
            Thread.sleep(consumerProps.sleepTime) // some heavy computation!
          }
        }.runWith(Committer.sinkWithOffsetContext(CommitterSettings(system)))
      // send a message to self if the consumer stops
      consume.onComplete { result =&gt;
        ctx.self ! KafkaConsumerStopped(result)
      }
      Behaviors.receiveMessage[Command] {
        case KafkaConsumerStopped(reason) =&gt; //stop the Behavior when the consumer stops
          ctx.log.warn("Consumer stopped {}", reason)
          Behaviors.stopped
      }
    }.narrow //we don't care about the type, so narrow it down to Nothing (instead of Command)
  }
}</pre><div class="CodeMirror CodeMirror-simplescroll cm-s-material"><div class="CodeMirror-panel"><div class="info-panel"><span class="language scala scala">Scala</span><div class="control-panel"><span class="tool" data-tip="Full Screen"><b class="fullscreen maximize"></b></span><span class="tool" data-tip="Copy Code"><b class="copy"></b></span></div></div></div><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 36px; left: 33px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;" tabindex="0"></textarea></div><div class="CodeMirror-simplescroll-horizontal" cm-not-content="true" style="display: block; right: 0px; left: 29px;"><div style="width: 338.781px; left: 0px;"></div></div><div class="CodeMirror-simplescroll-vertical adjest-top" cm-not-content="true" style="display: none; bottom: 8px;"><div style="height: 47.9948px; top: 0px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true" style="height: 8px; width: 8px;"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 29px; margin-bottom: -15px; border-right-width: 15px; min-height: 1120px; min-width: 1071.44px; padding-right: 0px; padding-bottom: 8px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><div class="CodeMirror-linenumber CodeMirror-gutter-elt"><div>57</div></div></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"><div class="CodeMirror-cursor" style="left: 4px; top: 0px; height: 19.5px;">&nbsp;</div></div><div class="CodeMirror-code" role="presentation" style=""><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">package</span> <span class="cm-def">com</span>.<span class="cm-variable">snourian</span>.<span class="cm-variable">strimzi</span>.<span class="cm-variable">consumer</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">2</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">3</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">import</span> <span class="cm-variable">akka</span>.<span class="cm-variable">actor</span>.<span class="cm-variable">ActorSystem</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">4</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">import</span> <span class="cm-variable">akka</span>.<span class="cm-variable">actor</span>.<span class="cm-variable">typed</span>.<span class="cm-variable">Behavior</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">5</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">import</span> <span class="cm-variable">akka</span>.<span class="cm-variable">actor</span>.<span class="cm-variable">typed</span>.<span class="cm-variable">scaladsl</span>.<span class="cm-variable">Behaviors</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">6</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">import</span> <span class="cm-variable">akka</span>.<span class="cm-variable">actor</span>.<span class="cm-variable">typed</span>.<span class="cm-variable">scaladsl</span>.<span class="cm-variable">adapter</span>.<span class="cm-variable">TypedActorSystemOps</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">7</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">import</span> <span class="cm-variable">akka</span>.<span class="cm-variable">kafka</span>.<span class="cm-variable">scaladsl</span>.{<span class="cm-variable">Committer</span>, <span class="cm-variable">Consumer</span>}</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">8</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">import</span> <span class="cm-variable">akka</span>.<span class="cm-variable">kafka</span>.{<span class="cm-variable">CommitterSettings</span>, <span class="cm-variable">Subscriptions</span>}</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">9</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">import</span> <span class="cm-variable">akka</span>.<span class="cm-variable">management</span>.<span class="cm-variable">scaladsl</span>.<span class="cm-variable">AkkaManagement</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">10</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">import</span> <span class="cm-variable">com</span>.<span class="cm-variable">snourian</span>.<span class="cm-variable">strimzi</span>.<span class="cm-variable">producer</span>.<span class="cm-variable">consumer</span>.<span class="cm-variable">MyMessage</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">11</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">12</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">import</span> <span class="cm-variable">scala</span>.<span class="cm-variable">concurrent</span>.{<span class="cm-variable">ExecutionContextExecutor</span>, <span class="cm-variable">Future</span>}</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">13</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">import</span> <span class="cm-variable">scala</span>.<span class="cm-variable">util</span>.<span class="cm-variable">Try</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">14</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">15</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">object</span> <span class="cm-def">ConsumerClient</span> {</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">16</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">17</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  <span class="cm-keyword">sealed</span> <span class="cm-keyword">trait</span> <span class="cm-def">Command</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">18</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">19</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  <span class="cm-keyword">private</span> <span class="cm-keyword">final</span> <span class="cm-keyword">case</span> <span class="cm-keyword">class</span> <span class="cm-def">KafkaConsumerStopped</span>(<span class="cm-variable">reason</span>: <span class="cm-variable">Try</span>[<span class="cm-variable">Any</span>]) <span class="cm-keyword">extends</span> <span class="cm-variable">Command</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">20</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">21</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  <span class="cm-keyword">def</span> <span class="cm-def">apply</span>(): <span class="cm-variable">Behavior</span>[<span class="cm-variable">Nothing</span>] <span class="cm-operator">=</span> {</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">22</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    <span class="cm-variable">Behaviors</span>.<span class="cm-variable">setup</span>[<span class="cm-variable">Command</span>] { <span class="cm-variable">ctx</span> <span class="cm-operator">=&gt;</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">23</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">      <span class="cm-variable">ctx</span>.<span class="cm-variable">log</span>.<span class="cm-variable">debug</span>(<span class="cm-string">"Initializing ConsumerClient actor..."</span>)</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">24</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">      <span class="cm-comment">// Alpakka Kafka still uses the old ActorSystem (Classic System) which is untyped,</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">25</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">      <span class="cm-comment">// we need to convert the typed actor system to the classic untyped system.</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">26</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">      <span class="cm-keyword">implicit</span> <span class="cm-keyword">val</span> <span class="cm-def">system</span>: <span class="cm-variable">ActorSystem</span> <span class="cm-operator">=</span> <span class="cm-variable">ctx</span>.<span class="cm-variable">system</span>.<span class="cm-variable">toClassic</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">27</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">      <span class="cm-keyword">implicit</span> <span class="cm-keyword">val</span> <span class="cm-def">ec</span>: <span class="cm-variable">ExecutionContextExecutor</span> <span class="cm-operator">=</span> <span class="cm-variable">ctx</span>.<span class="cm-variable">executionContext</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">28</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">29</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">      <span class="cm-variable">AkkaManagement</span>(<span class="cm-variable">system</span>).<span class="cm-variable">start</span>()</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">30</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">      <span class="cm-keyword">val</span> <span class="cm-def">consumerProps</span> <span class="cm-operator">=</span> <span class="cm-variable">ConsumerProperties</span>(<span class="cm-variable">system</span>)</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">31</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">      <span class="cm-keyword">val</span> <span class="cm-def">subscription</span> <span class="cm-operator">=</span> <span class="cm-variable">Subscriptions</span>.<span class="cm-variable">topics</span>(<span class="cm-variable">consumerProps</span>.<span class="cm-variable">topic</span>)</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">32</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">      <span class="cm-comment">/*</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">33</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">      <span class="cm-comment">committableSource =&gt; offset can be committed after the computation -&gt; at-least-once delivery semantic</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">34</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">      <span class="cm-comment">sourceWithOffsetContext =&gt; same as committableSource, but with offset position as flow context</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">35</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">      <span class="cm-comment">for at-most-once, use atMostOnceSource() and for exactly-once, use plainSource() for a fine-grained control over offset committing</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">36</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">      <span class="cm-comment">use Consumer.DrainingControl if you want to stop the stream after some amount of time</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">37</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">       <span class="cm-comment">*/</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">38</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">      <span class="cm-keyword">val</span> <span class="cm-def">consume</span> <span class="cm-operator">=</span> <span class="cm-variable">Consumer</span>.<span class="cm-variable">sourceWithOffsetContext</span>(<span class="cm-variable">consumerProps</span>.<span class="cm-variable">toConsumerSettings</span>, <span class="cm-variable">subscription</span>)</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">39</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">        .<span class="cm-variable">mapAsync</span>(<span class="cm-variable">consumerProps</span>.<span class="cm-variable">parallelism</span>) { <span class="cm-variable">record</span> <span class="cm-operator">=&gt;</span> <span class="cm-comment">// mapAsync -&gt; process received messages in parallel (batch)</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">40</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">          <span class="cm-variable">Future</span> {</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">41</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">            <span class="cm-variable">system</span>.<span class="cm-variable">log</span>.<span class="cm-variable">info</span>(<span class="cm-variable">s</span><span class="cm-string">"consumed record with Id ${record.key()} from partition ${record.partition()}"</span>)</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">42</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">            <span class="cm-variable">MyMessage</span>.<span class="cm-variable">parseFrom</span>(<span class="cm-variable">record</span>.<span class="cm-variable">value</span>()) <span class="cm-comment">// compile with SBT to create MyMessage class inside target folder</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">43</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">            <span class="cm-type">Thread</span>.<span class="cm-variable">sleep</span>(<span class="cm-variable">consumerProps</span>.<span class="cm-variable">sleepTime</span>) <span class="cm-comment">// some heavy computation!</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">44</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">          }</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">45</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">        }.<span class="cm-variable">runWith</span>(<span class="cm-variable">Committer</span>.<span class="cm-variable">sinkWithOffsetContext</span>(<span class="cm-variable">CommitterSettings</span>(<span class="cm-variable">system</span>)))</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">46</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">      <span class="cm-comment">// send a message to self if the consumer stops</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">47</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">      <span class="cm-variable">consume</span>.<span class="cm-variable">onComplete</span> { <span class="cm-variable">result</span> <span class="cm-operator">=&gt;</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">48</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">        <span class="cm-variable">ctx</span>.<span class="cm-variable">self</span> <span class="cm-operator">!</span> <span class="cm-variable">KafkaConsumerStopped</span>(<span class="cm-variable">result</span>)</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">49</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">      }</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">50</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">      <span class="cm-variable">Behaviors</span>.<span class="cm-variable">receiveMessage</span>[<span class="cm-variable">Command</span>] {</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">51</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">        <span class="cm-keyword">case</span> <span class="cm-variable">KafkaConsumerStopped</span>(<span class="cm-variable">reason</span>) <span class="cm-operator">=&gt;</span> <span class="cm-comment">//stop the Behavior when the consumer stops</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">52</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">          <span class="cm-variable">ctx</span>.<span class="cm-variable">log</span>.<span class="cm-variable">warn</span>(<span class="cm-string">"Consumer stopped {}"</span>, <span class="cm-variable">reason</span>)</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">53</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">          <span class="cm-variable">Behaviors</span>.<span class="cm-variable">stopped</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">54</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">      }</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">55</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    }.<span class="cm-variable">narrow</span> <span class="cm-comment">//we don't care about the type, so narrow it down to Nothing (instead of Command)</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">56</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  }</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">57</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 15px; width: 1px; border-bottom: 8px solid transparent; top: 1120px;"></div><div class="CodeMirror-gutters" style="height: 1143px; left: 0px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div></div></div>



<p>Alpakka Kafka provides various consumer implementations for different needs. I explained some of them in the comments above the Consumer code. here, we are using <em>sourceWithOffsetContext </em>that can be used to achieve at least once delivery semantics. also, with the help of the MapAsync, we are processing messages in batch and committing the offset after the processing of the message.</p>



<p>We’re almost done! Now we need to create a Docker image and publish it into our repository. Since we are using SBT build tool, we can use the <strong><em>SBT Native Packager</em></strong> plugin that can get this job done automatically. So no need to create a Dockerfile by hand.</p>



<p>For the <em>SBT Native Packager</em> to work, first we need to add the SBT plugin into the <em>/project/plugins.sbt</em> file</p>



<div class="wp-block-codemirror-blocks-code-block code-block" id="11"><pre class="CodeMirror" data-setting="{&quot;mode&quot;:&quot;clike&quot;,&quot;mime&quot;:&quot;text/x-scala&quot;,&quot;theme&quot;:&quot;material&quot;,&quot;lineNumbers&quot;:false,&quot;styleActiveLine&quot;:false,&quot;lineWrapping&quot;:false,&quot;readOnly&quot;:true,&quot;showPanel&quot;:false,&quot;language&quot;:&quot;Scala&quot;,&quot;modeName&quot;:&quot;scala&quot;}" id="code-block-11" style="display: none;">addSbtPlugin("com.typesafe.sbt" % "sbt-native-packager" % "1.7.6")</pre><div class="CodeMirror CodeMirror-simplescroll cm-s-material"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 4px; left: 4px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;" tabindex="0"></textarea></div><div class="CodeMirror-simplescroll-horizontal" cm-not-content="true" style="display: none;"><div></div></div><div class="CodeMirror-simplescroll-vertical" cm-not-content="true" style="display: none;"><div></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: -15px; border-right-width: 15px; min-height: 28px; min-width: 523.609px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"><div class="CodeMirror-cursor" style="left: 4px; top: 0px; height: 19.5px;">&nbsp;</div></div><div class="CodeMirror-code" role="presentation"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">addSbtPlugin</span>(<span class="cm-string">"com.typesafe.sbt"</span> <span class="cm-operator">%</span> <span class="cm-string">"sbt-native-packager"</span> <span class="cm-operator">%</span> <span class="cm-string">"1.7.6"</span>)</span></pre></div></div></div></div></div><div style="position: absolute; height: 15px; width: 1px; border-bottom: 0px solid transparent; top: 28px;"></div><div class="CodeMirror-gutters" style="display: none; height: 43px;"></div></div></div></div>



<p>And then we need to enable the plugin by adding <em>enablePlugins(JavaAppPackaging)</em> in the <em>build.sbt</em> file. we can also customize the process with the settings provided by the plugin. For example, the default base image that this plugin uses is large and we can easily provide our desired base image:</p>



<div class="wp-block-codemirror-blocks-code-block code-block" id="12"><pre class="CodeMirror" data-setting="{&quot;mode&quot;:&quot;clike&quot;,&quot;mime&quot;:&quot;text/x-scala&quot;,&quot;theme&quot;:&quot;material&quot;,&quot;lineNumbers&quot;:false,&quot;styleActiveLine&quot;:false,&quot;lineWrapping&quot;:false,&quot;readOnly&quot;:true,&quot;showPanel&quot;:false,&quot;language&quot;:&quot;Scala&quot;,&quot;modeName&quot;:&quot;scala&quot;}" id="code-block-12" style="display: none;">lazy val dockerSettings = Seq(
  dockerBaseImage := "openjdk:11-jre-slim",
  packageName in Docker := "strimzi-consumer",
  maintainer in Docker := "Sina Nourian &lt;sina.nourian@gmail.com&gt;",
  version in Docker := "v1",
  dockerUsername := Some("nrsina")
)</pre><div class="CodeMirror CodeMirror-simplescroll cm-s-material"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 4px; left: 4px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;" tabindex="0"></textarea></div><div class="CodeMirror-simplescroll-horizontal" cm-not-content="true" style="display: none;"><div></div></div><div class="CodeMirror-simplescroll-vertical" cm-not-content="true" style="display: none;"><div></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: -15px; border-right-width: 15px; min-height: 145px; min-width: 523.609px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"><div class="CodeMirror-cursor" style="left: 4px; top: 0px; height: 19.5px;">&nbsp;</div></div><div class="CodeMirror-code" role="presentation" style=""><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">lazy</span> <span class="cm-keyword">val</span> <span class="cm-def">dockerSettings</span> <span class="cm-operator">=</span> <span class="cm-type">Seq</span>(</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  <span class="cm-variable">dockerBaseImage</span> :<span class="cm-operator">=</span> <span class="cm-string">"openjdk:11-jre-slim"</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  <span class="cm-variable">packageName</span> <span class="cm-variable">in</span> <span class="cm-variable">Docker</span> :<span class="cm-operator">=</span> <span class="cm-string">"strimzi-consumer"</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  <span class="cm-variable">maintainer</span> <span class="cm-variable">in</span> <span class="cm-variable">Docker</span> :<span class="cm-operator">=</span> <span class="cm-string">"Sina Nourian &lt;sina.nourian@gmail.com&gt;"</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  <span class="cm-variable">version</span> <span class="cm-variable">in</span> <span class="cm-variable">Docker</span> :<span class="cm-operator">=</span> <span class="cm-string">"v1"</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  <span class="cm-variable">dockerUsername</span> :<span class="cm-operator">=</span> <span class="cm-variable">Some</span>(<span class="cm-string">"nrsina"</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">)</span></pre></div></div></div></div></div><div style="position: absolute; height: 15px; width: 1px; border-bottom: 0px solid transparent; top: 145px;"></div><div class="CodeMirror-gutters" style="display: none; height: 160px;"></div></div></div></div>



<p>Now, by using the below command, this plugin creates a Docker image and publish it to our local repository. Also, the Dockerfile will be created at <em>/target/docker</em> folder. Check out the project on my <a href="https://github.com/nrsina/strimzi-kafka-tutorial">Github </a>for more information</p>



<div class="wp-block-codemirror-blocks-code-block code-block" id="13"><pre class="CodeMirror" data-setting="{&quot;mode&quot;:&quot;shell&quot;,&quot;mime&quot;:&quot;text/x-sh&quot;,&quot;theme&quot;:&quot;material&quot;,&quot;lineNumbers&quot;:false,&quot;styleActiveLine&quot;:false,&quot;lineWrapping&quot;:false,&quot;readOnly&quot;:true,&quot;showPanel&quot;:false,&quot;language&quot;:&quot;Shell&quot;,&quot;modeName&quot;:&quot;shell&quot;}" id="code-block-13" style="display: none;">$ sbt docker:publishLocal</pre><div class="CodeMirror CodeMirror-simplescroll cm-s-material"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 4px; left: 4px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;" tabindex="0"></textarea></div><div class="CodeMirror-simplescroll-horizontal" cm-not-content="true" style="display: none;"><div></div></div><div class="CodeMirror-simplescroll-vertical" cm-not-content="true" style="display: none;"><div></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: -15px; border-right-width: 15px; min-height: 28px; min-width: 202.688px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"><div class="CodeMirror-cursor" style="left: 4px; top: 0px; height: 19.5px;">&nbsp;</div></div><div class="CodeMirror-code" role="presentation"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">$ sbt</span> docker:publishLocal</span></pre></div></div></div></div></div><div style="position: absolute; height: 15px; width: 1px; border-bottom: 0px solid transparent; top: 28px;"></div><div class="CodeMirror-gutters" style="display: none; height: 43px;"></div></div></div></div>



<p>If you only want the SBT plugin to create the Dockerfile and not to publish it, run the below command:</p>



<div class="wp-block-codemirror-blocks-code-block code-block" id="14"><pre class="CodeMirror" data-setting="{&quot;mode&quot;:&quot;shell&quot;,&quot;mime&quot;:&quot;text/x-sh&quot;,&quot;theme&quot;:&quot;material&quot;,&quot;lineNumbers&quot;:false,&quot;styleActiveLine&quot;:false,&quot;lineWrapping&quot;:false,&quot;readOnly&quot;:true,&quot;showPanel&quot;:false,&quot;language&quot;:&quot;Shell&quot;,&quot;modeName&quot;:&quot;shell&quot;}" id="code-block-14" style="display: none;">$ sbt docker:stage</pre><div class="CodeMirror CodeMirror-simplescroll cm-s-material"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 4px; left: 4px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;" tabindex="0"></textarea></div><div class="CodeMirror-simplescroll-horizontal" cm-not-content="true" style="display: none;"><div></div></div><div class="CodeMirror-simplescroll-vertical" cm-not-content="true" style="display: none;"><div></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: -15px; border-right-width: 15px; min-height: 28px; min-width: 147.891px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"><div class="CodeMirror-cursor" style="left: 4px; top: 0px; height: 19.5px;">&nbsp;</div></div><div class="CodeMirror-code" role="presentation"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">$ sbt</span> docker:stage</span></pre></div></div></div></div></div><div style="position: absolute; height: 15px; width: 1px; border-bottom: 0px solid transparent; top: 28px;"></div><div class="CodeMirror-gutters" style="display: none; height: 43px;"></div></div></div></div>



<p>Now it’s time to write some YAML files:</p>



<div class="wp-block-codemirror-blocks-code-block code-block" id="15"><pre class="CodeMirror" data-setting="{&quot;mode&quot;:&quot;yaml&quot;,&quot;mime&quot;:&quot;text/x-yaml&quot;,&quot;theme&quot;:&quot;material&quot;,&quot;lineNumbers&quot;:true,&quot;styleActiveLine&quot;:false,&quot;lineWrapping&quot;:false,&quot;readOnly&quot;:true,&quot;language&quot;:&quot;YAML&quot;,&quot;modeName&quot;:&quot;yaml&quot;}" id="code-block-15" style="display: none;">apiVersion: apps/v1
kind: Deployment
metadata:
  name: strimzi-consumer-deployment
  labels:
    app: strimzi-consumer
spec:
  replicas: 3
  selector:
    matchLabels:
      app: strimzi-consumer
  template:
    metadata:
      labels:
        app: strimzi-consumer
    spec:
      containers:
      - name: strimzi-consumer
        image: nrsina/strimzi-consumer:v1
        imagePullPolicy: Never # IfNotPresent
        ports:
        - name: management
          containerPort: 8558
          protocol: TCP
        readinessProbe:
          httpGet:
            path: /ready
            port: management
          periodSeconds: 10
          failureThreshold: 3
          initialDelaySeconds: 10
        livenessProbe:
          httpGet:
            path: /alive
            port: management
          periodSeconds: 10
          failureThreshold: 5
          initialDelaySeconds: 20
        env:
        - name: SC_BOOTSTRAP_SERVER
          value: "my-cluster-kafka-bootstrap.kafka:9092"
        - name: SC_GROUP_ID
          value: "my-group"
        - name: SC_TOPIC_NAME
          value: "my-topic"
        - name: SC_PARALLELISM_NUM
          value: "5"
        - name: SC_SLEEP_TIME
          value: "200"</pre><div class="CodeMirror CodeMirror-simplescroll cm-s-material"><div class="CodeMirror-panel"><div class="info-panel"><span class="language yaml yaml">YAML</span><div class="control-panel"><span class="tool" data-tip="Full Screen"><b class="fullscreen maximize"></b></span><span class="tool" data-tip="Copy Code"><b class="copy"></b></span></div></div></div><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 36px; left: 33px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;" tabindex="0"></textarea></div><div class="CodeMirror-simplescroll-horizontal" cm-not-content="true" style="display: none;"><div></div></div><div class="CodeMirror-simplescroll-vertical adjest-top" cm-not-content="true" style="display: none; bottom: 0px;"><div style="height: 54.2125px; top: 0px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 29px; margin-bottom: -15px; border-right-width: 15px; min-height: 964px; min-width: 445.312px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><div class="CodeMirror-linenumber CodeMirror-gutter-elt"><div>49</div></div></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"><div class="CodeMirror-cursor" style="left: 4px; top: 0px; height: 19.5px;">&nbsp;</div></div><div class="CodeMirror-code" role="presentation" style=""><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-atom">apiVersion</span><span class="cm-meta">: </span>apps/v1</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">2</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-atom">kind</span><span class="cm-meta">: </span>Deployment</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">3</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-atom">metadata</span><span class="cm-meta">:</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">4</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-atom">  name</span><span class="cm-meta">: </span>strimzi-consumer-deployment</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">5</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-atom">  labels</span><span class="cm-meta">:</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">6</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-atom">    app</span><span class="cm-meta">: </span>strimzi-consumer</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">7</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-atom">spec</span><span class="cm-meta">:</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">8</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-atom">  replicas</span><span class="cm-meta">: </span><span class="cm-number">3</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">9</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-atom">  selector</span><span class="cm-meta">:</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">10</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-atom">    matchLabels</span><span class="cm-meta">:</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">11</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-atom">      app</span><span class="cm-meta">: </span>strimzi-consumer</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">12</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-atom">  template</span><span class="cm-meta">:</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">13</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-atom">    metadata</span><span class="cm-meta">:</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">14</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-atom">      labels</span><span class="cm-meta">:</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">15</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-atom">        app</span><span class="cm-meta">: </span>strimzi-consumer</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">16</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-atom">    spec</span><span class="cm-meta">:</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">17</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-atom">      containers</span><span class="cm-meta">:</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">18</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-meta">      - </span><span class="cm-atom">name</span><span class="cm-meta">: </span>strimzi-consumer</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">19</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-atom">        image</span><span class="cm-meta">: </span>nrsina/strimzi-consumer<span class="cm-meta">:</span>v1</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">20</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-atom">        imagePullPolicy</span><span class="cm-meta">: </span>Never <span class="cm-comment"># IfNotPresent</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">21</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-atom">        ports</span><span class="cm-meta">:</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">22</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-meta">        - </span><span class="cm-atom">name</span><span class="cm-meta">: </span>management</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">23</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-atom">          containerPort</span><span class="cm-meta">: </span><span class="cm-number">8558</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">24</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-atom">          protocol</span><span class="cm-meta">: </span>TCP</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">25</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-atom">        readinessProbe</span><span class="cm-meta">:</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">26</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-atom">          httpGet</span><span class="cm-meta">:</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">27</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-atom">            path</span><span class="cm-meta">: </span>/ready</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">28</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-atom">            port</span><span class="cm-meta">: </span>management</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">29</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-atom">          periodSeconds</span><span class="cm-meta">: </span><span class="cm-number">10</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">30</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-atom">          failureThreshold</span><span class="cm-meta">: </span><span class="cm-number">3</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">31</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-atom">          initialDelaySeconds</span><span class="cm-meta">: </span><span class="cm-number">10</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">32</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-atom">        livenessProbe</span><span class="cm-meta">:</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">33</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-atom">          httpGet</span><span class="cm-meta">:</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">34</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-atom">            path</span><span class="cm-meta">: </span>/alive</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">35</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-atom">            port</span><span class="cm-meta">: </span>management</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">36</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-atom">          periodSeconds</span><span class="cm-meta">: </span><span class="cm-number">10</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">37</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-atom">          failureThreshold</span><span class="cm-meta">: </span><span class="cm-number">5</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">38</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-atom">          initialDelaySeconds</span><span class="cm-meta">: </span><span class="cm-number">20</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">39</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-atom">        env</span><span class="cm-meta">:</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">40</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-meta">        - </span><span class="cm-atom">name</span><span class="cm-meta">: </span>SC_BOOTSTRAP_SERVER</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">41</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-atom">          value</span><span class="cm-meta">: </span><span class="cm-string">"my-cluster-kafka-bootstrap.kafka:9092"</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">42</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-meta">        - </span><span class="cm-atom">name</span><span class="cm-meta">: </span>SC_GROUP_ID</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">43</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-atom">          value</span><span class="cm-meta">: </span><span class="cm-string">"my-group"</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">44</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-meta">        - </span><span class="cm-atom">name</span><span class="cm-meta">: </span>SC_TOPIC_NAME</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">45</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-atom">          value</span><span class="cm-meta">: </span><span class="cm-string">"my-topic"</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">46</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-meta">        - </span><span class="cm-atom">name</span><span class="cm-meta">: </span>SC_PARALLELISM_NUM</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">47</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-atom">          value</span><span class="cm-meta">: </span><span class="cm-string">"5"</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">48</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-meta">        - </span><span class="cm-atom">name</span><span class="cm-meta">: </span>SC_SLEEP_TIME</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">49</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-atom">          value</span><span class="cm-meta">: </span><span class="cm-string">"200"</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 15px; width: 1px; border-bottom: 0px solid transparent; top: 964px;"></div><div class="CodeMirror-gutters" style="height: 979px; left: 0px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div></div></div>



<p>We are going to create 3 replicas for our consumer to see how the GroupId works.</p>



<p>Now, just like before, let’s apply our deployment file, wait for the pod to start and get logs from one of the pods:</p>



<figure class="wp-block-image size-large"><a href="http://snourian.com/wp-content/uploads/2020/10/strimzi-consumer.png" target="_blank" rel="noopener noreferrer"><img loading="lazy" width="1024" height="646" src="./Apache Kafka on Kubernetes with Strimzi - Part 2_ Creating Producer and Consumer apps using Go and Scala and deploying on Kubernetes - Sina Nourian_files/strimzi-consumer-1024x646.png" alt="" class="wp-image-116" srcset="https://snourian.com/wp-content/uploads/2020/10/strimzi-consumer-1024x646.png 1024w, https://snourian.com/wp-content/uploads/2020/10/strimzi-consumer-300x189.png 300w, https://snourian.com/wp-content/uploads/2020/10/strimzi-consumer-768x485.png 768w, https://snourian.com/wp-content/uploads/2020/10/strimzi-consumer-1100x694.png 1100w, https://snourian.com/wp-content/uploads/2020/10/strimzi-consumer.png 1336w" sizes="(max-width: 1024px) 100vw, 1024px"></a><figcaption>Deploying Strimzi Consumer app in Kubernetes</figcaption></figure>



<p><strong>Voilà!</strong> Three replicas of our consumer app is running and consuming messages from Kafka.</p>



<h1>Conclusion</h1>



<p>After deploying our Kafka Cluster on Kubernetes (Part 1), we have built a producer app in Go language and a consumer app in Scala language. After publishing our applications and watching the logs, it looks like everything is fine and running well. But is it? Are we sure that everything is ok? What is the rate of producing / consuming messages? Do we have a “Consumer Lag” here? By the look of the logs everything is fine and running well. But we are not really sure how our apps and Kafka are performing. <strong>We need some monitoring tools to monitor the Kafka’s performance.</strong> In the next part of the series, we are going to use Prometheus and Grafana to monitor our Cluster.</p>



<p>Feel free to ask any questions or share any comments in the comment section or contact me via email.</p>
					</div>
		<div class="post-categories"><span>Published in</span><a href="https://snourian.com/category/big-data/" title="View all posts in Big Data">Big Data</a><a href="https://snourian.com/category/kubernetes/" title="View all posts in Kubernetes">Kubernetes</a></div>		<div class="post-tags"><ul><li><a href="https://snourian.com/tag/akka/" title="View all posts tagged akka">akka</a></li><li><a href="https://snourian.com/tag/alpakka/" title="View all posts tagged alpakka">alpakka</a></li><li><a href="https://snourian.com/tag/docker/" title="View all posts tagged docker">docker</a></li><li><a href="https://snourian.com/tag/go/" title="View all posts tagged go">go</a></li><li><a href="https://snourian.com/tag/kafka/" title="View all posts tagged kafka">kafka</a></li><li><a href="https://snourian.com/tag/kubernetes/" title="View all posts tagged kubernetes">kubernetes</a></li><li><a href="https://snourian.com/tag/sbt/" title="View all posts tagged sbt">sbt</a></li><li><a href="https://snourian.com/tag/scala/" title="View all posts tagged scala">scala</a></li><li><a href="https://snourian.com/tag/strimzi/" title="View all posts tagged strimzi">strimzi</a></li></ul></div>	</article>
		<nav class="further-reading">
	<div class="previous">
		<span>Previous Post</span>
		<a href="https://snourian.com/kafka-kubernetes-strimzi-part-1-creating-deploying-strimzi-kafka/" rel="prev">Apache Kafka on Kubernetes with Strimzi – Part 1: Creating and Deploying a Strimzi Kafka Cluster</a>	</div>
	<div class="next">
		<span>Next Post</span>
		<a href="https://snourian.com/kafka-kubernetes-strimzi-part-3-monitoring-strimzi-kafka-with-prometheus-grafana/" rel="next">Apache Kafka on Kubernetes with Strimzi – Part 3: Monitoring our Strimzi Kafka Cluster with Prometheus and Grafana</a>	</div>
</nav>		<section id="comments" class="comments">
		<div class="comments-number">
			<h2>
				One Comment			</h2>
		</div>
		<ol class="comment-list">
					<li class="pingback even thread-even depth-1" id="li-comment-1110">
		<article id="comment-1110" class="comment">
			<div class="comment-author">
								<span class="author-name"><a href="https://snourian.com/reliable-messaging-outbox-pattern-kafka-debezium-oracle-micronaut-kubernetes/" rel="external nofollow ugc" class="url">Reliable Messaging in Microservices - Implementing Outbox Pattern using Kafka, Debezium, Micronaut, and Oracle Database on Kubernetes - Sina Nourian</a></span>
			</div>
			<div class="comment-content">
								<p>[…] architecture. But how can we implement a reliable message exchange between our microservices? What delivery semantics should we […]</p>
			</div>
					</article>
		</li><!-- #comment-## -->
		</ol>
					<div id="respond" class="comment-respond">
		<h3 id="reply-title" class="comment-reply-title">Leave a Reply <small><a rel="nofollow" id="cancel-comment-reply-link" href="https://snourian.com/kafka-kubernetes-strimzi-part-2-creating-producer-consumer-using-go-scala-deploying-on-kubernetes/#respond" style="display:none;">Cancel reply</a></small></h3><form action="https://snourian.com/wp-comments-post.php" method="post" id="commentform" class="comment-form" novalidate=""><p class="comment-notes"><span id="email-notes">Your email address will not be published.</span> Required fields are marked <span class="required">*</span></p><p class="comment-form-comment">
	            <label for="comment">Comment</label>
	            <textarea required="" id="comment" name="comment" cols="45" rows="8" aria-required="true"></textarea>
	        </p><p class="comment-form-author">
	            <label for="author">Name*</label>
	            <input id="author" name="author" type="text" value="" size="30" aria-required="true">
	        </p>
<p class="comment-form-email">
	            <label for="email">Email*</label>
	            <input id="email" name="email" type="email" value="" size="30" aria-required="true">
	        </p>
<p class="comment-form-url">
	            <label for="url">Website</label>
	            <input id="url" name="url" type="url" value="" size="30">
	            </p>
<p class="form-submit"><input name="submit" type="submit" id="submit" class="submit" value="Post Comment"> <input type="hidden" name="comment_post_ID" value="70" id="comment_post_ID">
<input type="hidden" name="comment_parent" id="comment_parent" value="0">
</p><p style="display: none;"><input type="hidden" id="akismet_comment_nonce" name="akismet_comment_nonce" value="ee9a304226"></p><p style="display: none !important;"><label>Δ<textarea name="ak_hp_textarea" cols="45" rows="8" maxlength="100"></textarea></label><input type="hidden" id="ak_js" name="ak_js" value="1678580593142"><script>document.getElementById( "ak_js" ).setAttribute( "value", ( new Date() ).getTime() );</script></p></form>	</div><!-- #respond -->
		</section>
	</div>	</div>
</section><!-- .main -->
    <footer class="site-footer" role="contentinfo">
                <div class="design-credit">
            <span>
                <a href="https://www.competethemes.com/author/" rel="nofollow">Author WordPress Theme</a> by Compete Themes            </span>
        </div>
    </footer>
</div><!-- .max-width -->
</div><!-- .overflow-container -->
<button id="scroll-to-top" class="scroll-to-top visible"><span class="screen-reader-text">Scroll to the top</span><i class="fas fa-arrow-up"></i></button><script type="text/javascript" src="./Apache Kafka on Kubernetes with Strimzi - Part 2_ Creating Producer and Consumer apps using Go and Scala and deploying on Kubernetes - Sina Nourian_files/codemirror.min.js" id="codemirror-js"></script>
<script type="text/javascript" id="codemirror-autoload-assets-js-before">
var wpcm = {"plugin_url":"https://snourian.com/wp-content/plugins/wp-codemirror-block","assets":[],"panelOptions":{"showPanel":true,"languageLabel":"language","runButton":false,"fullScreenButton":true,"copyButton":true},"view":"public"}
</script>
<script type="text/javascript" src="./Apache Kafka on Kubernetes with Strimzi - Part 2_ Creating Producer and Consumer apps using Go and Scala and deploying on Kubernetes - Sina Nourian_files/autoLoadAssets.min.js" id="codemirror-autoload-assets-js"></script>
<script type="text/javascript" src="./Apache Kafka on Kubernetes with Strimzi - Part 2_ Creating Producer and Consumer apps using Go and Scala and deploying on Kubernetes - Sina Nourian_files/init.min.js" id="codemirror-init-js"></script><div class="CodeMirror-notice"></div>
<script type="text/javascript" id="ct-author-js-js-extra">
/* <![CDATA[ */
var ct_author_objectL10n = {"openPrimaryMenu":"open primary menu","closePrimaryMenu":"close primary menu","openChildMenu":"open child menu","closeChildMenu":"close child menu"};
/* ]]> */
</script>
<script type="text/javascript" src="./Apache Kafka on Kubernetes with Strimzi - Part 2_ Creating Producer and Consumer apps using Go and Scala and deploying on Kubernetes - Sina Nourian_files/production.min.js" id="ct-author-js-js"></script>
<script type="text/javascript" src="./Apache Kafka on Kubernetes with Strimzi - Part 2_ Creating Producer and Consumer apps using Go and Scala and deploying on Kubernetes - Sina Nourian_files/comment-reply.min.js" id="comment-reply-js"></script>
<!--[if IE 8]>
<script type='text/javascript' src='https://snourian.com/wp-content/themes/author/js/build/respond.min.js?ver=5.8.6' id='ct-author-respond-js'></script>
<![endif]-->
<script type="text/javascript" src="./Apache Kafka on Kubernetes with Strimzi - Part 2_ Creating Producer and Consumer apps using Go and Scala and deploying on Kubernetes - Sina Nourian_files/wp-embed.min.js" id="wp-embed-js"></script>

</body></html>